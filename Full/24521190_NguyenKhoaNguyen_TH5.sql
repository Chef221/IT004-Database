
-- LAB 1 ---

-- Bài 1: Sinh viên cài đặt hoàn chỉnh bằng các câu lệnh SQL cho 2 CSDL
--QuanLyBanHang (Phần I, câu 1 bài tập thực hành trang 3) và
--QuanLyGiaoVu (Phần I, câu 1 bài tập thực hành trang 11).
CREATE DATABASE QLBH
USE QLBH
CREATE TABLE NHANVIEN
(
	MANV	CHAR(4) PRIMARY KEY,
	HOTEN	VARCHAR(40),
	SODT	VARCHAR(20),
	NGVL	SMALLDATETIME
)
CREATE TABLE KHACHHANG
(
	MAKH	CHAR(4) PRIMARY KEY, 
	HOTEN	VARCHAR(40),
	DCHI	VARCHAR(50),
	SODT	VARCHAR(20),
	NGSINH	SMALLDATETIME,
	NGDK	SMALLDATETIME,
	DOANHSO	MONEY
)
CREATE TABLE SANPHAM
(
	MASP	CHAR(4) PRIMARY KEY,
	TENSP	VARCHAR(40),
	DVT		VARCHAR(20),
	NUOCSX	VARCHAR(40),
	GIA		MONEY
)
CREATE TABLE HOADON(
	SOHD	INT PRIMARY KEY,
	NGHD	SMALLDATETIME,
	MAKH	CHAR(4) REFERENCES KHACHHANG(MAKH),
	MANV	CHAR(4) REFERENCES NHANVIEN(MANV),
	TRIGIA	MONEY
)
CREATE TABLE CTHD
(	
	SOHD	INT REFERENCES HOADON(SOHD),
	MASP	CHAR(4) REFERENCES SANPHAM(MASP),
	SL		INT
	PRIMARY KEY(SOHD, MASP)
)

CREATE DATABASE QLGV
USE QLGV

CREATE TABLE KHOA 
(
	MAKHOA	VARCHAR(4) PRIMARY KEY,
	TENKHOA	VARCHAR(40),
	NGTLAP	SMALLDATETIME,
	TRGKHOA	CHAR(4)
)
CREATE TABLE MONHOC
(	
	MAMH	VARCHAR(10) PRIMARY KEY,
	TENMH	VARCHAR(40),
	TCLT	TINYINT,
	TCTH	TINYINT,
	MAKHOA	VARCHAR(4) REFERENCES KHOA(MAKHOA)
)
CREATE TABLE DIEUKIEN
(	
	MAMH VARCHAR(10) REFERENCES MONHOC(MAMH),
	MAMH_TRUOC	VARCHAR(10)
	PRIMARY KEY (MAMH, MAMH_TRUOC)
)
CREATE TABLE GIAOVIEN
(
	MAGV	CHAR(4) PRIMARY KEY,
	HOTEN	VARCHAR(40),
	HOCVI	VARCHAR(10),
	HOCHAM	VARCHAR(10),
	GIOITINH	VARCHAR(3),
	NGSINH	SMALLDATETIME,
	NGVL	SMALLDATETIME,
	HESO	NUMERIC(4,2),
	MUCLUONG	MONEY,
	MAKHOA	VARCHAR(4) REFERENCES KHOA(MAKHOA)
)
CREATE TABLE LOP
(
	MALOP	CHAR(3) PRIMARY KEY,
	TENLOP	VARCHAR(40),
	TRGLOP	CHAR(5),
	SISO	TINYINT,
	MAGVCN	CHAR(4) REFERENCES GIAOVIEN(MAGV)
)
CREATE TABLE HOCVIEN
(
	MAHV	CHAR(5) PRIMARY KEY,
	HO		VARCHAR(40),
	TEN		VARCHAR(10),
	NGSINH	SMALLDATETIME,
	GIOITINH	VARCHAR(3),
	NOISINH		VARCHAR(40),
	MALOP	CHAR(3) REFERENCES LOP(MALOP)
)
CREATE TABLE GIANGDAY
(
	MALOP	CHAR(3) REFERENCES LOP(MALOP),
	MAMH	VARCHAR(10) REFERENCES MONHOC(MAMH),
	MAGV	CHAR(4)	REFERENCES GIAOVIEN(MAGV),
	HOCKY	TINYINT,
	NAM		SMALLINT,
	TUNGAY	SMALLDATETIME,
	DENNGAY	SMALLDATETIME,
	PRIMARY KEY (MALOP, MAMH)
)
CREATE TABLE KETQUATHI
(
	MAHV	CHAR(5) REFERENCES HOCVIEN(MAHV),
	MAMH	VARCHAR(10) REFERENCES MONHOC(MAMH),
	LANTHI	TINYINT,
	NGTHI	SMALLDATETIME,
	DIEM	NUMERIC(4,2),
	KQUA	VARCHAR(10),
	PRIMARY KEY (MAHV, MAMH, LANTHI)
)
ALTER TABLE KHOA ADD CONSTRAINT FK_KHOA_TRGKHOA FOREIGN KEY (TRGKHOA) REFERENCES GIAOVIEN(MAGV)
ALTER TABLE LOP ADD CONSTRAINT FK_LOP_TRGLOP FOREIGN KEY (TRGLOP) REFERENCES HOCVIEN(MAHV)
ALTER TABLE HOCVIEN
ADD GHICHU varchar(50)
ALTER TABLE HOCVIEN
ADD DIEMTB numeric(4,2)
ALTER TABLE HOCVIEN
ADD XEPLOAI varchar(10)


-- Bài 2: Sinh viên hoàn thành Phần I bài tập QuanLyBanHang từ câu 2 đến câu 10.
-- 2. Thêm vào thuộc tính GHICHU có kiểu dữ liệu varchar(20) cho quan hệ SANPHAM.
ALTER TABLE SANPHAM ADD GHICHU VARCHAR(20)
-- 3. Thêm vào thuộc tính LOAIKH có kiểu dữ liệu là tinyint cho quan hệ KHACHHANG
ALTER TABLE KHACHHANG ADD LOAIKH TINYINT
-- 4. Sửa kiểu dữ liệu của thuộc tính GHICHU trong quan hệ SANPHAM thành varchar(100).
ALTER TABLE SANPHAM ALTER COLUMN GHICHU VARCHAR(100)
-- 5. Xóa thuộc tính GHICHU trong quan hệ SANPHAM.
ALTER TABLE SANPHAM DROP COLUMN GHICHU
-- 6.Làm thế nào để thuộc tính LOAIKH trong quan hệ KHACHHANG có thể lưu các giá trị là: “Vang lai”, “Thuong xuyen”, “Vip”…
ALTER TABLE KHACHHANG ADD CONSTRAINT CK_LKH CHECK (LOAIKH IN ('Van lai', 'Thuong xuyen', 'Vip'))
-- 7.Đơn vị tính của sản phẩm chỉ có thể là (“cay”,”hop”,”cai”,”quyen”,”chuc”)
ALTER TABLE SANPHAM ADD CONSTRAINT CK_DVT CHECK (DVT IN ('cay', 'hop','cai','quyen','chuc'))
-- 8.Giá bán của sản phẩm từ 500 đồng trở lên.
ALTER TABLE SANPHAM ADD CONSTRAINT CK_GIA CHECK (GIA >= 500)
-- 9.Mỗi lần mua hàng, khách hàng phải mua ít nhất 1 sản phẩm.
ALTER TABLE CTHD ADD CONSTRAINT CK_SL CHECK (SL >= 1)
-- 10.Ngày khách hàng đăng ký là khách hàng thành viên phải lớn hơn ngày sinh của người đó.
ALTER TABLE KHACHHANG ADD CONSTRAINT CK_NGDK CHECK (NGDK > NGSINH)

-- Bài 3: Sinh viên hoàn thành Phần I bài tập QuanLyGiaoVu từ câu 3 đến câu 8.
-- 3.Thuộc tính GIOITINH chỉ có giá trị là “Nam” hoặc “Nu”.
ALTER TABLE HOCVIEN
ADD CONSTRAINT CK_GIOITINH_HV CHECK(GIOITINH IN ('Nam', 'Nu'))
ALTER TABLE GIAOVIEN
ADD CONSTRAINT CK_GIOITINH_GV CHECK(GIOITINH IN ('Nam', 'Nu'))
-- 4.	Điểm số của một lần thi có giá trị từ 0 đến 10 và cần lưu đến 2 số lẽ (VD: 6.22).
ALTER TABLE KETQUATHI ADD CONSTRAINT CK_DIEM
CHECK (
	DIEM BETWEEN 0 AND 10
	AND DIEM = ROUND(DIEM, 2)
)
-- 5.Kết quả thi là “Dat” nếu điểm từ 5 đến 10  và “Khong dat” nếu điểm nhỏ hơn 5.
ALTER TABLE KETQUATHI ADD CONSTRAINT CK_KQUA
CHECK (KQUA = IIF(DIEM < 5, 'Khong dat', 'Dat'))
-- 6.	Học viên thi một môn tối đa 3 lần
ALTER TABLE KETQUATHI ADD CONSTRAINT CK_LT CHECK (LANTHI <= 3)
-- 7. Học kỳ chỉ có giá trị từ 1 đến 3
ALTER TABLE GIANGDAY ADD CONSTRAINT CK_HK CHECK (HOCKY BETWEEN 1 AND 3)
-- 8. Học vị của giáo viên chỉ có thể là “CN”, “KS”, “Ths”, ”TS”, ”PTS”
ALTER TABLE GIAOVIEN ADD CONSTRAINT CK_HV CHECK (HOCVI IN ('CN', 'KS', 'Ths', 'TS', 'PTS'))



-------------------- LAB02 ---------------------
SET DATEFORMAT DMY
USE QLBH
-------------------------------- KHACHHANG --------------------------------------------
INSERT INTO KHACHHANG(MAKH, HOTEN, DCHI, SODT, NGSINH, DOANHSO, NGDK) VALUES('KH01', 'Nguyen Van A', '731 Tran Hung Dao,  Q5,  TpHCM', '08823451', '22/10/1960', '13060000', '22/07/2006')
INSERT INTO KHACHHANG(MAKH, HOTEN, DCHI, SODT, NGSINH, DOANHSO, NGDK) VALUES('KH02', 'Tran Ngoc Han', '23/5 Nguyen Trai,  Q5, TpHCM', '0908256478', '03/04/1974', '280000', '30/07/2006')
INSERT INTO KHACHHANG(MAKH, HOTEN, DCHI, SODT, NGSINH, DOANHSO, NGDK) VALUES('KH03', 'Tran Ngoc Linh', '45 Nguyen Canh Chan,  Q1,  TpHCM', '0938776266', '12/06/1980', '3860000', '05/08/2006')
INSERT INTO KHACHHANG(MAKH, HOTEN, DCHI, SODT, NGSINH, DOANHSO, NGDK) VALUES('KH04', 'Tran Minh Long', '50/34 Le Dai Hanh,  Q10,  TpHCM', '0917325476', '09/03/1965', '250000', '02/10/2006')
INSERT INTO KHACHHANG(MAKH, HOTEN, DCHI, SODT, NGSINH, DOANHSO, NGDK) VALUES('KH05', 'Le Nhat Minh', '34 Truong Dinh,  Q3,  TpHCM', '08246108', '10/03/1950', '21000', '28/10/2006')
INSERT INTO KHACHHANG(MAKH, HOTEN, DCHI, SODT, NGSINH, DOANHSO, NGDK) VALUES('KH06', 'Le Hoai Thuong', '227 Nguyen Van Cu,  Q5,  TpHCM', '08631738', '31/12/1981', '915000', '24/11/2006')
INSERT INTO KHACHHANG(MAKH, HOTEN, DCHI, SODT, NGSINH, DOANHSO, NGDK) VALUES('KH07', 'Nguyen Van Tam', '32/3 Tran Binh Trong,  Q5,  TpHCM', '0916783565', '06/04/1971', '12500', '01/12/2006')
INSERT INTO KHACHHANG(MAKH, HOTEN, DCHI, SODT, NGSINH, DOANHSO, NGDK) VALUES('KH08', 'Phan Thi Thanh', '45/2 An Duong Vuong,  Q5,  TpHCM', '0938435756', '10/01/1971', '365000', '13/12/2006')
INSERT INTO KHACHHANG(MAKH, HOTEN, DCHI, SODT, NGSINH, DOANHSO, NGDK) VALUES('KH09', 'Le Ha Vinh', '873 Le Hong Phong,  Q5,  TpHCM', '08654763', '03/09/1979', '70000', '14/01/2007')
INSERT INTO KHACHHANG(MAKH, HOTEN, DCHI, SODT, NGSINH, DOANHSO, NGDK) VALUES('KH10', 'Ha Duy Lap', '34/34B Nguyen Trai,  Q1,  TpHCM', '08768904', '02/05/1983', '675000', '16/01/2007')

--------------------------------- NHANVIEN --------------------------------------------
INSERT INTO NHANVIEN(MANV, HOTEN, SODT, NGVL) VALUES('NV01', 'Nguyen Nhu Nhut', '0927345678', '13/04/2006')
INSERT INTO NHANVIEN(MANV, HOTEN, SODT, NGVL) VALUES('NV02', 'Le Thi Phi Yen', '0987567390', '21/04/2006')
INSERT INTO NHANVIEN(MANV, HOTEN, SODT, NGVL) VALUES('NV03', 'Nguyen Van B', '0997047382', '27/04/2006')
INSERT INTO NHANVIEN(MANV, HOTEN, SODT, NGVL) VALUES('NV04', 'Ngo Thanh Tuan', '0913758498', '24/06/2006')
INSERT INTO NHANVIEN(MANV, HOTEN, SODT, NGVL) VALUES('NV05', 'Nguyen Thi Truc Thanh', '0918590387', '20/07/2006')


--------------------------------- SANPHAM ---------------------------------------------
INSERT INTO SANPHAM(MASP, TENSP, DVT, NUOCSX, GIA) VALUES('BC01', 'But chi', 'cay', 'Singapore', '3000')
INSERT INTO SANPHAM(MASP, TENSP, DVT, NUOCSX, GIA) VALUES('BC02', 'But chi', 'cay', 'Singapore', '5000')
INSERT INTO SANPHAM(MASP, TENSP, DVT, NUOCSX, GIA) VALUES('BC03', 'But chi', 'cay', 'Viet Nam', '3500')
INSERT INTO SANPHAM(MASP, TENSP, DVT, NUOCSX, GIA) VALUES('BC04', 'But chi', 'hop', 'Viet Nam', '30000')
INSERT INTO SANPHAM(MASP, TENSP, DVT, NUOCSX, GIA) VALUES('BB01', 'But bi', 'cay', 'Viet Nam', '5000')
INSERT INTO SANPHAM(MASP, TENSP, DVT, NUOCSX, GIA) VALUES('BB02', 'But bi', 'cay', 'Trung Quoc', '5000')
INSERT INTO SANPHAM(MASP, TENSP, DVT, NUOCSX, GIA) VALUES('BB03', 'But bi', 'hop', 'Thai Lan', '100000')
INSERT INTO SANPHAM(MASP, TENSP, DVT, NUOCSX, GIA) VALUES('TV01', 'Tap 100 giay mong', 'quyen', 'Trung Quoc', '2500')
INSERT INTO SANPHAM(MASP, TENSP, DVT, NUOCSX, GIA) VALUES('TV02', 'Tap 200 giay mong', 'quyen', 'Trung Quoc', '4500')
INSERT INTO SANPHAM(MASP, TENSP, DVT, NUOCSX, GIA) VALUES('TV03', 'Tap 100 giay tot', 'quyen', 'Viet Nam', '3000')
INSERT INTO SANPHAM(MASP, TENSP, DVT, NUOCSX, GIA) VALUES('TV04', 'Tap 200 giay tot', 'quyen', 'Viet Nam', '5500')
INSERT INTO SANPHAM(MASP, TENSP, DVT, NUOCSX, GIA) VALUES('TV05', 'Tap 100 trang', 'chuc', 'Viet Nam', '23000')
INSERT INTO SANPHAM(MASP, TENSP, DVT, NUOCSX, GIA) VALUES('TV06', 'Tap 200 trang', 'chuc', 'Viet Nam', '53000')
INSERT INTO SANPHAM(MASP, TENSP, DVT, NUOCSX, GIA) VALUES('TV07', 'Tap 100 trang', 'chuc', 'Trung Quoc', '34000')
INSERT INTO SANPHAM(MASP, TENSP, DVT, NUOCSX, GIA) VALUES('ST01', 'So tay 500 trang', 'quyen', 'Trung Quoc', '40000')
INSERT INTO SANPHAM(MASP, TENSP, DVT, NUOCSX, GIA) VALUES('ST02', 'So tay loai 1', 'quyen', 'Viet Nam', '55000')
INSERT INTO SANPHAM(MASP, TENSP, DVT, NUOCSX, GIA) VALUES('ST03', 'So tay loai 2', 'quyen', 'Viet Nam', '51000')
INSERT INTO SANPHAM(MASP, TENSP, DVT, NUOCSX, GIA) VALUES('ST04', 'So tay', 'quyen', 'Thai Lan', '55000')
INSERT INTO SANPHAM(MASP, TENSP, DVT, NUOCSX, GIA) VALUES('ST05', 'So tay mong', 'quyen', 'Thai Lan', '20000')
INSERT INTO SANPHAM(MASP, TENSP, DVT, NUOCSX, GIA) VALUES('ST06', 'Phan viet bang', 'hop', 'Viet Nam', '5000')
INSERT INTO SANPHAM(MASP, TENSP, DVT, NUOCSX, GIA) VALUES('ST07', 'Phan khong bui', 'hop', 'Viet Nam', '7000')
INSERT INTO SANPHAM(MASP, TENSP, DVT, NUOCSX, GIA) VALUES('ST08', 'Bong bang', 'cai', 'Viet Nam', '5000')
INSERT INTO SANPHAM(MASP, TENSP, DVT, NUOCSX, GIA) VALUES('ST09', 'But long', 'cay', 'Viet Nam', '5000')
INSERT INTO SANPHAM(MASP, TENSP, DVT, NUOCSX, GIA) VALUES('ST10', 'But long', 'cay', 'Trung Quoc', '7000')
GO

---------------------------------- HOADON ---------------------------------------------
INSERT INTO HOADON(SOHD, NGHD, MAKH, MANV, TRIGIA) VALUES('1001', '23/07/2006', 'KH01', 'NV01', '320000')
INSERT INTO HOADON(SOHD, NGHD, MAKH, MANV, TRIGIA) VALUES('1002', '12/08/2006', 'KH01', 'NV02', '840000')
INSERT INTO HOADON(SOHD, NGHD, MAKH, MANV, TRIGIA) VALUES('1003', '23/08/2006', 'KH02', 'NV01', '100000')
INSERT INTO HOADON(SOHD, NGHD, MAKH, MANV, TRIGIA) VALUES('1004', '01/09/2006', 'KH02', 'NV01', '180000')
INSERT INTO HOADON(SOHD, NGHD, MAKH, MANV, TRIGIA) VALUES('1005', '20/10/2006', 'KH01', 'NV02', '3800000')
INSERT INTO HOADON(SOHD, NGHD, MAKH, MANV, TRIGIA) VALUES('1006', '16/10/2006', 'KH01', 'NV03', '2430000')
INSERT INTO HOADON(SOHD, NGHD, MAKH, MANV, TRIGIA) VALUES('1007', '28/10/2006', 'KH03', 'NV03', '510000')
INSERT INTO HOADON(SOHD, NGHD, MAKH, MANV, TRIGIA) VALUES('1008', '28/10/2006', 'KH01', 'NV03', '440000')
INSERT INTO HOADON(SOHD, NGHD, MAKH, MANV, TRIGIA) VALUES('1009', '28/10/2006', 'KH03', 'NV04', '200000')
INSERT INTO HOADON(SOHD, NGHD, MAKH, MANV, TRIGIA) VALUES('1010', '01/11/2006', 'KH01', 'NV01', '5200000')
INSERT INTO HOADON(SOHD, NGHD, MAKH, MANV, TRIGIA) VALUES('1011', '04/11/2006', 'KH04', 'NV03', '250000')
INSERT INTO HOADON(SOHD, NGHD, MAKH, MANV, TRIGIA) VALUES('1012', '30/11/2006', 'KH05', 'NV03', '21000')
INSERT INTO HOADON(SOHD, NGHD, MAKH, MANV, TRIGIA) VALUES('1013', '12/12/2006', 'KH06', 'NV01', '5000')
INSERT INTO HOADON(SOHD, NGHD, MAKH, MANV, TRIGIA) VALUES('1014', '31/12/2006', 'KH03', 'NV02', '3150000')
INSERT INTO HOADON(SOHD, NGHD, MAKH, MANV, TRIGIA) VALUES('1015', '01/01/2007', 'KH06', 'NV02', '910000')
INSERT INTO HOADON(SOHD, NGHD, MAKH, MANV, TRIGIA) VALUES('1016', '01/01/2007', 'KH07', 'NV02', '12500')
INSERT INTO HOADON(SOHD, NGHD, MAKH, MANV, TRIGIA) VALUES('1017', '02/01/2007', 'KH08', 'NV03', '35000')
INSERT INTO HOADON(SOHD, NGHD, MAKH, MANV, TRIGIA) VALUES('1018', '13/01/2007', 'KH01', 'NV03', '330000')
INSERT INTO HOADON(SOHD, NGHD, MAKH, MANV, TRIGIA) VALUES('1019', '13/01/2007', 'KH01', 'NV03', '30000')
INSERT INTO HOADON(SOHD, NGHD, MAKH, MANV, TRIGIA) VALUES('1020', '14/01/2007', 'KH09', 'NV04', '70000')
INSERT INTO HOADON(SOHD, NGHD, MAKH, MANV, TRIGIA) VALUES('1021', '16/01/2007', 'KH10', 'NV03', '67500')
INSERT INTO HOADON(SOHD, NGHD, MAKH, MANV, TRIGIA) VALUES('1022', '16/01/2007',  NULL, 'NV03', '7000')
INSERT INTO HOADON(SOHD, NGHD, MAKH, MANV, TRIGIA) VALUES('1023', '17/01/2007',  NULL, 'NV01', '330000')
GO

----------------------------------- CTHD ----------------------------------------------
INSERT INTO CTHD(SOHD, MASP, SL) VALUES('1001', 'TV02', '10')
INSERT INTO CTHD(SOHD, MASP, SL) VALUES('1001', 'ST01', '5')
INSERT INTO CTHD(SOHD, MASP, SL) VALUES('1001', 'BC01', '5')
INSERT INTO CTHD(SOHD, MASP, SL) VALUES('1001', 'BC02', '10')
INSERT INTO CTHD(SOHD, MASP, SL) VALUES('1001', 'ST08', '10')
INSERT INTO CTHD(SOHD, MASP, SL) VALUES('1001', 'BC04', '20')
INSERT INTO CTHD(SOHD, MASP, SL) VALUES('1002', 'BB01', '20')
INSERT INTO CTHD(SOHD, MASP, SL) VALUES('1002', 'BB02', '20')
INSERT INTO CTHD(SOHD, MASP, SL) VALUES('1003', 'BB03', '10')
INSERT INTO CTHD(SOHD, MASP, SL) VALUES('1004', 'TV01', '20')
INSERT INTO CTHD(SOHD, MASP, SL) VALUES('1004', 'TV02', '10')
INSERT INTO CTHD(SOHD, MASP, SL) VALUES('1004', 'TV03', '10')
INSERT INTO CTHD(SOHD, MASP, SL) VALUES('1004', 'TV04', '10')
INSERT INTO CTHD(SOHD, MASP, SL) VALUES('1005', 'TV05', '50')
INSERT INTO CTHD(SOHD, MASP, SL) VALUES('1005', 'TV06', '50')
INSERT INTO CTHD(SOHD, MASP, SL) VALUES('1006', 'TV07', '20')
INSERT INTO CTHD(SOHD, MASP, SL) VALUES('1006', 'ST01', '30')
INSERT INTO CTHD(SOHD, MASP, SL) VALUES('1006', 'ST02', '10')
INSERT INTO CTHD(SOHD, MASP, SL) VALUES('1007', 'ST03', '10')
INSERT INTO CTHD(SOHD, MASP, SL) VALUES('1008', 'ST04', '8')
INSERT INTO CTHD(SOHD, MASP, SL) VALUES('1009', 'ST05', '10')
INSERT INTO CTHD(SOHD, MASP, SL) VALUES('1010', 'TV07', '50')
INSERT INTO CTHD(SOHD, MASP, SL) VALUES('1010', 'ST07', '50')
INSERT INTO CTHD(SOHD, MASP, SL) VALUES('1010', 'ST08', '100')
INSERT INTO CTHD(SOHD, MASP, SL) VALUES('1010', 'ST04', '50')
INSERT INTO CTHD(SOHD, MASP, SL) VALUES('1010', 'TV03', '100')
INSERT INTO CTHD(SOHD, MASP, SL) VALUES('1011', 'ST06', '50')
INSERT INTO CTHD(SOHD, MASP, SL) VALUES('1012', 'ST07', '3')
INSERT INTO CTHD(SOHD, MASP, SL) VALUES('1013', 'ST08', '5')
INSERT INTO CTHD(SOHD, MASP, SL) VALUES('1014', 'BC02', '80')
INSERT INTO CTHD(SOHD, MASP, SL) VALUES('1014', 'BB02', '100')
INSERT INTO CTHD(SOHD, MASP, SL) VALUES('1014', 'BC04', '60')
INSERT INTO CTHD(SOHD, MASP, SL) VALUES('1014', 'BB01', '50')
INSERT INTO CTHD(SOHD, MASP, SL) VALUES('1015', 'BB02', '30')
INSERT INTO CTHD(SOHD, MASP, SL) VALUES('1015', 'BB03', '7')
INSERT INTO CTHD(SOHD, MASP, SL) VALUES('1016', 'TV01', '5')
INSERT INTO CTHD(SOHD, MASP, SL) VALUES('1017', 'TV02', '1')
INSERT INTO CTHD(SOHD, MASP, SL) VALUES('1017', 'TV03', '1')
INSERT INTO CTHD(SOHD, MASP, SL) VALUES('1017', 'TV04', '5')
INSERT INTO CTHD(SOHD, MASP, SL) VALUES('1018', 'ST04', '6')
INSERT INTO CTHD(SOHD, MASP, SL) VALUES('1019', 'ST05', '1')
INSERT INTO CTHD(SOHD, MASP, SL) VALUES('1019', 'ST06', '2')
INSERT INTO CTHD(SOHD, MASP, SL) VALUES('1020', 'ST07', '10')
INSERT INTO CTHD(SOHD, MASP, SL) VALUES('1021', 'ST08', '5')
INSERT INTO CTHD(SOHD, MASP, SL) VALUES('1021', 'TV01', '7')
INSERT INTO CTHD(SOHD, MASP, SL) VALUES('1021', 'TV02', '10')
INSERT INTO CTHD(SOHD, MASP, SL) VALUES('1022', 'ST07', '1')
INSERT INTO CTHD(SOHD, MASP, SL) VALUES('1023', 'ST04', '6')


----------------------------------- KHOA ----------------------------------------------
/*
INSERT KHOA (MAKHOA, TENKHOA, NGTLAP, TRGKHOA) VALUES (N'KHMT', N'Khoa hoc may tinh', CAST(N'2005-06-07T00:00:00.000' AS DateTime), N'GV01')
INSERT KHOA (MAKHOA, TENKHOA, NGTLAP, TRGKHOA) VALUES (N'HTTT', N'He thong thong tin', CAST(N'2005-06-07T00:00:00.000' AS DateTime), N'GV02')
INSERT KHOA (MAKHOA, TENKHOA, NGTLAP, TRGKHOA) VALUES (N'CNPM', N'Cong nghe phan mem', CAST(N'2005-06-07T00:00:00.000' AS DateTime), N'GV04')
INSERT KHOA (MAKHOA, TENKHOA, NGTLAP, TRGKHOA) VALUES (N'MTT', N'Mang va truyen thong', CAST(N'2005-10-20T00:00:00.000' AS DateTime), N'GV03')
INSERT KHOA (MAKHOA, TENKHOA, NGTLAP, TRGKHOA) VALUES (N'KTMT', N'Ky thuat may tinh', CAST(N'2005-12-20T00:00:00.000' AS DateTime), N'Null')
*/

INSERT KHOA (MAKHOA, TENKHOA, NGTLAP, TRGKHOA) VALUES (N'KHMT', N'Khoa hoc may tinh', CAST(N'2005-06-07T00:00:00.000' AS DateTime), NULL)
INSERT KHOA (MAKHOA, TENKHOA, NGTLAP, TRGKHOA) VALUES (N'HTTT', N'He thong thong tin', CAST(N'2005-06-07T00:00:00.000' AS DateTime), NULL)
INSERT KHOA (MAKHOA, TENKHOA, NGTLAP, TRGKHOA) VALUES (N'CNPM', N'Cong nghe phan mem', CAST(N'2005-06-07T00:00:00.000' AS DateTime), NULL)
INSERT KHOA (MAKHOA, TENKHOA, NGTLAP, TRGKHOA) VALUES (N'MTT', N'Mang va truyen thong', CAST(N'2005-10-20T00:00:00.000' AS DateTime), NULL)
INSERT KHOA (MAKHOA, TENKHOA, NGTLAP, TRGKHOA) VALUES (N'KTMT', N'Ky thuat may tinh', CAST(N'2005-12-20T00:00:00.000' AS DateTime), NULL)
GO

---------------------------------- MONHOC ---------------------------------------------
INSERT MONHOC (MAMH, TENMH, TCLT, TCTH, MAKHOA) VALUES (N'THDC', N'Tin hoc dai cuong', 4, 1, N'KHMT')
INSERT MONHOC (MAMH, TENMH, TCLT, TCTH, MAKHOA) VALUES (N'CTRR', N'Cau truc roi rac', 5, 0, N'KHMT')
INSERT MONHOC (MAMH, TENMH, TCLT, TCTH, MAKHOA) VALUES (N'CSDL', N'Co so du lieu', 3, 1, N'HTTT')
INSERT MONHOC (MAMH, TENMH, TCLT, TCTH, MAKHOA) VALUES (N'CTDLGT', N'Cau truc du lieu va giai thuat', 3, 1, N'KHMT')
INSERT MONHOC (MAMH, TENMH, TCLT, TCTH, MAKHOA) VALUES (N'PTTKTT', N'Phan tich thiet ke thuat toan', 3, 0, N'KHMT')
INSERT MONHOC (MAMH, TENMH, TCLT, TCTH, MAKHOA) VALUES (N'DHMT', N'Do hoa may tinh', 3, 1, N'KHMT')
INSERT MONHOC (MAMH, TENMH, TCLT, TCTH, MAKHOA) VALUES (N'KTMT', N'Kien truc may tinh', 3, 0, N'KTMT')
INSERT MONHOC (MAMH, TENMH, TCLT, TCTH, MAKHOA) VALUES (N'TKCSDL', N'Thiet ke co so du lieu', 3, 1, N'HTTT')
INSERT MONHOC (MAMH, TENMH, TCLT, TCTH, MAKHOA) VALUES (N'PTTKHTTT', N'Phan tich thiet ke he thong thong tin', 4, 1, N'HTTT')
INSERT MONHOC (MAMH, TENMH, TCLT, TCTH, MAKHOA) VALUES (N'HDH', N'He dieu hanh', 4, 0, N'KTMT')
INSERT MONHOC (MAMH, TENMH, TCLT, TCTH, MAKHOA) VALUES (N'NMCNPM', N'Nhap mon cong nghe phan mem', 3, 0, N'CNPM')
INSERT MONHOC (MAMH, TENMH, TCLT, TCTH, MAKHOA) VALUES (N'LTCFW', N'Lap trinh C for win', 3, 1, N'CNPM')
INSERT MONHOC (MAMH, TENMH, TCLT, TCTH, MAKHOA) VALUES (N'LTHDT', N'Lap trinh huong doi tuong', 3, 1, N'CNPM')
GO

--------------------------------- DIEUKIEN --------------------------------------------
INSERT DIEUKIEN (MAMH, MAMH_TRUOC) VALUES (N'CSDL', N'CTRR')
INSERT DIEUKIEN (MAMH, MAMH_TRUOC) VALUES (N'CSDL', N'CTDLGT')
INSERT DIEUKIEN (MAMH, MAMH_TRUOC) VALUES (N'CTDLGT', N'THDC')
INSERT DIEUKIEN (MAMH, MAMH_TRUOC) VALUES (N'PTTKTT', N'THDC')
INSERT DIEUKIEN (MAMH, MAMH_TRUOC) VALUES (N'PTTKTT', N'CTDLGT')
INSERT DIEUKIEN (MAMH, MAMH_TRUOC) VALUES (N'DHMT', N'THDC')
INSERT DIEUKIEN (MAMH, MAMH_TRUOC) VALUES (N'LTHDT', N'THDC')
INSERT DIEUKIEN (MAMH, MAMH_TRUOC) VALUES (N'PTTKHTTT', N'CSDL')
GO

--------------------------------- GIAOVIEN --------------------------------------------
/*
INSERT GIAOVIEN (MAGV, HOTEN, HOCVI, HOCHAM, GIOITINH, NGSINH, NGVL, HESO, MUCLUONG, MAKHOA) VALUES (N'GV01', N'Ho Thanh Son', N'PTS', N'GS', N'Nam', CAST(N'1950-05-02T00:00:00.000' AS DateTime), CAST(N'2004-01-11T00:00:00.000' AS DateTime), 5, 2250000, N'KHMT')
INSERT GIAOVIEN (MAGV, HOTEN, HOCVI, HOCHAM, GIOITINH, NGSINH, NGVL, HESO, MUCLUONG, MAKHOA) VALUES (N'GV02', N'Tran Tam Thanh', N'TS', N'PGS', N'Nam', CAST(N'1965-12-17T00:00:00.000' AS DateTime), CAST(N'2004-04-20T00:00:00.000' AS DateTime), 4.5, 2025000, N'HTTT')
INSERT GIAOVIEN (MAGV, HOTEN, HOCVI, HOCHAM, GIOITINH, NGSINH, NGVL, HESO, MUCLUONG, MAKHOA) VALUES (N'GV03', N'Do Nghiem Phung', N'TS', N'GS', N'Nu', CAST(N'1950-08-01T00:00:00.000' AS DateTime), CAST(N'2004-09-23T00:00:00.000' AS DateTime), 4, 1800000, N'CNPM')
INSERT GIAOVIEN (MAGV, HOTEN, HOCVI, HOCHAM, GIOITINH, NGSINH, NGVL, HESO, MUCLUONG, MAKHOA) VALUES (N'GV04', N'Tran Nam Son', N'TS', N'PGS', N'Nam', CAST(N'1961-02-22T00:00:00.000' AS DateTime), CAST(N'2005-01-12T00:00:00.000' AS DateTime), 4.5, 2025000, N'KTMT')
INSERT GIAOVIEN (MAGV, HOTEN, HOCVI, HOCHAM, GIOITINH, NGSINH, NGVL, HESO, MUCLUONG, MAKHOA) VALUES (N'GV05', N'Mai Thanh Danh', N'ThS', N'GV', N'Nam', CAST(N'1958-03-12T00:00:00.000' AS DateTime), CAST(N'2005-01-12T00:00:00.000' AS DateTime), 3, 1350000, N'HTTT')
INSERT GIAOVIEN (MAGV, HOTEN, HOCVI, HOCHAM, GIOITINH, NGSINH, NGVL, HESO, MUCLUONG, MAKHOA) VALUES (N'GV06', N'Tran Doan Hung', N'TS', N'GV', N'Nam', CAST(N'1953-03-11T00:00:00.000' AS DateTime), CAST(N'2005-01-12T00:00:00.000' AS DateTime), 4.5, 2025000, N'KHMT')
INSERT GIAOVIEN (MAGV, HOTEN, HOCVI, HOCHAM, GIOITINH, NGSINH, NGVL, HESO, MUCLUONG, MAKHOA) VALUES (N'GV07', N'Nguyen Minh Tien', N'ThS', N'GV', N'Nam', CAST(N'1971-11-23T00:00:00.000' AS DateTime), CAST(N'2005-03-01T00:00:00.000' AS DateTime), 4, 1800000, N'KHMT')
INSERT GIAOVIEN (MAGV, HOTEN, HOCVI, HOCHAM, GIOITINH, NGSINH, NGVL, HESO, MUCLUONG, MAKHOA) VALUES (N'GV08', N'Le Thi Tran', N'KS', N'Null', N'Nu', CAST(N'1974-03-26T00:00:00.000' AS DateTime), CAST(N'2005-03-01T00:00:00.000' AS DateTime), 1.69, 760500, N'KHMT')
INSERT GIAOVIEN (MAGV, HOTEN, HOCVI, HOCHAM, GIOITINH, NGSINH, NGVL, HESO, MUCLUONG, MAKHOA) VALUES (N'GV09', N'Nguyen To Lan', N'ThS', N'GV', N'Nu', CAST(N'1966-12-31T00:00:00.000' AS DateTime), CAST(N'2005-03-01T00:00:00.000' AS DateTime), 4, 1800000, N'HTTT')
INSERT GIAOVIEN (MAGV, HOTEN, HOCVI, HOCHAM, GIOITINH, NGSINH, NGVL, HESO, MUCLUONG, MAKHOA) VALUES (N'GV10', N'Le Tran Anh Loan', N'KS', N'Null', N'Nu', CAST(N'1972-07-17T00:00:00.000' AS DateTime), CAST(N'2005-03-01T00:00:00.000' AS DateTime), 1.86, 837000, N'CNPM')
INSERT GIAOVIEN (MAGV, HOTEN, HOCVI, HOCHAM, GIOITINH, NGSINH, NGVL, HESO, MUCLUONG, MAKHOA) VALUES (N'GV11', N'Ho Thanh Tung', N'CN', N'GV', N'Nam', CAST(N'1980-01-12T00:00:00.000' AS DateTime), CAST(N'2005-05-15T00:00:00.000' AS DateTime), 2.67, 1201500, N'MTT')
INSERT GIAOVIEN (MAGV, HOTEN, HOCVI, HOCHAM, GIOITINH, NGSINH, NGVL, HESO, MUCLUONG, MAKHOA) VALUES (N'GV12', N'Tran Van Anh', N'CN', N'Null', N'Nu', CAST(N'1981-03-29T00:00:00.000' AS DateTime), CAST(N'2005-05-15T00:00:00.000' AS DateTime), 1.69, 760500, N'CNPM')
INSERT GIAOVIEN (MAGV, HOTEN, HOCVI, HOCHAM, GIOITINH, NGSINH, NGVL, HESO, MUCLUONG, MAKHOA) VALUES (N'GV13', N'Nguyen Linh Dan', N'CN', N'Null', N'Nu', CAST(N'1980-05-23T00:00:00.000' AS DateTime), CAST(N'2005-05-15T00:00:00.000' AS DateTime), 1.69, 760500, N'KTMT')
INSERT GIAOVIEN (MAGV, HOTEN, HOCVI, HOCHAM, GIOITINH, NGSINH, NGVL, HESO, MUCLUONG, MAKHOA) VALUES (N'GV14', N'Truong Minh Chau', N'ThS', N'GV', N'Nu', CAST(N'1976-11-30T00:00:00.000' AS DateTime), CAST(N'2005-05-15T00:00:00.000' AS DateTime), 3, 1350000, N'MTT')
INSERT GIAOVIEN (MAGV, HOTEN, HOCVI, HOCHAM, GIOITINH, NGSINH, NGVL, HESO, MUCLUONG, MAKHOA) VALUES (N'GV15', N'Le Ha Thanh', N'ThS', N'GV', N'Nam', CAST(N'1978-05-04T00:00:00.000' AS DateTime), CAST(N'2005-05-15T00:00:00.000' AS DateTime), 3, 1350000, N'KHMT')
*/
INSERT GIAOVIEN (MAGV, HOTEN, HOCVI, HOCHAM, GIOITINH, NGSINH, NGVL, HESO, MUCLUONG, MAKHOA) VALUES (N'GV01', N'Ho Thanh Son', N'PTS', N'GS', N'Nam', CAST(N'1950-05-02T00:00:00.000' AS DateTime), CAST(N'2004-01-11T00:00:00.000' AS DateTime), 5, 2250000, NULL)
INSERT GIAOVIEN (MAGV, HOTEN, HOCVI, HOCHAM, GIOITINH, NGSINH, NGVL, HESO, MUCLUONG, MAKHOA) VALUES (N'GV02', N'Tran Tam Thanh', N'TS', N'PGS', N'Nam', CAST(N'1965-12-17T00:00:00.000' AS DateTime), CAST(N'2004-04-20T00:00:00.000' AS DateTime), 4.5, 2025000, NULL)
INSERT GIAOVIEN (MAGV, HOTEN, HOCVI, HOCHAM, GIOITINH, NGSINH, NGVL, HESO, MUCLUONG, MAKHOA) VALUES (N'GV03', N'Do Nghiem Phung', N'TS', N'GS', N'Nu', CAST(N'1950-08-01T00:00:00.000' AS DateTime), CAST(N'2004-09-23T00:00:00.000' AS DateTime), 4, 1800000, NULL)
INSERT GIAOVIEN (MAGV, HOTEN, HOCVI, HOCHAM, GIOITINH, NGSINH, NGVL, HESO, MUCLUONG, MAKHOA) VALUES (N'GV04', N'Tran Nam Son', N'TS', N'PGS', N'Nam', CAST(N'1961-02-22T00:00:00.000' AS DateTime), CAST(N'2005-01-12T00:00:00.000' AS DateTime), 4.5, 2025000, NULL)
INSERT GIAOVIEN (MAGV, HOTEN, HOCVI, HOCHAM, GIOITINH, NGSINH, NGVL, HESO, MUCLUONG, MAKHOA) VALUES (N'GV05', N'Mai Thanh Danh', N'ThS', N'GV', N'Nam', CAST(N'1958-03-12T00:00:00.000' AS DateTime), CAST(N'2005-01-12T00:00:00.000' AS DateTime), 3, 1350000, NULL)
INSERT GIAOVIEN (MAGV, HOTEN, HOCVI, HOCHAM, GIOITINH, NGSINH, NGVL, HESO, MUCLUONG, MAKHOA) VALUES (N'GV06', N'Tran Doan Hung', N'TS', N'GV', N'Nam', CAST(N'1953-03-11T00:00:00.000' AS DateTime), CAST(N'2005-01-12T00:00:00.000' AS DateTime), 4.5, 2025000, NULL)
INSERT GIAOVIEN (MAGV, HOTEN, HOCVI, HOCHAM, GIOITINH, NGSINH, NGVL, HESO, MUCLUONG, MAKHOA) VALUES (N'GV07', N'Nguyen Minh Tien', N'ThS', N'GV', N'Nam', CAST(N'1971-11-23T00:00:00.000' AS DateTime), CAST(N'2005-03-01T00:00:00.000' AS DateTime), 4, 1800000, NULL)
INSERT GIAOVIEN (MAGV, HOTEN, HOCVI, HOCHAM, GIOITINH, NGSINH, NGVL, HESO, MUCLUONG, MAKHOA) VALUES (N'GV08', N'Le Thi Tran', N'KS', N'Null', N'Nu', CAST(N'1974-03-26T00:00:00.000' AS DateTime), CAST(N'2005-03-01T00:00:00.000' AS DateTime), 1.69, 760500, NULL)
INSERT GIAOVIEN (MAGV, HOTEN, HOCVI, HOCHAM, GIOITINH, NGSINH, NGVL, HESO, MUCLUONG, MAKHOA) VALUES (N'GV09', N'Nguyen To Lan', N'ThS', N'GV', N'Nu', CAST(N'1966-12-31T00:00:00.000' AS DateTime), CAST(N'2005-03-01T00:00:00.000' AS DateTime), 4, 1800000, NULL)
INSERT GIAOVIEN (MAGV, HOTEN, HOCVI, HOCHAM, GIOITINH, NGSINH, NGVL, HESO, MUCLUONG, MAKHOA) VALUES (N'GV10', N'Le Tran Anh Loan', N'KS', N'Null', N'Nu', CAST(N'1972-07-17T00:00:00.000' AS DateTime), CAST(N'2005-03-01T00:00:00.000' AS DateTime), 1.86, 837000, NULL)
INSERT GIAOVIEN (MAGV, HOTEN, HOCVI, HOCHAM, GIOITINH, NGSINH, NGVL, HESO, MUCLUONG, MAKHOA) VALUES (N'GV11', N'Ho Thanh Tung', N'CN', N'GV', N'Nam', CAST(N'1980-01-12T00:00:00.000' AS DateTime), CAST(N'2005-05-15T00:00:00.000' AS DateTime), 2.67, 1201500, NULL)
INSERT GIAOVIEN (MAGV, HOTEN, HOCVI, HOCHAM, GIOITINH, NGSINH, NGVL, HESO, MUCLUONG, MAKHOA) VALUES (N'GV12', N'Tran Van Anh', N'CN', N'Null', N'Nu', CAST(N'1981-03-29T00:00:00.000' AS DateTime), CAST(N'2005-05-15T00:00:00.000' AS DateTime), 1.69, 760500, NULL)
INSERT GIAOVIEN (MAGV, HOTEN, HOCVI, HOCHAM, GIOITINH, NGSINH, NGVL, HESO, MUCLUONG, MAKHOA) VALUES (N'GV13', N'Nguyen Linh Dan', N'CN', N'Null', N'Nu', CAST(N'1980-05-23T00:00:00.000' AS DateTime), CAST(N'2005-05-15T00:00:00.000' AS DateTime), 1.69, 760500, NULL)
INSERT GIAOVIEN (MAGV, HOTEN, HOCVI, HOCHAM, GIOITINH, NGSINH, NGVL, HESO, MUCLUONG, MAKHOA) VALUES (N'GV14', N'Truong Minh Chau', N'ThS', N'GV', N'Nu', CAST(N'1976-11-30T00:00:00.000' AS DateTime), CAST(N'2005-05-15T00:00:00.000' AS DateTime), 3, 1350000, NULL)
INSERT GIAOVIEN (MAGV, HOTEN, HOCVI, HOCHAM, GIOITINH, NGSINH, NGVL, HESO, MUCLUONG, MAKHOA) VALUES (N'GV15', N'Le Ha Thanh', N'ThS', N'GV', N'Nam', CAST(N'1978-05-04T00:00:00.000' AS DateTime), CAST(N'2005-05-15T00:00:00.000' AS DateTime), 3, 1350000, NULL)
GO

----------------------------------- LOP -----------------------------------------------
INSERT LOP (MALOP, TENLOP, TRGLOP, SISO, MAGVCN) VALUES (N'K11', N'Lop 1 khoa 1', N'K1108', 11, N'GV07')
INSERT LOP (MALOP, TENLOP, TRGLOP, SISO, MAGVCN) VALUES (N'K12', N'Lop 2 khoa 1', N'K1205', 12, N'GV09')
INSERT LOP (MALOP, TENLOP, TRGLOP, SISO, MAGVCN) VALUES (N'K13', N'Lop 3 khoa 1', N'K1305', 12, N'GV14')
GO

--------------------------------- HOCVIEN ---------------------------------------------
INSERT HOCVIEN (MAHV, HO, TEN, NGSINH, GIOITINH, NOISINH, MALOP) VALUES (N'K1101', N'Nguyen Van', N'A', CAST(N'1986-01-27T00:00:00.000' AS DateTime), N'Nam', N'TpHCM', N'K11')
INSERT HOCVIEN (MAHV, HO, TEN, NGSINH, GIOITINH, NOISINH, MALOP) VALUES (N'K1102', N'Tran Ngoc', N'Han', CAST(N'1986-03-14T00:00:00.000' AS DateTime), N'Nu', N'Kien Giang', N'K11')
INSERT HOCVIEN (MAHV, HO, TEN, NGSINH, GIOITINH, NOISINH, MALOP) VALUES (N'K1103', N'Ha Duy', N'Lap', CAST(N'1986-04-18T00:00:00.000' AS DateTime), N'Nam', N'Nghe An', N'K11')
INSERT HOCVIEN (MAHV, HO, TEN, NGSINH, GIOITINH, NOISINH, MALOP) VALUES (N'K1104', N'Tran Ngoc', N'Linh', CAST(N'1986-03-30T00:00:00.000' AS DateTime), N'Nu', N'Tay Ninh', N'K11')
INSERT HOCVIEN (MAHV, HO, TEN, NGSINH, GIOITINH, NOISINH, MALOP) VALUES (N'K1105', N'Tran Minh', N'Long', CAST(N'1986-02-27T00:00:00.000' AS DateTime), N'Nam', N'TpHCM', N'K11')
INSERT HOCVIEN (MAHV, HO, TEN, NGSINH, GIOITINH, NOISINH, MALOP) VALUES (N'K1106', N'Le Nhat', N'Minh', CAST(N'1986-01-24T00:00:00.000' AS DateTime), N'Nam', N'TpHCM', N'K11')
INSERT HOCVIEN (MAHV, HO, TEN, NGSINH, GIOITINH, NOISINH, MALOP) VALUES (N'K1107', N'Nguyen Nhu', N'Nhut', CAST(N'1986-01-27T00:00:00.000' AS DateTime), N'Nam', N'Ha Noi', N'K11')
INSERT HOCVIEN (MAHV, HO, TEN, NGSINH, GIOITINH, NOISINH, MALOP) VALUES (N'K1108', N'Nguyen Manh', N'Tam', CAST(N'1986-02-27T00:00:00.000' AS DateTime), N'Nam', N'Kien Giang', N'K11')
INSERT HOCVIEN (MAHV, HO, TEN, NGSINH, GIOITINH, NOISINH, MALOP) VALUES (N'K1109', N'Phan Thi Thanh', N'Tam', CAST(N'1986-01-27T00:00:00.000' AS DateTime), N'Nu', N'Vinh Long', N'K11')
INSERT HOCVIEN (MAHV, HO, TEN, NGSINH, GIOITINH, NOISINH, MALOP) VALUES (N'K1110', N'Le Hoai', N'Thuong', CAST(N'1986-02-05T00:00:00.000' AS DateTime), N'Nu', N'Can Tho', N'K11')
INSERT HOCVIEN (MAHV, HO, TEN, NGSINH, GIOITINH, NOISINH, MALOP) VALUES (N'K1111', N'Le Ha', N'Vinh', CAST(N'1986-12-25T00:00:00.000' AS DateTime), N'Nam', N'Vinh Long', N'K11')
INSERT HOCVIEN (MAHV, HO, TEN, NGSINH, GIOITINH, NOISINH, MALOP) VALUES (N'K1201', N'Nguyen Van', N'B', CAST(N'1986-02-11T00:00:00.000' AS DateTime), N'Nam', N'TpHCM', N'K12')
INSERT HOCVIEN (MAHV, HO, TEN, NGSINH, GIOITINH, NOISINH, MALOP) VALUES (N'K1202', N'Nguyen Thi Kim', N'Duyen', CAST(N'1986-01-18T00:00:00.000' AS DateTime), N'Nu', N'TpHCM', N'K12')
INSERT HOCVIEN (MAHV, HO, TEN, NGSINH, GIOITINH, NOISINH, MALOP) VALUES (N'K1203', N'Tran Thi Kim', N'Duyen', CAST(N'1986-09-17T00:00:00.000' AS DateTime), N'Nu', N'TpHCM', N'K12')
INSERT HOCVIEN (MAHV, HO, TEN, NGSINH, GIOITINH, NOISINH, MALOP) VALUES (N'K1204', N'Truong My', N'Hanh', CAST(N'1986-05-19T00:00:00.000' AS DateTime), N'Nu', N'Dong Nai', N'K12')
INSERT HOCVIEN (MAHV, HO, TEN, NGSINH, GIOITINH, NOISINH, MALOP) VALUES (N'K1205', N'Nguyen Thanh', N'Nam', CAST(N'1986-04-17T00:00:00.000' AS DateTime), N'Nam', N'TpHCM', N'K12')
INSERT HOCVIEN (MAHV, HO, TEN, NGSINH, GIOITINH, NOISINH, MALOP) VALUES (N'K1206', N'Nguyen Thi Truc', N'Thanh', CAST(N'1986-03-04T00:00:00.000' AS DateTime), N'Nu', N'Kien Giang', N'K12')
INSERT HOCVIEN (MAHV, HO, TEN, NGSINH, GIOITINH, NOISINH, MALOP) VALUES (N'K1207', N'Tran Thi Bich', N'Thuy', CAST(N'1986-02-08T00:00:00.000' AS DateTime), N'Nu', N'Nghe An', N'K12')
INSERT HOCVIEN (MAHV, HO, TEN, NGSINH, GIOITINH, NOISINH, MALOP) VALUES (N'K1208', N'Huynh Thi Kim', N'Trieu', CAST(N'1986-04-08T00:00:00.000' AS DateTime), N'Nu', N'Tay Ninh', N'K12')
INSERT HOCVIEN (MAHV, HO, TEN, NGSINH, GIOITINH, NOISINH, MALOP) VALUES (N'K1209', N'Pham Thanh', N'Trieu', CAST(N'1986-02-23T00:00:00.000' AS DateTime), N'Nam', N'TpHCM', N'K12')
INSERT HOCVIEN (MAHV, HO, TEN, NGSINH, GIOITINH, NOISINH, MALOP) VALUES (N'K1210', N'Ngo Thanh', N'Tuan', CAST(N'1986-02-14T00:00:00.000' AS DateTime), N'Nam', N'TpHCM', N'K12')
INSERT HOCVIEN (MAHV, HO, TEN, NGSINH, GIOITINH, NOISINH, MALOP) VALUES (N'K1211', N'Do Thi', N'Xuan', CAST(N'1986-03-09T00:00:00.000' AS DateTime), N'Nu', N'Ha Noi', N'K12')
INSERT HOCVIEN (MAHV, HO, TEN, NGSINH, GIOITINH, NOISINH, MALOP) VALUES (N'K1212', N'Le Thi Phi', N'Yen', CAST(N'1986-03-12T00:00:00.000' AS DateTime), N'Nu', N'TpHCM', N'K12')
INSERT HOCVIEN (MAHV, HO, TEN, NGSINH, GIOITINH, NOISINH, MALOP) VALUES (N'K1301', N'Nguyen Thi Kim', N'Cuc', CAST(N'1986-06-09T00:00:00.000' AS DateTime), N'Nu', N'Kien Giang', N'K13')
INSERT HOCVIEN (MAHV, HO, TEN, NGSINH, GIOITINH, NOISINH, MALOP) VALUES (N'K1302', N'Truong Thi My', N'Hien', CAST(N'1986-03-18T00:00:00.000' AS DateTime), N'Nu', N'Nghe An', N'K13')
INSERT HOCVIEN (MAHV, HO, TEN, NGSINH, GIOITINH, NOISINH, MALOP) VALUES (N'K1303', N'Le Duc', N'Hien', CAST(N'1986-03-21T00:00:00.000' AS DateTime), N'Nam', N'Tay Ninh', N'K13')
INSERT HOCVIEN (MAHV, HO, TEN, NGSINH, GIOITINH, NOISINH, MALOP) VALUES (N'K1304', N'Le Quang', N'Hien', CAST(N'1986-04-18T00:00:00.000' AS DateTime), N'Nam', N'TpHCM', N'K13')
INSERT HOCVIEN (MAHV, HO, TEN, NGSINH, GIOITINH, NOISINH, MALOP) VALUES (N'K1305', N'Le Thi', N'Huong', CAST(N'1986-03-27T00:00:00.000' AS DateTime), N'Nu', N'TpHCM', N'K13')
INSERT HOCVIEN (MAHV, HO, TEN, NGSINH, GIOITINH, NOISINH, MALOP) VALUES (N'K1306', N'Nguyen Thai', N'Huu', CAST(N'1986-03-30T00:00:00.000' AS DateTime), N'Nam', N'Ha Noi', N'K13')
INSERT HOCVIEN (MAHV, HO, TEN, NGSINH, GIOITINH, NOISINH, MALOP) VALUES (N'K1307', N'Tran Minh', N'Man', CAST(N'1986-05-28T00:00:00.000' AS DateTime), N'Nam', N'TpHCM', N'K13')
INSERT HOCVIEN (MAHV, HO, TEN, NGSINH, GIOITINH, NOISINH, MALOP) VALUES (N'K1308', N'Nguyen Hieu', N'Nghia', CAST(N'1986-04-08T00:00:00.000' AS DateTime), N'Nam', N'Kien Giang', N'K13')
INSERT HOCVIEN (MAHV, HO, TEN, NGSINH, GIOITINH, NOISINH, MALOP) VALUES (N'K1309', N'Nguyen Trung', N'Nghia', CAST(N'1987-01-18T00:00:00.000' AS DateTime), N'Nam', N'Nghe An', N'K13')
INSERT HOCVIEN (MAHV, HO, TEN, NGSINH, GIOITINH, NOISINH, MALOP) VALUES (N'K1310', N'Tran Thi Hong', N'Tham', CAST(N'1986-04-22T00:00:00.000' AS DateTime), N'Nu', N'Tay Ninh', N'K13')
INSERT HOCVIEN (MAHV, HO, TEN, NGSINH, GIOITINH, NOISINH, MALOP) VALUES (N'K1311', N'Tran Minh', N'Thuc', CAST(N'1986-04-04T00:00:00.000' AS DateTime), N'Nam', N'TpHCM', N'K13')
INSERT HOCVIEN (MAHV, HO, TEN, NGSINH, GIOITINH, NOISINH, MALOP) VALUES (N'K1312', N'Nguyen Thi Kim', N'Yen', CAST(N'1986-09-07T00:00:00.000' AS DateTime), N'Nu', N'TpHCM', N'K13')
GO

--------------------------------- GIANGDAY --------------------------------------------
INSERT GIANGDAY (MALOP, MAMH, MAGV, HOCKY, NAM, TUNGAY, DENNGAY) VALUES (N'K11', N'THDC', N'GV07', 1, 2006, CAST(N'2006-01-02T00:00:00.000' AS DateTime), CAST(N'2006-05-12T00:00:00.000' AS DateTime))
INSERT GIANGDAY (MALOP, MAMH, MAGV, HOCKY, NAM, TUNGAY, DENNGAY) VALUES (N'K12', N'THDC', N'GV06', 1, 2006, CAST(N'2006-01-02T00:00:00.000' AS DateTime), CAST(N'2006-05-12T00:00:00.000' AS DateTime))
INSERT GIANGDAY (MALOP, MAMH, MAGV, HOCKY, NAM, TUNGAY, DENNGAY) VALUES (N'K13', N'THDC', N'GV15', 1, 2006, CAST(N'2006-01-02T00:00:00.000' AS DateTime), CAST(N'2006-05-12T00:00:00.000' AS DateTime))
INSERT GIANGDAY (MALOP, MAMH, MAGV, HOCKY, NAM, TUNGAY, DENNGAY) VALUES (N'K11', 'CTRR', N'GV02', 1, 2006, CAST(N'2006-01-09T00:00:00.000' AS DateTime), CAST(N'2006-05-17T00:00:00.000' AS DateTime))
INSERT GIANGDAY (MALOP, MAMH, MAGV, HOCKY, NAM, TUNGAY, DENNGAY) VALUES (N'K12', N'CTRR', N'GV02', 1, 2006, CAST(N'2006-01-09T00:00:00.000' AS DateTime), CAST(N'2006-05-17T00:00:00.000' AS DateTime))
INSERT GIANGDAY (MALOP, MAMH, MAGV, HOCKY, NAM, TUNGAY, DENNGAY) VALUES (N'K13', N'CTRR', N'GV08', 1, 2006, CAST(N'2006-01-09T00:00:00.000' AS DateTime), CAST(N'2006-05-17T00:00:00.000' AS DateTime))
INSERT GIANGDAY (MALOP, MAMH, MAGV, HOCKY, NAM, TUNGAY, DENNGAY) VALUES (N'K11', N'CSDL', N'GV05', 2, 2006, CAST(N'2006-06-01T00:00:00.000' AS DateTime), CAST(N'2006-07-15T00:00:00.000' AS DateTime))
INSERT GIANGDAY (MALOP, MAMH, MAGV, HOCKY, NAM, TUNGAY, DENNGAY) VALUES (N'K12', N'CSDL', N'GV09', 2, 2006, CAST(N'2006-06-01T00:00:00.000' AS DateTime), CAST(N'2006-07-15T00:00:00.000' AS DateTime))
INSERT GIANGDAY (MALOP, MAMH, MAGV, HOCKY, NAM, TUNGAY, DENNGAY) VALUES (N'K13', N'CTDLGT', N'GV15', 2, 2006, CAST(N'2006-06-01T00:00:00.000' AS DateTime), CAST(N'2006-07-15T00:00:00.000' AS DateTime))
INSERT GIANGDAY (MALOP, MAMH, MAGV, HOCKY, NAM, TUNGAY, DENNGAY) VALUES (N'K13', N'CSDL', N'GV05', 3, 2006, CAST(N'2006-08-01T00:00:00.000' AS DateTime), CAST(N'2006-12-15T00:00:00.000' AS DateTime))
INSERT GIANGDAY (MALOP, MAMH, MAGV, HOCKY, NAM, TUNGAY, DENNGAY) VALUES (N'K13', N'DHMT', N'GV07', 3, 2006, CAST(N'2006-08-01T00:00:00.000' AS DateTime), CAST(N'2006-12-15T00:00:00.000' AS DateTime))
INSERT GIANGDAY (MALOP, MAMH, MAGV, HOCKY, NAM, TUNGAY, DENNGAY) VALUES (N'K11', N'CTDLGT', N'GV15', 3, 2006, CAST(N'2006-08-01T00:00:00.000' AS DateTime), CAST(N'2006-12-15T00:00:00.000' AS DateTime))
INSERT GIANGDAY (MALOP, MAMH, MAGV, HOCKY, NAM, TUNGAY, DENNGAY) VALUES (N'K12', N'CTDLGT', N'GV15', 3, 2006, CAST(N'2006-08-01T00:00:00.000' AS DateTime), CAST(N'2006-12-15T00:00:00.000' AS DateTime))
INSERT GIANGDAY (MALOP, MAMH, MAGV, HOCKY, NAM, TUNGAY, DENNGAY) VALUES (N'K11', N'HDH', N'GV04', 1, 2007, CAST(N'2007-01-02T00:00:00.000' AS DateTime), CAST(N'2007-02-18T00:00:00.000' AS DateTime))
INSERT GIANGDAY (MALOP, MAMH, MAGV, HOCKY, NAM, TUNGAY, DENNGAY) VALUES (N'K12', N'HDH', N'GV04', 1, 2007, CAST(N'2007-01-02T00:00:00.000' AS DateTime), CAST(N'2007-03-20T00:00:00.000' AS DateTime))
INSERT GIANGDAY (MALOP, MAMH, MAGV, HOCKY, NAM, TUNGAY, DENNGAY) VALUES (N'K11', N'DHMT', N'GV07', 1, 2007, CAST(N'2007-02-18T00:00:00.000' AS DateTime), CAST(N'2007-03-20T00:00:00.000' AS DateTime))
GO

--------------------------------- KETQUATHI -------------------------------------------
INSERT KETQUATHI (MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES (N'K1101', N'CSDL', 1, CAST(N'2006-07-20T00:00:00.000' AS DateTime), 10, N'Dat')
INSERT KETQUATHI (MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES (N'K1101', N'CTDLGT', 1, CAST(N'2006-12-28T00:00:00.000' AS DateTime), 9, N'Dat')
INSERT KETQUATHI (MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES (N'K1101', N'THDC', 1, CAST(N'2006-05-20T00:00:00.000' AS DateTime), 9, N'Dat')
INSERT KETQUATHI (MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES (N'K1101', N'CTRR', 1, CAST(N'2006-05-13T00:00:00.000' AS DateTime), 9.5, N'Dat')
INSERT KETQUATHI (MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES (N'K1102', N'CSDL', 1, CAST(N'2006-07-20T00:00:00.000' AS DateTime), 4, N'Khong Dat')
INSERT KETQUATHI (MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES (N'K1102', N'CSDL', 2, CAST(N'2006-07-27T00:00:00.000' AS DateTime), 4.25, N'Khong Dat')
INSERT KETQUATHI (MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES (N'K1102', N'CSDL', 3, CAST(N'2006-08-10T00:00:00.000' AS DateTime), 4.5, N'Khong Dat')
INSERT KETQUATHI (MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES (N'K1102', N'CTDLGT', 1, CAST(N'2006-12-28T00:00:00.000' AS DateTime), 4.5, N'Khong Dat')
INSERT KETQUATHI (MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES (N'K1102', N'CTDLGT', 2, CAST(N'2007-01-05T00:00:00.000' AS DateTime), 4, N'Khong Dat')
INSERT KETQUATHI (MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES (N'K1102', N'CTDLGT', 3, CAST(N'2007-01-15T00:00:00.000' AS DateTime), 6, N'Dat')
INSERT KETQUATHI (MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES (N'K1102', N'THDC', 1, CAST(N'2006-05-20T00:00:00.000' AS DateTime), 5, N'Dat')
INSERT KETQUATHI (MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES (N'K1102', N'CTRR', 1, CAST(N'2006-05-13T00:00:00.000' AS DateTime), 7, N'Dat')
INSERT KETQUATHI (MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES (N'K1103', N'CSDL', 1, CAST(N'2006-07-20T00:00:00.000' AS DateTime), 3.5, N'Khong Dat')
INSERT KETQUATHI (MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES (N'K1103', N'CSDL', 2, CAST(N'2006-07-27T00:00:00.000' AS DateTime), 8.25, N'Dat')
INSERT KETQUATHI (MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES (N'K1103', N'CTDLGT', 1, CAST(N'2006-12-28T00:00:00.000' AS DateTime), 7, N'Dat')
INSERT KETQUATHI (MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES (N'K1103', N'THDC', 1, CAST(N'2006-05-20T00:00:00.000' AS DateTime), 8, N'Dat')
INSERT KETQUATHI (MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES (N'K1103', N'CTRR', 1, CAST(N'2006-05-13T00:00:00.000' AS DateTime), 6.5, N'Dat')
INSERT KETQUATHI (MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES (N'K1104', N'CSDL', 1, CAST(N'2006-07-20T00:00:00.000' AS DateTime), 3.75, N'Khong Dat')
INSERT KETQUATHI (MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES (N'K1104', N'CTDLGT', 1, CAST(N'2006-12-28T00:00:00.000' AS DateTime), 4, N'Khong Dat')
INSERT KETQUATHI (MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES (N'K1104', N'THDC', 1, CAST(N'2006-05-20T00:00:00.000' AS DateTime), 4, N'Khong Dat')
INSERT KETQUATHI (MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES (N'K1104', N'CTRR', 1, CAST(N'2006-05-13T00:00:00.000' AS DateTime), 4, N'Khong Dat')
INSERT KETQUATHI (MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES (N'K1104', N'CTRR', 2, CAST(N'2006-05-20T00:00:00.000' AS DateTime), 3.5, N'Khong Dat')
INSERT KETQUATHI (MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES (N'K1104', N'CTRR', 3, CAST(N'2006-06-30T00:00:00.000' AS DateTime), 4, N'Khong Dat')
INSERT KETQUATHI (MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES (N'K1201', N'CSDL', 1, CAST(N'2006-07-20T00:00:00.000' AS DateTime), 6, N'Dat')
INSERT KETQUATHI (MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES (N'K1201', N'CTDLGT', 1, CAST(N'2006-12-28T00:00:00.000' AS DateTime), 5, N'Dat')
INSERT KETQUATHI (MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES (N'K1201', N'THDC', 1, CAST(N'2006-05-20T00:00:00.000' AS DateTime), 8.5, N'Dat')
INSERT KETQUATHI (MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES (N'K1201', N'CTRR', 1, CAST(N'2006-05-13T00:00:00.000' AS DateTime), 9, N'Dat')
INSERT KETQUATHI (MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES (N'K1202', N'CSDL', 1, CAST(N'2006-07-20T00:00:00.000' AS DateTime), 8, N'Dat')
INSERT KETQUATHI (MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES (N'K1202', N'CTDLGT', 1, CAST(N'2006-12-28T00:00:00.000' AS DateTime), 4, N'Khong Dat')
INSERT KETQUATHI (MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES (N'K1202', N'CTDLGT', 2, CAST(N'2007-01-05T00:00:00.000' AS DateTime), 5, N'Dat')
INSERT KETQUATHI (MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES (N'K1202', N'THDC', 1, CAST(N'2006-05-20T00:00:00.000' AS DateTime), 4, N'Khong Dat')
INSERT KETQUATHI (MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES (N'K1202', N'THDC', 2, CAST(N'2006-05-27T00:00:00.000' AS DateTime), 4, N'Khong Dat')
INSERT KETQUATHI (MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES (N'K1202', N'CTRR', 1, CAST(N'2006-05-13T00:00:00.000' AS DateTime), 3, N'Khong Dat')
INSERT KETQUATHI (MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES (N'K1202', N'CTRR', 2, CAST(N'2006-05-20T00:00:00.000' AS DateTime), 4, N'Khong Dat')
INSERT KETQUATHI (MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES (N'K1202', N'CTRR', 3, CAST(N'2006-06-30T00:00:00.000' AS DateTime), 6.25, N'Dat')
INSERT KETQUATHI (MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES (N'K1203', N'CSDL', 1, CAST(N'2006-07-20T00:00:00.000' AS DateTime), 9.25, N'Dat')
INSERT KETQUATHI (MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES (N'K1203', N'CTDLGT', 1, CAST(N'2006-12-28T00:00:00.000' AS DateTime), 9.5, N'Dat')
INSERT KETQUATHI (MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES (N'K1203', N'THDC', 1, CAST(N'2006-05-20T00:00:00.000' AS DateTime), 10, N'Dat')
INSERT KETQUATHI (MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES (N'K1203', N'CTRR', 1, CAST(N'2006-05-13T00:00:00.000' AS DateTime), 10, N'Dat')
INSERT KETQUATHI (MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES (N'K1204', N'CSDL', 1, CAST(N'2006-07-20T00:00:00.000' AS DateTime), 8.5, N'Dat')
INSERT KETQUATHI (MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES (N'K1204', N'CTDLGT', 1, CAST(N'2006-12-28T00:00:00.000' AS DateTime), 6.75, N'Dat')
INSERT KETQUATHI (MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES (N'K1204', N'THDC', 1, CAST(N'2006-05-20T00:00:00.000' AS DateTime), 4, N'Khong Dat')
INSERT KETQUATHI (MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES (N'K1204', N'CTRR', 1, CAST(N'2006-05-13T00:00:00.000' AS DateTime), 6, N'Dat')
INSERT KETQUATHI (MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES (N'K1301', N'CSDL', 1, CAST(N'2006-12-20T00:00:00.000' AS DateTime), 4.25, N'Khong Dat')
INSERT KETQUATHI (MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES (N'K1301', N'CTDLGT', 1, CAST(N'2006-07-25T00:00:00.000' AS DateTime), 8, N'Dat')
INSERT KETQUATHI (MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES (N'K1301', N'THDC', 1, CAST(N'2006-05-20T00:00:00.000' AS DateTime), 7.75, N'Dat')
INSERT KETQUATHI (MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES (N'K1301', N'CTRR', 1, CAST(N'2006-05-13T00:00:00.000' AS DateTime), 8, N'Dat')
INSERT KETQUATHI (MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES (N'K1302', N'CSDL', 1, CAST(N'2006-12-20T00:00:00.000' AS DateTime), 6.75, N'Dat')
INSERT KETQUATHI (MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES (N'K1302', N'CTDLGT', 1, CAST(N'2006-07-25T00:00:00.000' AS DateTime), 5, N'Dat')
INSERT KETQUATHI (MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES (N'K1302', N'THDC', 1, CAST(N'2006-05-20T00:00:00.000' AS DateTime), 8, N'Dat')
INSERT KETQUATHI (MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES (N'K1302', N'CTRR', 1, CAST(N'2006-05-13T00:00:00.000' AS DateTime), 8.5, N'Dat')
INSERT KETQUATHI (MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES (N'K1303', N'CSDL', 1, CAST(N'2006-12-20T00:00:00.000' AS DateTime), 4, N'Khong Dat')
INSERT KETQUATHI (MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES (N'K1303', N'CTDLGT', 1, CAST(N'2006-07-25T00:00:00.000' AS DateTime), 4.5, N'Khong Dat')
INSERT KETQUATHI (MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES (N'K1303', N'CTDLGT', 2, CAST(N'2006-08-07T00:00:00.000' AS DateTime), 4, N'Khong Dat')
INSERT KETQUATHI (MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES (N'K1303', N'CTDLGT', 3, CAST(N'2006-08-15T00:00:00.000' AS DateTime), 4.25, N'Khong Dat')
INSERT KETQUATHI (MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES (N'K1303', N'THDC', 1, CAST(N'2006-05-20T00:00:00.000' AS DateTime), 4.5, N'Khong Dat')
INSERT KETQUATHI (MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES (N'K1303', N'CTRR', 1, CAST(N'2006-05-13T00:00:00.000' AS DateTime), 3.25, N'Khong Dat')
INSERT KETQUATHI (MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES (N'K1303', N'CTRR', 2, CAST(N'2006-05-20T00:00:00.000' AS DateTime), 5, N'Dat')
INSERT KETQUATHI (MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES (N'K1304', N'CSDL', 1, CAST(N'2006-12-20T00:00:00.000' AS DateTime), 7.75, N'Dat')
INSERT KETQUATHI (MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES (N'K1304', N'CTDLGT', 1, CAST(N'2006-07-25T00:00:00.000' AS DateTime), 9.75, N'Dat')
INSERT KETQUATHI (MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES (N'K1304', N'THDC', 1, CAST(N'2006-05-20T00:00:00.000' AS DateTime), 5.5, N'Dat')
INSERT KETQUATHI (MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES (N'K1304', N'CTRR', 1, CAST(N'2006-05-13T00:00:00.000' AS DateTime), 5, N'Dat')
INSERT KETQUATHI (MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES (N'K1305', N'CSDL', 1, CAST(N'2006-12-20T00:00:00.000' AS DateTime), 9.25, N'Dat')
INSERT KETQUATHI (MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES (N'K1305', N'CTDLGT', 1, CAST(N'2006-07-25T00:00:00.000' AS DateTime), 10, N'Dat')
INSERT KETQUATHI (MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES (N'K1305', N'THDC', 1, CAST(N'2006-05-20T00:00:00.000' AS DateTime), 8, N'Dat')
INSERT KETQUATHI (MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES (N'K1305', N'CTRR', 1, CAST(N'2006-05-13T00:00:00.000' AS DateTime), 10, N'Dat')
GO

UPDATE KHOA SET TRGKHOA = N'GV01' WHERE MAKHOA = N'KHMT'
UPDATE KHOA SET TRGKHOA = N'GV02' WHERE MAKHOA = N'HTTT'
UPDATE KHOA SET TRGKHOA = N'GV03' WHERE MAKHOA = N'CNPM'
UPDATE KHOA SET TRGKHOA = N'GV04' WHERE MAKHOA = N'MTT'
UPDATE KHOA SET TRGKHOA = N'Null' WHERE MAKHOA = N'KTMT'

UPDATE GIAOVIEN SET MAKHOA = N'KHMT' WHERE MAGV = N'GV01'
UPDATE GIAOVIEN SET MAKHOA = N'HTTT' WHERE MAGV = N'GV02'
UPDATE GIAOVIEN SET MAKHOA = N'CNPM' WHERE MAGV = N'GV03'
UPDATE GIAOVIEN SET MAKHOA = N'KTMT' WHERE MAGV = N'GV04'
UPDATE GIAOVIEN SET MAKHOA = N'HTTT' WHERE MAGV = N'GV05'
UPDATE GIAOVIEN SET MAKHOA = N'KHMT' WHERE MAGV = N'GV06'
UPDATE GIAOVIEN SET MAKHOA = N'KHMT' WHERE MAGV = N'GV07'
UPDATE GIAOVIEN SET MAKHOA = N'KHMT' WHERE MAGV = N'GV08'
UPDATE GIAOVIEN SET MAKHOA = N'HTTT' WHERE MAGV = N'GV09'
UPDATE GIAOVIEN SET MAKHOA = N'CNPM' WHERE MAGV = N'GV10'
UPDATE GIAOVIEN SET MAKHOA = N'MTT' WHERE MAGV = N'GV11'
UPDATE GIAOVIEN SET MAKHOA = N'CNPM' WHERE MAGV = N'GV12'
UPDATE GIAOVIEN SET MAKHOA = N'KTMT' WHERE MAGV = N'GV13'
UPDATE GIAOVIEN SET MAKHOA = N'MTT' WHERE MAGV = N'GV14'
UPDATE GIAOVIEN SET MAKHOA = N'KHMT' WHERE MAGV = N'GV15'

-- Bài tập 3: Sinh viên hoàn thành Phần II bài tập QuanLyBanHang từ câu 2 đến câu 5.
-- 2. Tạo quan hệ SANPHAM1 chứa toàn bộ dữ liệu của quan hệ SANPHAM. Tạo quan hệ KHACHHANG1 chứa toàn bộ dữ liệu của quan hệ KHACHHANG.
SELECT * INTO SANPHAM1 FROM SANPHAM
SELECT * INTO KHACHHANG1 FROM KHACHHANG
-- 3.Cập nhật giá tăng 5% đối với những sản phẩm do “Thai Lan” sản xuất (cho quan hệ SANPHAM1)
UPDATE SANPHAM1
SET GIA = GIA * 1.05
WHERE NUOCSX = 'Thai Lan'
-- 4.Cập nhật giá giảm 5% đối với những sản phẩm do “Trung Quoc” sản xuất có giá từ 10.000 trở xuống (cho quan hệ SANPHAM1).
UPDATE SANPHAM1
SET GIA = GIA * 0.95
WHERE NUOCSX = 'Trung Quoc' AND	GIA <= 10000
-- 5.Cập nhật giá trị LOAIKH là “Vip” đối với những khách hàng đăng ký thành viên trước ngày 1/1/2007 có doanh số từ 10.000.000 trở lên hoặc khách hàng đăng ký thành viên từ 1/1/2007 trở về sau có doanh số từ 2.000.000 trở lên (cho quan hệ KHACHHANG1).
UPDATE KHACHHANG1 SET LOAIKH = 'VIP'
WHERE (NGDK < '1/1/2007' AND DOANHSO >= 10000000)
OR (NGDK > '1/1/2007' AND DOANHSO >= 2000000)

-- Bài tập 4: Sinh viên hoàn thành Phần I bài tập QuanLyGiaoVu từ câu 11 đến câu 14.
-- 11.Học viên ít nhất là 18 tuổi.
ALTER TABLE HOCVIEN ADD CONSTRAINT CK_TUOI CHECK (YEAR(GETDATE()) - YEAR(NGSINH) >= 18)
-- 12.Giảng dạy một môn học ngày bắt đầu (TUNGAY) phải nhỏ hơn ngày kết thúc (DENNGAY).
ALTER TABLE GIANGDAY ADD CONSTRAINT CK_DATE CHECK (TUNGAY < DENNGAY)
-- 13.Giáo viên khi vào làm ít nhất là 22 tuổi.
ALTER TABLE GIAOVIEN ADD CONSTRAINT CK_TUOIGV CHECK (YEAR(NGVL) - YEAR(NGSINH) >= 22)
-- 14.Tất cả các môn học đều có số tín chỉ lý thuyết và tín chỉ thực hành chênh lệch nhau không quá 3.
ALTER TABLE MONHOC ADD CONSTRAINT CK_TC
CHECK (ABS(TCLT - TCTH) <= 3)

-- Bài tập 5: Sinh viên hoàn thành Phần III bài tập QuanLyBanHang từ câu 1 đến câu 11.
-- 1.	In ra danh sách các sản phẩm (MASP,TENSP) do “Trung Quoc” sản xuất.
SELECT MASP, TENSP
FROM SANPHAM
WHERE NUOCSX = 'Trung Quoc'
-- 2.	In ra danh sách các sản phẩm (MASP, TENSP) có đơn vị tính là “cay”, ”quyen”.
SELECT MASP, TENSP
FROM SANPHAM
WHERE DVT IN ('cay', 'quyen')
-- 3.	In ra danh sách các sản phẩm (MASP,TENSP) có mã sản phẩm bắt đầu là “B” và kết thúc là “01”.
SELECT MASP, TENSP
FROM SANPHAM
WHERE MASP LIKE 'B%01'
-- 4.	In ra danh sách các sản phẩm (MASP,TENSP) do “Trung Quốc” sản xuất có giá từ 30.000 đến 40.000.
SELECT MASP, TENSP
FROM SANPHAM
WHERE NUOCSX = 'Trung Quoc' AND	(GIA BETWEEN 30000 AND 40000)
-- 5.	In ra danh sách các sản phẩm (MASP,TENSP) do “Trung Quoc” hoặc “Thai Lan” sản xuất có giá từ 30.000 đến 40.000.
SELECT MASP, TENSP
FROM SANPHAM
WHERE (GIA BETWEEN 30000 AND 40000)
AND (NUOCSX = 'Trung Quoc' OR NUOCSX = 'Thai Lan')
-- 6.	In ra các số hóa đơn, trị giá hóa đơn bán ra trong ngày 1/1/2007 và ngày 2/1/2007.
SELECT SOHD, TRIGIA
FROM HOADON
WHERE NGHD = '1/1/2007' OR NGHD = '2/1/2007'
-- 7.	In ra các số hóa đơn, trị giá hóa đơn trong tháng 1/2007, sắp xếp theo ngày (tăng dần) và trị giá của hóa đơn (giảm dần).
SELECT SOHD, TRIGIA
FROM HOADON
WHERE MONTH(NGHD) = 1 AND YEAR(NGHD) = 2007
ORDER BY NGHD ASC,TRIGIA DESC
-- 8.	In ra danh sách các khách hàng (MAKH, HOTEN) đã mua hàng trong ngày 1/1/2007.
SELECT HD.MAKH, KH.HOTEN
FROM HOADON HD INNER JOIN KHACHHANG KH ON HD.MAKH = KH.MAKH
WHERE NGHD = '1/1/2007'
-- 9.	In ra số hóa đơn, trị giá các hóa đơn do nhân viên có tên “Nguyen Van B” lập trong ngày 28/10/2006.
SELECT HD.SOHD, HD.TRIGIA
FROM HOADON HD INNER JOIN NHANVIEN NV ON HD.MANV = NV.MANV
WHERE NV.HOTEN = 'Nguyen Van B' AND NGHD = '28/10/2006'
-- 10.	In ra danh sách các sản phẩm (MASP,TENSP) được khách hàng có tên “Nguyen Van A” mua trong tháng 10/2006.
SELECT SP.MASP, SP.TENSP
FROM SANPHAM SP INNER JOIN CTHD CT ON SP.MASP = CT.MASP
INNER JOIN HOADON HD ON HD.SOHD = CT.SOHD
INNER JOIN KHACHHANG KH ON KH.MAKH = HD.MAKH
WHERE KH.HOTEN = 'Nguyen Van A' AND (MONTH(HD.NGHD) = 10 AND YEAR(NGHD) = 2006)
-- 11.	Tìm các số hóa đơn đã mua sản phẩm có mã số “BB01” hoặc “BB02”.
SELECT SOHD
FROM CTHD 
WHERE MASP = 'BB01'
UNION
SELECT SOHD
FROM CTHD
WHERE MASP = 'BB02'

-- Bài tập 6: Sinh viên hoàn thành Phần III bài tập QuanLyGiaoVu từ câu 1 đến câu 5.
-- 1.	In ra danh sách (mã học viên, họ tên, ngày sinh, mã lớp) lớp trưởng của các lớp.
SELECT HV.MAHV, HV.HO + ' ' + HV.TEN AS HOTEN, HV.NGSINH, HV.MALOP
FROM HOCVIEN HV INNER JOIN LOP ON HV.MAHV = LOP.TRGLOP
-- 2.	In ra bảng điểm khi thi (mã học viên, họ tên, lần thi, điểm số) môn CTRR của lớp “K12”, sắp xếp theo tên, họ học viên.
SELECT 
    HV.MAHV, 
    HV.HO + ' ' + HV.TEN AS HOTEN, 
    KQT.LANTHI, 
    KQT.DIEM
FROM KETQUATHI KQT 
JOIN HOCVIEN HV 
    ON KQT.MAHV = HV.MAHV
JOIN GIANGDAY GD 
    ON GD.MAMH = KQT.MAMH 
   AND GD.MALOP = HV.MALOP
WHERE KQT.MAMH = 'CTRR'
  AND GD.MALOP = 'K12'
ORDER BY HV.TEN, HV.HO;
-- 3.	In ra danh sách những học viên (mã học viên, họ tên) và những môn học mà học viên đó thi lần thứ nhất đã đạt.
SELECT HV.MAHV, HV.HO + ' ' + HV.TEN AS HOTEN, KQT.MAMH
FROM KETQUATHI KQT 
INNER JOIN HOCVIEN HV ON KQT.MAHV = HV.MAHV
WHERE KQT.LANTHI = 1 AND KQT.KQUA = 'Dat'
-- 4.	In ra danh sách học viên (mã học viên, họ tên) của lớp “K11” thi môn CTRR không đạt (ở lần thi 1).
SELECT HV.MAHV, HV.HO + ' ' + HV.TEN AS HOTEN
FROM KETQUATHI KQT 
INNER JOIN HOCVIEN HV ON KQT.MAHV = HV.MAHV
WHERE HV.MALOP = 'K11' AND KQT.LANTHI = 1 AND KQT.MAMH = 'CTRR' AND KQT.KQUA = 'Khong dat'


----------------------- LAB03 -----------------------------------
-- Bài tập 1: Sinh viên hoàn thành Phần III bài tập QuanLyBanHang câu 12 và câu 13.
-- 12.	Tìm các số hóa đơn đã mua sản phẩm có mã số “BB01” hoặc “BB02”, mỗi sản phẩm mua với số lượng từ 10 đến 20.
SELECT SOHD
FROM CTHD
WHERE MASP = 'BB01' AND SL BETWEEN 10 AND 20
UNION
SELECT SOHD
FROM CTHD
WHERE MASP = 'BB02' AND SL BETWEEN 10 AND 20
-- 13.	Tìm các số hóa đơn mua cùng lúc 2 sản phẩm có mã số “BB01” và “BB02”, mỗi sản phẩm mua với số lượng từ 10 đến 20.
SELECT SOHD
FROM CTHD
WHERE MASP = 'BB01' AND SL BETWEEN 10 AND 20
INTERSECT
SELECT SOHD
FROM CTHD
WHERE MASP = 'BB02' AND SL BETWEEN 10 AND 20

-- Bài tập 2: Sinh viên hoàn thành Phần II bài tập QuanLyGiaoVu từ câu 1 đến câu 4.
-- 1.	Tăng hệ số lương thêm 0.2 cho những giáo viên là trưởng khoa.
UPDATE GIAOVIEN
SET HESO = HESO + 0.2
WHERE MAGV IN (
	SELECT TRGKHOA FROM KHOA
)
-- 2.Cập nhật giá trị điểm trung bình tất cả các môn học (DIEMTB) của mỗi học viên (tất cả các môn học đều có hệ số 1 và nếu học viên thi một môn nhiều lần, chỉ lấy điểm của lần thi sau cùng).
UPDATE HV
SET HV.DIEMTB = (
	SELECT AVG(KQT.DIEM * 1.0)
	FROM KETQUATHI KQT
	WHERE KQT.MAHV = HV.MAHV 
	AND KQT.LANTHI = (
		SELECT MAX(LANTHI)
		FROM KETQUATHI
		WHERE MAHV = HV.MAHV AND MAMH = KQT.MAMH
	)
)
FROM HOCVIEN HV
-- 3.	Cập nhật giá trị cho cột GHICHU là “Cam thi” đối với trường hợp: học viên có một môn bất kỳ thi lần thứ 3 dưới 5 điểm.
UPDATE HOCVIEN
SET GHICHU = 'Cam thi'
WHERE MAHV IN (
	SELECT MAHV
	FROM KETQUATHI
	WHERE LANTHI = 3 AND DIEM < 5
)
-- 4.	Cập nhật giá trị cho cột XEPLOAI trong quan hệ HOCVIEN như sau:
UPDATE HOCVIEN 
SET XEPLOAI = CASE 
	WHEN DIEMTB >= 9 THEN 'XS'
	WHEN DIEMTB >= 8 THEN 'G'
	WHEN DIEMTB >= 6.5 THEN 'K'
	WHEN DIEMTB >= 5 THEN 'TB'
	ELSE 'Y'
END

-- Bài tập 3: Sinh viên hoàn thành Phần III bài tập QuanLyGiaoVu từ câu 6 đến câu 10.
-- 6.Tìm tên những môn học mà giáo viên có tên “Tran Tam Thanh” dạy trong học kỳ 1 năm 2006.
SELECT MH.TENMH
FROM GIANGDAY GD 
INNER JOIN GIAOVIEN GV ON GD.MAGV = GD.MAGV
INNER JOIN MONHOC MH ON MH.MAMH = GD.MAMH
WHERE GV.HOTEN = 'Tran Tam Thanh' AND  GD.HOCKY = 1 AND GD.NAM = 2006
-- 7.Tìm những môn học (mã môn học, tên môn học) mà giáo viên chủ nhiệm lớp “K11” dạy trong học kỳ 1 năm 2006.
SELECT MH.MAMH, MH.TENMH
FROM GIANGDAY GD
INNER JOIN LOP L ON L.MAGVCN = GD.MAGV
INNER JOIN MONHOC MH ON MH.MAMH = GD.MAMH
WHERE L.MALOP = 'K11' AND GD.HOCKY = 1 AND GD.NAM = 2006
-- 8.Tìm họ tên lớp trưởng của các lớp mà giáo viên có tên “Nguyen To Lan” dạy môn “Co So Du Lieu”.
SELECT HV.HO + ' ' + HV.TEN AS HOTEN
FROM LOP L INNER JOIN HOCVIEN HV ON L.TRGLOP = HV.MAHV
WHERE L.MALOP IN (
	SELECT GD.MALOP
	FROM GIANGDAY GD
	INNER JOIN GIAOVIEN GV ON GD.MAGV = GV.MAGV
	INNER JOIN MONHOC MH ON GD.MAMH = MH.MAMH
	WHERE GV.HOTEN = 'Nguyen To Lan' AND MH.TENMH = 'Co So Du Lieu'
) 
-- 9.In ra danh sách những môn học (mã môn học, tên môn học) phải học liền trước môn “Co So Du Lieu”.
SELECT MH.MAMH, MH.TENMH
FROM MONHOC MH
WHERE MH.MAMH IN (
SELECT DK.MAMH_TRUOC
FROM DIEUKIEN DK
WHERE DK.MAMH = (
	SELECT MAMH
	FROM MONHOC
	WHERE TENMH = 'Co So Du Lieu'
))
-- 10.Môn “Cau Truc Roi Rac” là môn bắt buộc phải học liền trước những môn học (mã môn học, tên môn học) nào.
SELECT MH.MAMH, MH.TENMH
FROM MONHOC MH
WHERE MH.MAMH IN (
SELECT DK.MAMH	
FROM DIEUKIEN DK
WHERE DK.MAMH_TRUOC = (
	SELECT MAMH
	FROM MONHOC 
	WHERE TENMH = 'Cau Truc Roi Rac'
))

-- Bài tập 4: Sinh viên hoàn thành Phần III bài tập QuanLyBanHang từ câu 14 đến 18.
-- 14.In ra danh sách các sản phẩm (MASP,TENSP) do “Trung Quoc” sản xuất hoặc các sản phẩm được bán ra trong ngày 1/1/2007.
SELECT SP.MASP, SP.TENSP
FROM CTHD CT 
INNER JOIN SANPHAM SP ON CT.MASP = SP.MASP
INNER JOIN HOADON HD ON HD.SOHD = CT.SOHD
WHERE SP.NUOCSX = 'Trung Quoc' OR HD.NGHD = '1/1/2007'
-- 15.In ra danh sách các sản phẩm (MASP,TENSP) không bán được.
SELECT MASP, TENSP
FROM SANPHAM
EXCEPT 
SELECT CTHD.MASP, SP.TENSP
FROM CTHD INNER JOIN SANPHAM SP ON CTHD.MASP = SP.MASP
-- 16.In ra danh sách các sản phẩm (MASP,TENSP) không bán được trong năm 2006.
SELECT MASP, TENSP 
FROM SANPHAM
EXCEPT 
SELECT CTHD.MASP, SP.TENSP
FROM CTHD INNER JOIN SANPHAM SP ON CTHD.MASP = SP.MASP
INNER JOIN HOADON HD ON HD.SOHD = CTHD.SOHD
WHERE YEAR(HD.NGHD) = 2006
-- 17.In ra danh sách các sản phẩm (MASP,TENSP) do “Trung Quoc” sản xuất không bán được trong năm 2006.
SELECT MASP, TENSP
FROM SANPHAM
WHERE NUOCSX = 'Trung Quoc'
EXCEPT
SELECT CTHD.MASP, SP.TENSP
FROM CTHD INNER JOIN SANPHAM SP ON CTHD.MASP = SP.MASP
INNER JOIN HOADON HD ON HD.SOHD = CTHD.SOHD
WHERE SP.NUOCSX = 'Trung Quoc' AND YEAR(HD.NGHD) = 2006
-- 18.Tìm số hóa đơn trong năm 2006 đã mua ít nhất tất cả các sản phẩm do Singapore sản xuất.
SELECT CT.SOHD
FROM CTHD CT INNER JOIN SANPHAM SP ON CT.MASP = SP.MASP
INNER JOIN HOADON HD ON CT.SOHD = HD.SOHD
WHERE NUOCSX = 'Singapore' AND YEAR(HD.NGHD) = 2006
GROUP BY CT.SOHD
HAVING COUNT(DISTINCT SP.MASP) >= (
	SELECT COUNT(MASP)
	FROM SANPHAM
	WHERE NUOCSX = 'Singapore'
)

-- Bài tập 5: Sinh viên hoàn thành Phần III bài tập QuanLyGiaoVu từ câu 11 đến câu 18.
-- 11.Tìm họ tên giáo viên dạy môn CTRR cho cả hai lớp “K11” và “K12” trong cùng học kỳ 1 năm 2006.
SELECT GV.HOTEN
FROM GIANGDAY GD INNER JOIN GIAOVIEN GV ON GD.MAGV = GV.MAGV
WHERE GD.MAMH = 'CTRR' AND GD.MALOP = 'K11' AND GD.HOCKY = 1 AND GD.NAM = 2006
INTERSECT
SELECT GV.HOTEN
FROM GIANGDAY GD INNER JOIN GIAOVIEN GV ON GD.MAGV = GV.MAGV
WHERE GD.MAMH = 'CTRR' AND GD.MALOP = 'K12' AND GD.HOCKY = 1 AND GD.NAM = 2006
-- 13.Tìm giáo viên (mã giáo viên, họ tên) không được phân công giảng dạy bất kỳ môn học nào.
SELECT MAGV, HOTEN
FROM GIAOVIEN
WHERE MAGV NOT IN (
	SELECT MAGV 
	FROM GIANGDAY
)
-- 14.Tìm giáo viên (mã giáo viên, họ tên) không được phân công giảng dạy bất kỳ môn học nào thuộc khoa giáo viên đó phụ trách.
SELECT G.MAGV, G.HOTEN
FROM GIAOVIEN G
WHERE NOT EXISTS (
	SELECT 1
	FROM GIANGDAY GD
	INNER JOIN MONHOC MH ON GD.MAMH = MH.MAMH
	WHERE GD.MAGV = G.MAGV AND MH.MAKHOA = G.MAKHOA
)
-- 15.Tìm họ tên các học viên thuộc lớp “K11” thi một môn bất kỳ quá 3 lần vẫn “Khong dat” hoặc thi lần thứ 2 môn CTRR được 5 điểm.
SELECT HV.HO + ' ' + HV.TEN AS HOTEN
FROM HOCVIEN HV
WHERE HV.MALOP = 'K11' 
AND (
	EXISTS (
		SELECT 1 
		FROM KETQUATHI KQT
		WHERE KQT.MAHV = HV.MAHV AND KQT.KQUA = 'Khong dat'
		GROUP BY KQT.MAMH
		HAVING COUNT(*) > 3
	)
	OR 
	EXISTS (
		SELECT 1 
		FROM KETQUATHI KQT
		WHERE KQT.MAHV = HV.MAHV
		AND KQT.MAMH = 'CTRR'
		AND KQT.LANTHI = 2
		AND KQT.DIEM = 5
	)
)
-- 16.Tìm họ tên giáo viên dạy môn CTRR cho ít nhất hai lớp trong cùng một học kỳ của một năm học.
SELECT HOTEN
FROM GIAOVIEN
WHERE MAGV IN (
	SELECT MAGV
	FROM GIANGDAY
	WHERE MAMH = 'CTRR' 
	GROUP BY MAGV, HOCKY, NAM
	HAVING COUNT(DISTINCT MALOP) >= 2
)
-- 17.Danh sách học viên và điểm thi môn CSDL (chỉ lấy điểm của lần thi sau cùng).
SELECT HV.MAHV, HV.HO + ' ' + HV.TEN AS HOTEN, KQT.DIEM
FROM HOCVIEN HV INNER JOIN KETQUATHI KQT ON HV.MAHV = KQT.MAHV
WHERE KQT.MAMH = 'CSDL' AND KQT.LANTHI = (
	SELECT MAX(LANTHI)
	FROM KETQUATHI
	WHERE MAHV = HV.MAHV AND MAMH = 'CSDL'
)		
-- 18.Danh sách học viên và điểm thi môn “Co So Du Lieu” (chỉ lấy điểm cao nhất của các lần thi).
SELECT HV.MAHV, HV.HO + ' ' + HV.TEN AS HOTEN, KQT.DIEM
FROM HOCVIEN HV INNER JOIN KETQUATHI KQT ON HV.MAHV = KQT.MAHV
INNER JOIN MONHOC MH ON MH.MAMH = KQT.MAMH
WHERE MH.TENMH = 'Co So Du Lieu' AND KQT.DIEM = (
	SELECT MAX(DIEM)
	FROM KETQUATHI INNER JOIN MONHOC ON KETQUATHI.MAMH = MONHOC.MAMH
	WHERE MAHV = HV.MAHV AND TENMH = 'Co So Du Lieu'
)

------------------------ LAB04 ----------------------------------
-- Bài tập 1: Sinh viên hoàn thành Phần III bài tập QuanLyBanHang từ câu 19 đến 30.
-- 19.Có bao nhiêu hóa đơn không phải của khách hàng đăng ký thành viên mua?
SELECT COUNT(*)
FROM HOADON H
WHERE NOT EXISTS (
	SELECT 1 
	FROM KHACHHANG K
	WHERE K.MAKH = H.MAKH
)
-- 20.	Có bao nhiêu sản phẩm khác nhau được bán ra trong năm 2006.
SELECT SUM(CT.SL) AS SOLUONGSANPHAM
FROM CTHD CT INNER JOIN HOADON HD ON CT.SOHD = HD.SOHD
WHERE YEAR(HD.NGHD) = 2006
-- 21.	Cho biết trị giá hóa đơn cao nhất, thấp nhất là bao nhiêu?
SELECT MIN(TRIGIA) AS TRIGIATHAPNHAT, MAX(TRIGIA) AS TRIGIACAONHAT 
FROM HOADON
-- 22.	Trị giá trung bình của tất cả các hóa đơn được bán ra trong năm 2006 là bao nhiêu?
SELECT AVG(TRIGIA) AS TRUNGBINH
FROM HOADON 
WHERE YEAR(NGHD) = 2006
-- 23.	Tính doanh thu bán hàng trong năm 2006.
SELECT SUM(TRIGIA) AS DOANHTHU
FROM HOADON
WHERE YEAR(NGHD) = 2006
-- 24.	Tìm số hóa đơn có trị giá cao nhất trong năm 2006.
SELECT SOHD
FROM HOADON
WHERE YEAR(NGHD) = 2006 AND TRIGIA = (
	SELECT MAX(TRIGIA)
	FROM HOADON
	WHERE YEAR(NGHD) = 2006
)
-- 25.	Tìm họ tên khách hàng đã mua hóa đơn có trị giá cao nhất trong năm 2006.
SELECT KH.HOTEN
FROM HOADON HD INNER JOIN KHACHHANG KH ON HD.MAKH = KH.MAKH
WHERE YEAR(NGHD) = 2006 AND TRIGIA = (
	SELECT MAX(TRIGIA)
	FROM HOADON
	WHERE YEAR(NGHD) = 2006
)
-- 26.	In ra danh sách 3 khách hàng (MAKH, HOTEN) có doanh số cao nhất.
SELECT TOP 3 MAKH, HOTEN
FROM KHACHHANG
ORDER BY DOANHSO DESC
-- 27.	In ra danh sách các sản phẩm (MASP, TENSP) có giá bán bằng 1 trong 3 mức giá cao nhất.
SELECT MASP, TENSP
FROM SANPHAM
WHERE GIA IN (
	SELECT DISTINCT TOP 3 GIA
	FROM SANPHAM
	ORDER BY GIA DESC
)
-- 28.	In ra danh sách các sản phẩm (MASP, TENSP) do “Thai Lan” sản xuất có giá bằng 1 trong 3 mức giá cao nhất (của tất cả các sản phẩm).
SELECT MASP, TENSP
FROM SANPHAM
WHERE NUOCSX = 'Thai Lan' AND GIA IN (
	SELECT DISTINCT TOP 3 GIA
	FROM SANPHAM
	ORDER BY GIA DESC
)
-- 29.	In ra danh sách các sản phẩm (MASP, TENSP) do “Trung Quoc” sản xuất có giá bằng 1 trong 3 mức giá cao nhất (của sản phẩm do “Trung Quoc” sản xuất).
SELECT MASP, TENSP
FROM SANPHAM
WHERE NUOCSX = 'Trung Quoc' AND	GIA IN (
	SELECT DISTINCT TOP 3 GIA
	FROM SANPHAM
	WHERE NUOCSX = 'Trung Quoc' 
	ORDER BY GIA DESC
)
-- 30.	In ra danh sách 3 khách hàng có doanh số cao nhất (sắp xếp theo kiểu xếp hạng).
SELECT TOP 3 MAKH, HOTEN, RANK() OVER (ORDER BY DOANHSO DESC) RANK_KH 
FROM KHACHHANG

-- Bài tập 2: Sinh viên hoàn thành Phần III bài tập QuanLyGiaoVu từ câu 19 đến câu 25.
-- 19.	Khoa nào (mã khoa, tên khoa) được thành lập sớm nhất.
SELECT MAKHOA, TENKHOA
FROM KHOA
WHERE NGTLAP = (
	SELECT MIN(NGTLAP)
	FROM KHOA
)
-- 20.	Có bao nhiêu giáo viên có học hàm là “GS” hoặc “PGS”.
SELECT COUNT(MAGV) AS SOLUONG
FROM GIAOVIEN
WHERE HOCHAM IN ('GS', 'PGS')
-- 21.	Thống kê có bao nhiêu giáo viên có học vị là “CN”, “KS”, “Ths”, “TS”, “PTS” trong mỗi khoa.
SELECT MAKHOA, COUNT(MAGV) AS SOLUONG
FROM GIAOVIEN
WHERE HOCVI IN ('CN', 'KS', 'Ths', 'TS', 'PTS')
GROUP BY MAKHOA
-- 22.	Mỗi môn học thống kê số lượng học viên theo kết quả (đạt và không đạt).
SELECT MAMH, KQUA, COUNT(MAHV) AS SOLUONG
FROM KETQUATHI
GROUP BY MAMH, KQUA
ORDER BY MAMH, KQUA
-- 23.	Tìm giáo viên (mã giáo viên, họ tên) là giáo viên chủ nhiệm của một lớp, đồng thời dạy cho lớp đó ít nhất một môn học.
SELECT GV.MAGV, GV.HOTEN
FROM LOP L
INNER JOIN GIAOVIEN GV ON L.MAGVCN = GV.MAGV
INNER JOIN GIANGDAY GD ON GD.MALOP = L.MALOP AND GD.MAGV = GV.MAGV
GROUP BY GV.MAGV, GV.HOTEN
-- 24.	Tìm họ tên lớp trưởng của lớp có sỉ số cao nhất.
SELECT HV.HO + ' ' + HV.TEN AS HOTEN
FROM LOP L INNER JOIN HOCVIEN HV ON HV.MAHV = L.TRGLOP
WHERE SISO = (
	SELECT MAX(SISO)
	FROM LOP
)
-- 25.	Tìm họ tên những LOPTRG thi không đạt quá 3 môn (mỗi môn đều thi không đạt ở tất cả các lần thi).
SELECT HV.HO + ' ' + HV.TEN AS HOTEN
FROM LOP L INNER JOIN HOCVIEN HV ON HV.MAHV = L.TRGLOP
WHERE (
	SELECT COUNT(*)
	FROM KETQUATHI K
	WHERE K.MAHV = HV.MAHV
	GROUP BY K.MAMH
	HAVING COUNT (CASE WHEN K.KQUA = 'Dat' THEN 1 END) = 0
) <= 3


-- Bài tập 3: Sinh viên hoàn thành Phần III bài tập QuanLyBanHang từ câu 31 đến 45.
-- 31.	Tính tổng số sản phẩm do “Trung Quoc” sản xuất.
SELECT SUM(CT.SL) AS TONGSOSANPHAM
FROM SANPHAM SP INNER JOIN CTHD CT ON SP.MASP = CT.MASP
WHERE SP.NUOCSX = 'Trung Quoc'
-- 32.	Tính tổng số sản phẩm của từng nước sản xuất.
SELECT SP.NUOCSX, SUM(CT.SL) AS TONGSOSANPHAM
FROM SANPHAM SP INNER JOIN CTHD CT ON SP.MASP = CT.MASP
GROUP BY SP.NUOCSX
-- 33.	Với từng nước sản xuất, tìm giá bán cao nhất, thấp nhất, trung bình của các sản phẩm.
SELECT NUOCSX, MAX(GIA) AS CAONHAT, MIN(GIA) AS THAPNHAT, AVG(GIA) AS TRUNGBINH
FROM SANPHAM
GROUP BY NUOCSX
-- 34.	Tính doanh thu bán hàng mỗi ngày.
SELECT NGHD, SUM(TRIGIA) AS DOANHTHU
FROM HOADON
GROUP BY NGHD
-- 35.	Tính tổng số lượng của từng sản phẩm bán ra trong tháng 10/2006.
SELECT CT.MASP, SUM(CT.SL) AS TONGSOLUONG
FROM HOADON HD INNER JOIN CTHD CT ON HD.SOHD = CT.SOHD
WHERE MONTH(HD.NGHD) = 10 AND YEAR(HD.NGHD) = 2006
GROUP BY CT.MASP
-- 36.	Tính doanh thu bán hàng của từng tháng trong năm 2006.
SELECT MONTH(NGHD) AS THANG, SUM(TRIGIA) AS DOANHTHU
FROM HOADON 
WHERE YEAR(NGHD) = 2006
GROUP BY MONTH(NGHD)
-- 37.	Tìm hóa đơn có mua ít nhất 4 sản phẩm khác nhau.
SELECT HD.SOHD, HD.NGHD, HD.MAKH
FROM HOADON HD INNER JOIN CTHD CT ON HD.SOHD = CT.SOHD
GROUP BY HD.SOHD, HD.NGHD, HD.MAKH
HAVING COUNT(DISTINCT CT.MASP) >= 4
-- 38.	Tìm hóa đơn có mua 3 sản phẩm do “Viet Nam” sản xuất (3 sản phẩm khác nhau).
SELECT CT.SOHD
FROM SANPHAM SP INNER JOIN CTHD CT ON SP.MASP = CT.MASP
WHERE SP.NUOCSX = 'Viet Nam'
GROUP BY CT.SOHD
HAVING COUNT(DISTINCT CT.MASP) = 3
-- 39.	Tìm khách hàng (MAKH, HOTEN) có số lần mua hàng nhiều nhất. 
SELECT KH.MAKH, KH.HOTEN
FROM KHACHHANG KH INNER JOIN HOADON HD ON KH.MAKH = HD.MAKH
GROUP BY KH.MAKH, KH.HOTEN
HAVING COUNT(*) = (
	SELECT MAX(SL)
	FROM (
		SELECT MAKH, COUNT(*) AS SL
		FROM HOADON 
		GROUP BY MAKH
	) AS T
)
-- 40.	Tháng mấy trong năm 2006, doanh số bán hàng cao nhất ?
SELECT TOP 1 THANG, DOANHTHU	
FROM (
	SELECT MONTH(NGHD) AS THANG, SUM(TRIGIA) AS DOANHTHU
	FROM HOADON
	WHERE YEAR(NGHD) = 2006
	GROUP BY MONTH(NGHD)
) AS T
ORDER BY DOANHTHU DESC
-- 41.	Tìm sản phẩm (MASP, TENSP) có tổng số lượng bán ra thấp nhất trong năm 2006.
SELECT TOP 1 SP.MASP, SP.TENSP
FROM (
	SELECT CT.MASP, SUM(SL) AS TONGSL
	FROM CTHD CT INNER JOIN HOADON HD ON CT.SOHD = HD.SOHD
	WHERE YEAR(HD.NGHD) = 2006
	GROUP BY MASP
) AS T INNER JOIN SANPHAM SP ON SP.MASP = T.MASP
ORDER BY T.TONGSL ASC 
-- 42.	*Mỗi nước sản xuất, tìm sản phẩm (MASP,TENSP) có giá bán cao nhất.
SELECT SP.MASP, SP.TENSP, SP.NUOCSX, SP.GIA
FROM (
	SELECT NUOCSX, MAX(GIA) AS GIAMAX
	FROM SANPHAM 
	GROUP BY NUOCSX
) AS T 
INNER JOIN SANPHAM SP ON SP.NUOCSX = T.NUOCSX AND SP.GIA = T.GIAMAX
-- 43.	Tìm nước sản xuất sản xuất ít nhất 3 sản phẩm có giá bán khác nhau.
SELECT NUOCSX
FROM SANPHAM
GROUP BY NUOCSX 
HAVING COUNT(DISTINCT GIA) >= 3
-- 44.	*Trong 10 khách hàng có doanh số cao nhất, tìm khách hàng có số lần mua hàng nhiều nhất.
SELECT TOP 1 T.MAKH, T.HOTEN, T.SOLANMUAHANG
FROM (
	SELECT TOP 10 KH.MAKH, KH.HOTEN, COUNT(HD.SOHD) AS SOLANMUAHANG, SUM(HD.TRIGIA) AS DOANHSO
	FROM KHACHHANG KH INNER JOIN HOADON HD ON KH.MAKH = HD.MAKH
	GROUP BY KH.MAKH, KH.HOTEN
	ORDER BY SUM(HD.TRIGIA) DESC
) AS T
ORDER BY T.SOLANMUAHANG DESC


-- Bài tập 4: Sinh viên hoàn thành Phần III bài tập QuanLyGiaoVu từ câu 26 đến câu 35.
-- 26.	Tìm học viên (mã học viên, họ tên) có số môn đạt điểm 9, 10 nhiều nhất.
SELECT TOP 1 HV.MAHV, HV.HO + ' ' + HV.TEN AS HOTEN
FROM (
	SELECT MAHV, COUNT(*) AS TONGSL
	FROM KETQUATHI 
	WHERE DIEM = 9 OR DIEM = 10
	GROUP BY MAHV
) AS T
INNER JOIN HOCVIEN HV ON HV.MAHV = T.MAHV
ORDER BY T.TONGSL DESC
/*
SELECT HV.MAHV, HV.HO + ' ' + HV.TEN AS HOTEN
FROM (
    SELECT MAHV, COUNT(*) AS TONGSL
    FROM KETQUATHI 
    WHERE DIEM = 9 OR DIEM = 10
    GROUP BY MAHV
) AS T
INNER JOIN HOCVIEN HV ON HV.MAHV = T.MAHV
WHERE T.TONGSL = (
    SELECT MAX(TONGSL)
    FROM (
        SELECT MAHV, COUNT(*) AS TONGSL
        FROM KETQUATHI 
        WHERE DIEM = 9 OR DIEM = 10
        GROUP BY MAHV
    ) AS X
)
*/
-- 27.	Trong từng lớp, tìm học viên (mã học viên, họ tên) có số môn đạt điểm 9, 10 nhiều nhất.
SELECT LEFT(A.MAHV, 3) MALOP, A.MAHV, HO + ' ' + TEN HOTEN
FROM (
	SELECT MAHV, RANK() OVER (PARTITION BY LEFT(MAHV, 3) ORDER BY COUNT(MAMH) DESC) RANK_MH 
	FROM KETQUATHI KQ
	WHERE DIEM = 9 OR DIEM = 10
	GROUP BY KQ.MAHV
) A 
INNER JOIN HOCVIEN HV ON A.MAHV = HV.MAHV
WHERE RANK_MH = 1
GROUP BY LEFT(A.MAHV, 3), A.MAHV, HO, TEN
-- 28.	Trong từng học kỳ của từng năm, mỗi giáo viên phân công dạy bao nhiêu môn học, bao nhiêu lớp.
SELECT HOCKY, NAM, MAGV, COUNT(MAMH) SOMH, COUNT(MALOP) SOLOP
FROM GIANGDAY
GROUP BY HOCKY, NAM, MAGV
-- 29.	Trong từng học kỳ của từng năm, tìm giáo viên (mã giáo viên, họ tên) giảng dạy nhiều nhất.
SELECT HOCKY, NAM, A.MAGV, GV.HOTEN
FROM (
	SELECT HOCKY, NAM, MAGV, RANK() OVER (PARTITION BY HOCKY, NAM ORDER BY COUNT(MAMH) DESC) RANK_MH
	FROM GIANGDAY
	GROUP BY HOCKY, NAM, MAGV
) A
INNER JOIN GIAOVIEN GV ON A.MAGV = GV.MAGV
WHERE RANK_MH = 1
-- 30.	Tìm môn học (mã môn học, tên môn học) có nhiều học viên thi không đạt (ở lần thi thứ 1) nhất.
SELECT MH.MAMH, MH.TENMH
FROM (
	SELECT MAMH, RANK() OVER (ORDER BY COUNT(*) DESC) RANK_MH
	FROM KETQUATHI
	WHERE LANTHI = 1 AND KQUA = 'Khong Dat'
	GROUP BY MAMH
) A
INNER JOIN MONHOC MH ON A.MAMH = MH.MAMH
WHERE RANK_MH = 1
-- 31.	Tìm học viên (mã học viên, họ tên) thi môn nào cũng đạt (chỉ xét lần thi thứ 1).
SELECT HV.MAHV, HV.HO + ' ' + HV.TEN AS HOTEN
FROM (
	SELECT MAHV
	FROM KETQUATHI
	WHERE LANTHI = 1
	GROUP BY MAHV
	HAVING COUNT(CASE WHEN KQUA = 'Dat' THEN 1 END) = COUNT(MAMH)
) A
INNER JOIN HOCVIEN HV ON HV.MAHV = A.MAHV
-- 32. Tìm học viên (mã học viên, họ tên) thi môn nào cũng đạt (chỉ xét lần thi sau cùng).
SELECT HV.MAHV, HV.HO + ' ' + HV.TEN
FROM (
	SELECT MAHV
	FROM KETQUATHI A
	WHERE LANTHI = (
		SELECT MAX(LANTHI)
		FROM KETQUATHI B
		WHERE A.MAHV = B.MAHV AND A.MAMH = B.MAMH
	)
	GROUP BY MAHV
	HAVING COUNT(CASE WHEN KQUA = 'Dat' THEN 1 END) = COUNT(MAMH)
) C
INNER JOIN HOCVIEN HV ON HV.MAHV = C.MAHV
-- 33. Tìm học viên (mã học viên, họ tên) đã thi tất cả các môn và đều đạt (chỉ xét lần thi thứ 1).
SELECT HV.MAHV, HV.HO + ' ' + HV.TEN AS HOTEN
FROM (
	SELECT MAHV, COUNT(MAMH) AS SOLUONG
	FROM KETQUATHI
	WHERE LANTHI = 1 AND KQUA = 'Dat'
	GROUP BY MAHV
	HAVING COUNT(MAMH) = (
		SELECT COUNT(DISTINCT MAMH)
		FROM KETQUATHI
		WHERE LANTHI = 1
	)
) A 
INNER JOIN HOCVIEN HV ON HV.MAHV = A.MAHV
-- 34. Tìm học viên (mã học viên, họ tên) đã thi tất cả các môn và đều đạt (chỉ xét lần thi sau cùng).
SELECT HV.MAHV, HV.HO + ' ' + HV.TEN AS HOTEN
FROM (
	SELECT MAHV, COUNT(MAMH) AS SOLUONG
	FROM KETQUATHI A
	WHERE LANTHI = (
		SELECT MAX(LANTHI)
		FROM KETQUATHI B
		WHERE A.MAHV = B.MAHV AND A.MAMH = B.MAMH
	)
	AND KQUA = 'Dat'
	GROUP BY MAHV
	HAVING COUNT(MAMH) = (
		SELECT COUNT(DISTINCT MAMH)
		FROM KETQUATHI 
	)
) C
INNER JOIN HOCVIEN HV ON HV.MAHV = C.MAHV
-- 35. Tìm học viên (mã học viên, họ tên) có điểm thi cao nhất trong từng môn (lấy điểm ở lần thi sau cùng).
SELECT HV.MAHV, HV.HO + ' ' + HV.TEN AS HOTEN
FROM KETQUATHI A 
INNER JOIN HOCVIEN HV ON A.MAHV = HV.MAHV
WHERE
	A.LANTHI = (
		SELECT MAX(LANTHI)
		FROM KETQUATHI B
		WHERE A.MAHV = B.MAHV AND A.MAMH = B.MAMH
	)
AND A.DIEM = (
		SELECT MAX(C.DIEM)
		FROM KETQUATHI C
		WHERE C.MAMH = A.MAMH
		AND C.LANTHI = (
			SELECT MAX(LANTHI)
			FROM KETQUATHI D
			WHERE D.MAHV = C.MAHV AND D.MAMH = C.MAMH
		)
	)	






-- III. Ngôn ngữ truy vấn dữ liệu:
-- 1.In ra danh sách (mã học viên, họ tên, ngày sinh, mã lớp) lớp trưởng của các lớp.
SELECT HV.MAHV, HV.HO + ' ' + HV.TEN AS HOTEN, HV.NGSINH, HV.MALOP
FROM HOCVIEN HV INNER JOIN LOP ON HV.MAHV = LOP.TRGLOP
-- 2.In ra bảng điểm khi thi (mã học viên, họ tên, lần thi, điểm số) môn CTRR của lớp “K12”, sắp xếp theo tên, họ học viên.
SELECT HV.MAHV, HV.HO + ' ' + HV.TEN AS HOTEN, KQT.LANTHI, KQT.DIEM
FROM KETQUATHI KQT INNER JOIN HOCVIEN HV ON KQT.MAHV = HV.MAHV
WHERE KQT.MAMH = 'CTRR' AND LEFT(HV.MALOP, 3) = 'K12'
ORDER BY HV.TEN, HV.HO
-- 3.In ra danh sách những học viên (mã học viên, họ tên) và những môn học mà học viên đó thi lần thứ nhất đã đạt.
SELECT HV.MAHV, HV.HO + ' ' + HV.TEN AS HOTEN, KQT.MAMH
FROM KETQUATHI KQT INNER JOIN HOCVIEN HV ON KQT.MAHV = HV.MAHV
WHERE KQT.LANTHI = 1 AND KQT.KQUA = 'Dat'
-- 4.In ra danh sách học viên (mã học viên, họ tên) của lớp “K11” thi môn CTRR không đạt (ở lần thi 1).
SELECT HV.MAHV, HV.HO + ' ' + HV.TEN AS HOTEN
FROM KETQUATHI KQT INNER JOIN HOCVIEN HV ON KQT.MAHV = HV.MAHV
WHERE LEFT(HV.MALOP, 3) = 'K11' AND KQT.MAMH = 'CTRR' AND KQT.KQUA = 'Khong dat' AND KQT.LANTHI = 1
-- 5.* Danh sách học viên (mã học viên, họ tên) của lớp “K” thi môn CTRR không đạt (ở tất cả các lần thi).
SELECT DISTINCT HV.MAHV, HV.HO + ' ' + HV.TEN AS HOTEN
FROM HOCVIEN HV INNER JOIN KETQUATHI KQT ON HV.MAHV = KQT.MAHV
WHERE LEFT(HV.MALOP, 1) = 'K' AND KQT.MAMH = 'CTRR' 
AND NOT EXISTS (
	SELECT *
	FROM KETQUATHI KQT2
	WHERE KQT2.MAHV = HV.MAHV AND KQT2.MAMH = 'CTRR' AND KQT2.KQUA = 'Dat'
)
-- 6.Tìm tên những môn học mà giáo viên có tên “Tran Tam Thanh” dạy trong học kỳ 1 năm 2006.
SELECT DISTINCT MH.TENMH
FROM GIANGDAY GD INNER JOIN GIAOVIEN GV ON GD.MAGV = GV.MAGV INNER JOIN MONHOC MH ON GD.MAMH = MH.MAMH
WHERE GV.HOTEN = 'Tran Tam Thanh' AND GD.HOCKY = 1 AND GD.NAM = 2006
-- 7.Tìm những môn học (mã môn học, tên môn học) mà giáo viên chủ nhiệm lớp “K11” dạy trong học kỳ 1 năm 2006.
SELECT DISTINCT GD.MAMH, MH.TENMH
FROM LOP L INNER JOIN GIANGDAY GD ON L.MAGVCN = GD.MAGV INNER JOIN MONHOC MH ON MH.MAMH = GD.MAMH
WHERE GD.MALOP = 'K11' AND GD.HOCKY = 1 AND GD.NAM = 2006
-- 8.Tìm họ tên lớp trưởng của các lớp mà giáo viên có tên “Nguyen To Lan” dạy môn “Co So Du Lieu”.
SELECT DISTINCT HV.HO + ' ' + HV.TEN AS HOTEN
FROM (
	SELECT L.MALOP, L.TRGLOP
	FROM LOP L INNER JOIN GIANGDAY GD ON L.MALOP = GD.MALOP INNER JOIN GIAOVIEN GV ON GV.MAGV = GD.MAGV
	INNER JOIN MONHOC MH ON MH.MAMH = GD.MAMH
	WHERE GV.HOTEN = 'Nguyen To Lan' AND MH.TENMH = 'Co So Du Lieu'
) A
INNER JOIN HOCVIEN HV ON A.TRGLOP = HV.MAHV
-- 9.In ra danh sách những môn học (mã môn học, tên môn học) phải học liền trước môn “Co So Du Lieu”.
SELECT A.MAMH_TRUOC, MH1.TENMH
FROM (
	SELECT DK.MAMH, DK.MAMH_TRUOC
	FROM DIEUKIEN DK INNER JOIN MONHOC MH ON DK.MAMH = MH.MAMH
	WHERE MH.TENMH = 'Co So Du Lieu'
) A
INNER JOIN MONHOC MH1 ON MH1.MAMH = A.MAMH_TRUOC
-- 10.Môn “Cau Truc Roi Rac” là môn bắt buộc phải học liền trước những môn học (mã môn học, tên môn học) nào.
SELECT A.MAMH, MH1.TENMH
FROM (
	SELECT DK.MAMH, DK.MAMH_TRUOC
	FROM DIEUKIEN DK INNER JOIN MONHOC MH ON DK.MAMH_TRUOC = MH.MAMH
	WHERE MH.TENMH = 'Cau Truc Roi Rac'
) A
INNER JOIN MONHOC MH1 ON MH1.MAMH = A.MAMH
-- 11.Tìm họ tên giáo viên dạy môn CTRR cho cả hai lớp “K11” và “K12” trong cùng học kỳ 1 năm 2006.

-- 12.Tìm những học viên (mã học viên, họ tên) thi không đạt môn CSDL ở lần thi thứ 1 nhưng chưa thi lại môn này.
SELECT HV.MAHV, HV.HO + ' ' + HV.TEN AS HOTEN
FROM HOCVIEN HV INNER JOIN KETQUATHI KQT ON HV.MAHV = KQT.MAHV
WHERE KQT.MAMH = 'CSDL' AND KQT.LANTHI = 1 AND KQT.KQUA = 'Khong dat'
AND NOT EXISTS (
	SELECT *
	FROM KETQUATHI KQT2
	WHERE KQT2.MAHV = HV.MAHV
	AND KQT2.MAMH = 'CSDL' AND KQT2.LANTHI > 1
)

-- 13.Tìm giáo viên (mã giáo viên, họ tên) không được phân công giảng dạy bất kỳ môn học nào.
SELECT GV.MAGV, GV.HOTEN
FROM GIAOVIEN GV
WHERE NOT EXISTS (
	SELECT * 
	FROM GIANGDAY GD
	WHERE GD.MAGV = GV.MAGV
)

-- 14.Tìm giáo viên (mã giáo viên, họ tên) không được phân công giảng dạy bất kỳ môn học nào thuộc khoa giáo viên đó phụ trách.
SELECT GV.MAGV, GV.HOTEN
FROM GIAOVIEN GV
WHERE NOT EXISTS (
	SELECT *
	FROM MONHOC MH INNER JOIN GIANGDAY GD ON MH.MAMH = GD.MAMH
	WHERE MH.MAKHOA = GV.MAKHOA AND GD.MAGV = GV.MAGV
)
-- 15.Tìm họ tên các học viên thuộc lớp “K11” thi một môn bất kỳ quá 3 lần vẫn “Khong dat” hoặc thi lần thứ 2 môn CTRR được 5 điểm.
SELECT HV.HO, HV.TEN 
FROM KETQUATHI KQT INNER JOIN HOCVIEN HV ON KQT.MAHV = HV.MAHV
WHERE MALOP = 'K11' AND KQT.LANTHI > 3 AND KQT.KQUA = 'Khong dat'
UNION
SELECT HV.HO, HV.TEN
FROM KETQUATHI KQT INNER JOIN HOCVIEN HV ON KQT.MAHV = HV.MAHV
WHERE MALOP = 'K11' AND KQT.LANTHI = 2 AND KQT.MAMH = 'CTRR' AND KQT.DIEM = 5
-- 16.Tìm họ tên giáo viên dạy môn CTRR cho ít nhất hai lớp trong cùng một học kỳ của một năm học.
SELECT GV.MAGV, GV.HOTEN, GD.HOCKY, GD.NAM
FROM GIANGDAY GD INNER JOIN GIAOVIEN GV ON GD.MAGV = GV.MAGV
WHERE GD.MAMH = 'CTRR' 
GROUP BY GV.MAGV, GV.HOTEN, GD.HOCKY, GD.NAM
HAVING COUNT(GD.MALOP) >= 2

-- 17.Danh sách học viên và điểm thi môn CSDL (chỉ lấy điểm của lần thi sau cùng).
SELECT HV.MAHV, HV.HO + ' ' + HV.TEN AS HOTEN, KQT.DIEM
FROM KETQUATHI KQT INNER JOIN HOCVIEN HV ON KQT.MAHV = HV.MAHV
WHERE KQT.MAMH = 'CSDL' 
AND KQT.LANTHI = (
	SELECT MAX(KQT2.LANTHI) 
	FROM KETQUATHI KQT2 
	WHERE KQT2.MAHV = HV.MAHV AND KQT2.MAMH = 'CSDL'
)
-- 18.Danh sách học viên và điểm thi môn “Co So Du Lieu” (chỉ lấy điểm cao nhất của các lần thi).
SELECT HV.MAHV, HV.HO + ' ' + HV.TEN AS HOTEN, KQT.DIEM
FROM KETQUATHI KQT INNER JOIN HOCVIEN HV ON KQT.MAHV = HV.MAHV INNER JOIN MONHOC MH ON MH.MAMH = KQT.MAMH
WHERE MH.TENMH = 'Co So Du Lieu' 
AND KQT.DIEM = (
	SELECT MAX(KQT2.DIEM) 
	FROM KETQUATHI KQT2
	WHERE KQT2.MAMH = MH.MAMH AND KQT2.MAHV = HV.MAHV
)
-- 19.Khoa nào (mã khoa, tên khoa) được thành lập sớm nhất.
SELECT TOP 1 WITH TIES MAKHOA, TENKHOA
FROM KHOA
ORDER BY NGTLAP 
-- 20.Có bao nhiêu giáo viên có học hàm là “GS” hoặc “PGS”.
SELECT COUNT(GV.MAGV) AS SL
FROM GIAOVIEN GV
WHERE GV.HOCHAM = 'GS' OR GV.HOCHAM = 'PGS'
-- 21.Thống kê có bao nhiêu giáo viên có học vị là “CN”, “KS”, “Ths”, “TS”, “PTS” trong mỗi khoa
SELECT K.MAKHOA, K.TENKHOA, COUNT(GV.MAGV) AS SL
FROM GIAOVIEN GV INNER JOIN KHOA K ON GV.MAKHOA = K.MAKHOA
WHERE GV.HOCVI IN ('CN', 'KS', 'Ths', 'TS', 'PTS')
GROUP BY K.MAKHOA, K.TENKHOA
-- 22.Mỗi môn học thống kê số lượng học viên theo kết quả (đạt và không đạt).
SELECT KQT.MAMH, KQT.KQUA, COUNT(KQT.MAHV) AS SL
FROM KETQUATHI KQT 
GROUP BY KQT.MAMH, KQT.KQUA
-- 23.Tìm giáo viên (mã giáo viên, họ tên) là giáo viên chủ nhiệm của một lớp, đồng thời dạy cho lớp đó ít nhất một môn học.
SELECT GV.MAGV, GV.HOTEN
FROM GIAOVIEN GV INNER JOIN LOP L ON GV.MAGV = L.MAGVCN
WHERE EXISTS (
	SELECT *
	FROM GIANGDAY GD
	WHERE GD.MAGV = GV.MAGV AND GD.MALOP = L.MALOP
)
-- 24.Tìm họ tên lớp trưởng của lớp có sỉ số cao nhất.
SELECT TOP 1 WITH TIES HV1.HO, HV1.TEN
FROM (
	SELECT L.MALOP, L.TRGLOP, COUNT(HV.MAHV) AS SOLUONG
	FROM LOP L INNER JOIN HOCVIEN HV ON L.MALOP = HV.MALOP
	GROUP BY L.MALOP, L.TRGLOP
) A
INNER JOIN HOCVIEN HV1 ON HV1.MAHV = A.TRGLOP
ORDER BY A.SOLUONG DESC
-- 25.* Tìm họ tên những LOPTRG thi không đạt quá 3 môn (mỗi môn đều thi không đạt ở tất cả các lần thi).
SELECT HV.MAHV, HV.HO, HV.TEN
FROM LOP L INNER JOIN HOCVIEN HV ON L.TRGLOP = HV.MAHV
INNER JOIN KETQUATHI KQT ON KQT.MAHV = HV.MAHV
WHERE NOT EXISTS (
	SELECT 1 
	FROM KETQUATHI KQT2
	WHERE KQT2.MAHV = HV.MAHV AND KQT2.MAMH = KQT.MAMH
	AND KQT2.KQUA = 'Dat'
)
GROUP BY HV.MAHV, HV.HO, HV.TEN
HAVING COUNT(DISTINCT KQT.MAMH) > 3
-- 26.Tìm học viên (mã học viên, họ tên) có số môn đạt điểm 9, 10 nhiều nhất.
SELECT TOP 1 WITH TIES HV.MAHV, HV.HO, HV.TEN
FROM (
	SELECT KQT.MAHV, COUNT(KQT.MAMH) AS SL
	FROM KETQUATHI KQT
	WHERE KQT.DIEM BETWEEN 9 AND 10
	GROUP BY KQT.MAHV
) A 
INNER JOIN HOCVIEN HV ON A.MAHV = HV.MAHV
ORDER BY A.SL DESC
-- 27.Trong từng lớp, tìm học viên (mã học viên, họ tên) có số môn đạt điểm 9, 10 nhiều nhất.
SELECT HV.MALOP, HV.MAHV, HV.HO, HV.TEN, COUNT(DISTINCT KQT.MAMH) AS SOLUONG
FROM HOCVIEN HV INNER JOIN KETQUATHI KQT ON HV.MAHV = KQT.MAHV
WHERE KQT.DIEM BETWEEN 9 AND 10
GROUP BY HV.MALOP, HV.MAHV, HV.HO, HV.TEN
HAVING COUNT(DISTINCT KQT.MAMH) >= ALL (
	SELECT COUNT(DISTINCT KQT2.MAMH)
	FROM KETQUATHI KQT2 INNER JOIN HOCVIEN HV2 ON KQT2.MAHV = HV2.MAHV
	WHERE KQT2.DIEM BETWEEN 9 AND 10 AND HV2.MALOP = HV.MALOP
	GROUP BY HV2.MAHV
)
-- 28.Trong từng học kỳ của từng năm, mỗi giáo viên phân công dạy bao nhiêu môn học, bao nhiêu lớp.








----------------------------- LAB 05 ---------------------------------------------------------------
-- Bài tập 1: Sinh viên hoàn thành Phần I bài tập QuanLyBanHang từ câu 11 đến 14.
-- 11.Ngày mua hàng (NGHD) của một khách hàng thành viên sẽ lớn hơn hoặc bằng ngày khách hàng đó đăng ký thành viên (NGDK).
CREATE TRIGGER TRG_UPD_KH ON KHACHHANG
FOR UPDATE
AS
BEGIN
	IF (UPDATE(NGDK))
	BEGIN
		IF EXISTS (
			SELECT *
			FROM INSERTED KH INNER JOIN HOADON HD ON KH.MAKH = HD.MAKH
			WHERE KH.NGDK > HD.NGHD
		)
		BEGIN
			ROLLBACK TRANSACTION
		END
	END
END

CREATE TRIGGER TRG_UPNIN_HD ON HOADON
FOR UPDATE, INSERT
AS 
BEGIN
	IF (UPDATE(NGHD) OR UPDATE(MAKH))
	BEGIN
		IF EXISTS (
			SELECT *
			FROM INSERTED HD INNER JOIN KHACHHANG KH ON KH.MAKH = HD.MAKH
			WHERE HD.NGHD < KH.NGDK
		)
		BEGIN
			ROLLBACK TRANSACTION
		END
	END
END
-- 12.Ngày bán hàng (NGHD) của một nhân viên phải lớn hơn hoặc bằng ngày nhân viên đó vào làm.
CREATE TRIGGER TRG_UPD_NV ON NHANVIEN
FOR UPDATE
AS 
BEGIN
	IF (UPDATE(NGVL))
	BEGIN
		IF EXISTS (
			SELECT * 
			FROM INSERTED NV INNER JOIN HOADON HD ON NV.MANV = HD.MANV
			WHERE NV.NGVL > HD.NGHD
		)
		BEGIN
			ROLLBACK TRANSACTION
		END
	END
END

CREATE TRIGGER TRG_UPANIN_HD ON HOADON
FOR UPDATE, INSERT
AS 
BEGIN
	IF (UPDATE(NGHD) OR UPDATE(MANV))
	BEGIN
		IF EXISTS (
			SELECT *
			FROM NHANVIEN NV INNER JOIN INSERTED HD ON NV.MANV = HD.MANV
			WHERE NV.NGVL > HD.NGHD
		)
		BEGIN
			ROLLBACK TRANSACTION
		END
	END
END
-- 13.Trị giá của một hóa đơn là tổng thành tiền (số lượng*đơn giá) của các chi tiết thuộc hóa đơn đó.
CREATE TRIGGER TRG_CTHD_INSERT_UPDATE ON CTHD
FOR INSERT, UPDATE
AS
BEGIN
	UPDATE HOADON 
	SET TRIGIA = (
		SELECT SUM(CT.SL * SP.GIA)
		FROM CTHD CT INNER JOIN SANPHAM SP ON CT.MASP = SP.MASP
		WHERE CT.SOHD = HOADON.SOHD
	)
	WHERE SOHD IN (
		SELECT SOHD 
		FROM INSERTED 
	)
END

CREATE TRIGGER TRG_CTHD_DELETE ON CTHD
FOR DELETE
AS
BEGIN
	UPDATE HOADON 
	SET TRIGIA = (
		SELECT ISNULL (SUM(CT.SL * SP.GIA), 0)
		FROM CTHD CT INNER JOIN SANPHAM SP ON CT.MASP = SP.MASP
		WHERE CT.SOHD = HOADON.SOHD
	)
	WHERE SOHD IN (
		SELECT SOHD 
		FROM DELETED
	)
END
-- 14.Doanh số của một khách hàng là tổng trị giá các hóa đơn mà khách hàng thành viên đó đã mua.
CREATE TRIGGER TRG_HD_UPDATE_INSERT ON HOADON
FOR INSERT, UPDATE
AS
BEGIN 
	UPDATE KHACHHANG 
	SET DOANHSO = (
		SELECT ISNULL(SUM(HD.TRIGIA), 0)
		FROM HOADON HD 
		WHERE HD.MAKH = KHACHHANG.MAKH
	)
	WHERE MAKH IN (
		SELECT MAKH FROM INSERTED
		UNION
		SELECT MAKH FROM DELETED
	)
END

CREATE TRIGGER TRG_HD_DELETE ON HOADON
FOR DELETE
AS
BEGIN
	UPDATE KHACHHANG
	SET DOANHSO = (
		SELECT ISNULL(SUM(HD.TRIGIA), 0)
		FROM HOADON HD
		WHERE HD.MAKH = KHACHHANG.MAKH
	)
	WHERE MAKH IN (
		SELECT MAKH
		FROM DELETED
	)
END


-- Bài tập 2: Sinh viên hoàn thành Phần I bài tập QuanLyGiaoVu câu 9, 10 và từ câu 15 đến câu 24.
-- 9.Lớp trưởng của một lớp phải là học viên của lớp đó.
CREATE TRIGGER TRG_LOP_INSERT_UPDATE ON LOP
FOR INSERT, UPDATE
AS
BEGIN
	IF (UPDATE(TRGLOP) OR UPDATE(MALOP))
	BEGIN
		IF EXISTS (
			SELECT *
			FROM INSERTED I LEFT JOIN HOCVIEN HV ON I.TRGLOP = HV.MAHV
			WHERE HV.MALOP <> I.MALOP
		)
		BEGIN
			ROLLBACK TRANSACTION
		END
	END
END

CREATE TRIGGER TRG_HOCVIEN_LOPTRUONG ON HOCVIEN
FOR DELETE, UPDATE
AS 
BEGIN
	IF NOT EXISTS (SELECT * FROM INSERTED)
	BEGIN
		IF EXISTS (
			SELECT *
			FROM DELETED HV INNER JOIN LOP L ON HV.MAHV = L.TRGLOP
			WHERE L.MALOP = HV.MALOP
		)
		BEGIN
			ROLLBACK TRANSACTION
		END
	END
	IF UPDATE(MALOP)
	BEGIN
		IF EXISTS (
			SELECT * 
			FROM INSERTED HV INNER JOIN LOP L ON HV.MAHV = L.TRGLOP
			WHERE HV.MALOP <> L.MALOP
		)
		BEGIN
			ROLLBACK TRANSACTION
		END
	END
END
-- 10.Trưởng khoa phải là giáo viên thuộc khoa và có học vị “TS” hoặc “PTS”.
CREATE TRIGGER TRG_KHOA_TRGKHOA ON KHOA
FOR INSERT, UPDATE
AS
BEGIN
	IF (EXISTS (SELECT * FROM INSERTED)) OR UPDATE(TRGKHOA)
	BEGIN
		IF EXISTS (
			SELECT *
			FROM INSERTED K INNER JOIN GIAOVIEN GV ON K.TRGKHOA = GV.MAGV
			WHERE 
			(K.MAKHOA <> GV.MAKHOA)
			OR
			(GV.HOCVI NOT IN ('TS', 'PTS'))
		)
		BEGIN
			ROLLBACK TRANSACTION
		END
	END
END

CREATE TRIGGER TRG_GIAOVIEN_TRGKHOA ON GIAOVIEN
FOR DELETE, UPDATE
AS 
BEGIN
	IF UPDATE(MAKHOA) OR UPDATE(HOCVI)
	BEGIN
		IF EXISTS (
			SELECT * 
			FROM INSERTED GV INNER JOIN KHOA K ON GV.MAGV = K.TRGKHOA
			WHERE
			(K.MAKHOA <> GV.MAKHOA)
			OR 
			(GV.HOCVI NOT IN ('TS', 'PTS'))
		)
		BEGIN
			ROLLBACK TRANSACTION
		END
	END

	IF NOT EXISTS (SELECT * FROM INSERTED)
	BEGIN
		IF EXISTS (
			SELECT * 
			FROM DELETED GV INNER JOIN KHOA K ON GV.MAGV = K.TRGKHOA
		)
		BEGIN
			ROLLBACK TRANSACTION
		END
	END
END

-- 15.Học viên chỉ được thi một môn học nào đó khi lớp của học viên đã học xong môn học này.
CREATE TRIGGER TRG_KQT_INSERT_UPDATE ON KETQUATHI
FOR INSERT, UPDATE
AS
BEGIN
	IF (UPDATE(NGTHI))
	IF EXISTS (
		SELECT *
		FROM INSERTED KQT INNER JOIN GIANGDAY GD ON KQT.MAMH = GD.MAMH
		INNER JOIN HOCVIEN HV ON HV.MAHV = KQT.MAHV
		WHERE KQT.NGTHI > GD.DENNGAY
	)
	BEGIN
		ROLLBACK TRANSACTION
	END
END

CREATE TRIGGER TRG_GD_UPDATE ON GIANGDAY
FOR UPDATE
AS
BEGIN
	IF (UPDATE(DENNGAY) OR UPDATE(MAMH))
	IF EXISTS(
		SELECT *
		FROM INSERTED GD INNER JOIN KETQUATHI KQT ON KQT.MAMH = GD.MAMH
		INNER JOIN HOCVIEN HV ON HV.MAHV = KQT.MAHV
		WHERE GD.DENNGAY > KQT.NGTHI
	)
	BEGIN
		ROLLBACK TRANSACTION
	END
END

-- 16.Mỗi học kỳ của một năm học, một lớp chỉ được học tối đa 3 môn.
CREATE TRIGGER TRG_GIANGDAY_LIMIT_MONHOC ON GIANGDAY
FOR INSERT, UPDATE
AS 
BEGIN
	IF (EXISTS (SELECT * FROM INSERTED)) OR (UPDATE(MALOP) OR UPDATE(HOCKY) OR UPDATE(NAM))
	BEGIN
		IF EXISTS (
			SELECT GD.MALOP, GD.HOCKY, GD.NAM, COUNT(*) AS SOLUONG_MONHOC
			FROM INSERTED I INNER JOIN GIANGDAY GD ON I.MALOP = GD.MALOP AND I.HOCKY = GD.HOCKY AND I.NAM = GD.NAM
			GROUP BY GD.MALOP, GD.HOCKY, GD.NAM
			HAVING COUNT(*) > 3
		)
		BEGIN
			ROLLBACK TRANSACTION
		END
	END
END

-- 17.Sỉ số của một lớp bằng với số lượng học viên thuộc lớp đó.
CREATE TRIGGER TRG_HOCVIEN_CAPNHAT_SISO ON HOCVIEN
FOR INSERT, DELETE, UPDATE
AS
BEGIN
	UPDATE LOP
	SET SISO = (
		SELECT COUNT(HV.MAHV)
		FROM HOCVIEN HV
		WHERE HV.MALOP = LOP.MALOP
	)
	WHERE MALOP IN (
		SELECT MALOP FROM INSERTED
		UNION
		SELECT MALOP FROM DELETED
	)
END

CREATE TRIGGER TRG_LOP_SISO ON LOP
FOR UPDATE
AS 
BEGIN
	IF (UPDATE(SISO))
	BEGIN
		IF EXISTS (
			SELECT I.MALOP, I.SISO
			FROM INSERTED I LEFT JOIN HOCVIEN HV ON I.MALOP = HV.MALOP
			GROUP BY I.MALOP, I.SISO
			HAVING COUNT(HV.MAHV) <> I.SISO
		)
		BEGIN
			ROLLBACK TRANSACTION
		END
	END
END

-- 18.Trong quan hệ DIEUKIEN giá trị của thuộc tính MAMH và MAMH_TRUOC trong cùng một bộ không được giống nhau (“A”,”A”) và cũng không tồn tại hai bộ (“A”,”B”) và (“B”,”A”).

-- 19.Các giáo viên có cùng học vị, học hàm, hệ số lương thì mức lương bằng nhau.
CREATE TRIGGER TRG_GIAOVIEN_HSLUONG ON GIAOVIEN
FOR INSERT, UPDATE
AS
BEGIN
	IF (EXISTS (SELECT * FROM INSERTED)) OR (UPDATE(HOCVI) OR UPDATE(HOCHAM) OR UPDATE(HESO) OR UPDATE(MUCLUONG))
	BEGIN
		IF EXISTS (
			SELECT *
			FROM INSERTED I INNER JOIN GIAOVIEN GV ON I.HOCVI = GV.HOCVI AND I.HOCHAM = GV.HOCHAM
			AND I.HESO = GV.HESO
			WHERE I.MUCLUONG <> GV.MUCLUONG AND I.MAGV <> GV.MAGV
		)
		BEGIN
			ROLLBACK TRANSACTION
		END
	END
END

-- 20.Học viên chỉ được thi lại (lần thi >1) khi điểm của lần thi trước đó dưới 5.
CREATE TRIGGER TRG_KQT_THILAI ON KETQUATHI
FOR INSERT, UPDATE
AS
BEGIN
	IF (EXISTS (SELECT * FROM INSERTED)) OR UPDATE(LANTHI)
	BEGIN
		IF EXISTS (
			SELECT *
			FROM INSERTED I INNER JOIN KETQUATHI KQT ON KQT.MAHV = I.MAHV AND KQT.MAMH = I.MAMH
			WHERE I.LANTHI > 1 
			AND KQT.LANTHI = I.LANTHI - 1 
			AND KQT.DIEM >= 5
		)
		BEGIN
			ROLLBACK TRANSACTION
		END
	END
END

-- 21.Ngày thi của lần thi sau phải lớn hơn ngày thi của lần thi trước (cùng học viên, cùng môn học).
CREATE TRIGGER TRG_KQT_NGTHI ON KETQUATHI
FOR INSERT, UPDATE
AS
BEGIN
	IF (EXISTS (SELECT * FROM INSERTED)) OR UPDATE(NGTHI)
	BEGIN
		IF EXISTS (
			SELECT *
			FROM INSERTED I INNER JOIN KETQUATHI KQT ON I.MAHV = KQT.MAHV AND I.MAMH = KQT.MAMH
			WHERE 
				(I.LANTHI > KQT.LANTHI AND I.NGTHI <= KQT.NGTHI)
				OR 
				(I.LANTHI < KQT.LANTHI AND I.NGTHI >= KQT.NGTHI)
		)
		BEGIN
			ROLLBACK TRANSACTION
		END
	END
END

-- 22.Khi phân công giảng dạy một môn học, phải xét đến thứ tự trước sau giữa các môn học (sau khi học xong những môn học phải học trước mới được học những môn liền sau).

-- 23.Giáo viên chỉ được phân công dạy những môn thuộc khoa giáo viên đó phụ trách.
CREATE TRIGGER TRG_GIANGDAY_KHOA ON GIANGDAY
FOR INSERT, UPDATE
AS
BEGIN
	IF (EXISTS (SELECT * FROM INSERTED)) OR UPDATE(MAGV) OR UPDATE(MAMH)
	BEGIN
		IF EXISTS (
			SELECT *
			FROM INSERTED GD INNER JOIN GIAOVIEN GV ON GD.MAGV = GV.MAGV 
			INNER JOIN MONHOC MH ON MH.MAMH = GD.MAMH
			WHERE GV.MAKHOA <> MH.MAKHOA
		)
		BEGIN
			ROLLBACK TRANSACTION
		END
	END
END




----------------------------------- QLBH -----------------------------------
-- I. Ngôn ngữ định nghĩa dữ liệu (Data Definition Language):
-- 1.Tạo các quan hệ và khai báo các khóa chính, khóa ngoại của quan hệ.
CREATE TABLE KHACHHANG
(
	MAKH	CHAR(4) PRIMARY KEY,
	HOTEN	VARCHAR(40),
	DCHI	VARCHAR(50),
	SODT	VARCHAR(20),
	NGSINH	SMALLDATETIME,
	NGDK	SMALLDATETIME,
	DOANHSO	MONEY
)
CREATE TABLE NHANVIEN
(
	MANV	CHAR(4) PRIMARY KEY,
	HOTEN	VARCHAR(40),
	SODT	VARCHAR(20),
	NGVL	SMALLDATETIME
)
CREATE TABLE SANPHAM
(
	MASP	CHAR(4) PRIMARY KEY,
	TENSP	VARCHAR(40),
	DVT		VARCHAR(20),
	NUOCSX	VARCHAR(40),
	GIA		MONEY
)
CREATE TABLE HOADON
(
	SOHD	INT PRIMARY KEY,
	NGHD	SMALLDATETIME,
	MAKH	CHAR(4) REFERENCES KHACHHANG(MAKH),
	MANV	CHAR(4) REFERENCES NHANVIEN(MANV),
	TRIGIA	MONEY
)
CREATE TABLE CTHD
(
	SOHD	INT REFERENCES HOADON(SOHD),
	MASP	CHAR(4) REFERENCES SANPHAM(MASP),
	SL		INT
	PRIMARY KEY(SOHD, MASP)
)

-- 2.Thêm vào thuộc tính GHICHU có kiểu dữ liệu varchar(20) cho quan hệ SANPHAM.
ALTER TABLE SANPHAM ADD GHICHU VARCHAR(20)
-- 3.Thêm vào thuộc tính LOAIKH có kiểu dữ liệu là tinyint cho quan hệ KHACHHANG.
ALTER TABLE KHACHHANG ADD LOAIKH TINYINT
-- 4.Sửa kiểu dữ liệu của thuộc tính GHICHU trong quan hệ SANPHAM thành varchar(100).
ALTER TABLE SANPHAM ALTER COLUMN GHICHU VARCHAR(100)
-- 5.Xóa thuộc tính GHICHU trong quan hệ SANPHAM.
ALTER TABLE SANPHAM DROP COLUMN GHICHU
-- 6.Làm thế nào để thuộc tính LOAIKH trong quan hệ KHACHHANG có thể lưu các giá trị là: “Vang lai”, “Thuong xuyen”, “Vip”…
ALTER TABLE KHACHHANG ADD CONSTRAINT CK_LKH CHECK (LOAIKH IN ('Vang lai', 'Thuong xuyen', 'Vip'))
-- 7.Đơn vị tính của sản phẩm chỉ có thể là (“cay”,”hop”,”cai”,”quyen”,”chuc”)
ALTER TABLE SANPHAM ADD CONSTRAINT CK_DVT CHECK (DVT IN ('cay', 'hop', 'cai', 'quyen', 'chuc'))
-- 8.Giá bán của sản phẩm từ 500 đồng trở lên.
ALTER TABLE SANPHAM ADD CONSTRAINT CK_GIA CHECK (GIA > 500)
-- 9.Mỗi lần mua hàng, khách hàng phải mua ít nhất 1 sản phẩm.
ALTER TABLE CTHD ADD CONSTRAINT CK_SL CHECK (SL >= 1)
-- 10.Ngày khách hàng đăng ký là khách hàng thành viên phải lớn hơn ngày sinh của người đó.
ALTER TABLE KHACHHANG ADD CONSTRAINT CK_NGDK CHEECK (NGDK > NGSINH)
-- 11.Ngày mua hàng (NGHD) của một khách hàng thành viên sẽ lớn hơn hoặc bằng ngày khách hàng đó đăng ký thành viên (NGDK).
CREATE TRIGGER TRG_HOADON_NGHD_NGDK ON HOADON
FOR INSERT, UPDATE
AS
BEGIN
	IF (EXISTS (SELECT * FROM INSERTED)) OR UPDATE(NGHD) OR UPDATE(MAKH)
	BEGIN
	IF EXISTS (
		SELECT *
		FROM INSERTED HD INNER JOIN KHACHHANG KH ON HD.MAKH = KH.MAKH
		WHERE HD.NGHD < KH.NGDK
	)
	BEGIN
		ROLLBACK TRANSACTION
	END
	END
END
CREATE TRIGGER TRG_KHACHHANG_NGHD_NGDK ON KHACHHANG
FOR UPDATE
AS
BEGIN
	IF (UPDATE(NGDK))
	BEGIN
		IF EXISTS (
			SELECT * 
			FROM INSERTED KH INNER JOIN HOADON HD ON KH.MAKH = HD.MAKH
			WHERE HD.NGHD < KH.NGDK
		)
		BEGIN
			ROLLBACK TRANSACTION
		END
	END
END

-- 12.Ngày bán hàng (NGHD) của một nhân viên phải lớn hơn hoặc bằng ngày nhân viên đó vào làm.
CREATE TRIGGER TRG_HOADON_NGHD_NGVL ON HOADON
FOR INSERT, UPDATE
AS
BEGIN
	IF (EXISTS (SELECT * FROM INSERTED)) OR UPDATE(NGHD) OR UPDATE(MANV)
	BEGIN
		IF EXISTS (
			SELECT * 
			FROM INSERTED HD INNER JOIN NHANVIEN NV ON HD.MANV = NV.MANV
			WHERE HD.NGHD < NV.NGVL
		)
		BEGIN
			ROLLBACK TRANSACTION
		END
	END
END
CREATE TRIGGER TRG_NHANVIEN_NGHD_NGVL ON NHANVIEN
FOR UPDATE
AS
BEGIN	
	IF UPDATE(NGVL)
	BEGIN
		IF EXISTS (
			SELECT * 
			FROM INSERTED NV INNER JOIN HOADON HD ON NV.MANV = HD.MANV
			WHERE HD.NGHD < NV.NGVL
		)
		BEGIN
			ROLLBACK TRANSACTION
		END
	END
END

-- 13.Trị giá của một hóa đơn là tổng thành tiền (số lượng*đơn giá) của các chi tiết thuộc hóa đơn đó.
CREATE TRIGGER TRG_CTHD_TRIGIA ON CTHD
FOR INSERT, UPDATE, DELETE
AS 
BEGIN
	UPDATE HOADON
	SET TRIGIA = (
		SELECT SUM(CT.SL * SP.GIA)
		FROM CTHD CT INNER JOIN SANPHAM SP ON CT.MASP = SP.MASP
		WHERE CT.SOHD = HOADON.SOHD
	)
	WHERE SOHD IN (
		SELECT SOHD FROM INSERTED 
		UNION
		SELECT SOHD FROM DELETED
	)
END

CREATE TRIGGER TRG_SANPHAM_TRIGIA ON SANPHAM
FOR INSERT
AS
BEGIN
	IF UPDATE(GIA)
	UPDATE HOADON
	SET TRIGIA = (
		SELECT ISNULL(SUM(CT.SL * SP.GIA), 0)
		FROM CTHD CT INNER JOIN SANPHAM SP ON CT.MASP = SP.MASP
		WHERE CT.SOHD = HOADON.SOHD
	)
	WHERE SOHD IN (
		SELECT SOHD FROM INSERTED 
		UNION
		SELECT SOHD FROM DELETED
	)
END

-- 14.Doanh số của một khách hàng là tổng trị giá các hóa đơn mà khách hàng thành viên đó đã mua.
CREATE TRIGGER TRG_HOADON_DOANHTHU ON HOADON
FOR INSERT, UPDATE, DELETE
AS
BEGIN
	UPDATE KHACHHANG
	SET DOANHSO = (
		SELECT SUM(HD.TRIGIA)
		FROM HOADON HD 
		WHERE HD.MAKH = KHACHHANG.MAKH
	)
	WHERE MAKH IN (
		SELECT MAKH FROM INSERTED 
		UNION
		SELECT MAKH FROM DELETED
	)
END

-- II. Ngôn ngữ thao tác dữ liệu (Data Manipulation Language):
-- 2.Tạo quan hệ SANPHAM1 chứa toàn bộ dữ liệu của quan hệ SANPHAM. Tạo quan hệ KHACHHANG1 chứa toàn bộ dữ liệu của quan hệ KHACHHANG.
SELECT * INTO SANPHAM1 FROM SANPHAM
SELECT * INTO KHACHHANG1 FROM KHACHHANG
-- 3.Cập nhật giá tăng 5% đối với những sản phẩm do “Thai Lan” sản xuất (cho quan hệ SANPHAM1)
UPDATE SANPHAM1
SET GIA = GIA * 1.05
WHERE NUOCSX = 'Thai Lan'
-- 4.Cập nhật giá giảm 5% đối với những sản phẩm do “Trung Quoc” sản xuất có giá từ 10.000 trở xuống (cho quan hệ SANPHAM1).
UPDATE SANPHAM1
SET GIA = GIA * 0.95
WHERE NUOCSX = 'Trung Quoc' AND GIA <= 10000
-- 5.Cập nhật giá trị LOAIKH là “Vip” đối với những khách hàng đăng ký thành viên trước ngày 1/1/2007 có doanh số từ 10.000.000 trở lên hoặc khách hàng đăng ký thành viên từ 1/1/2007 trở về sau có doanh số từ 2.000.000 trở lên (cho quan hệ KHACHHANG1).
UPDATE KHACHHANG1
SET LOAIKH = 'Vip'
WHERE NGDK < '1/1/2007' AND DOANHSO >= 10000000
OR NGDK > '1/1/2007' AND DOANHSO >= 2000000

-- III. Ngôn ngữ truy vấn dữ liệu có cấu trúc:
-- 1.In ra danh sách các sản phẩm (MASP,TENSP) do “Trung Quoc” sản xuất.
SELECT MASP, TENSP FROM SANPHAM WHERE NUOCSX = 'Trung Quoc'
-- 2.In ra danh sách các sản phẩm (MASP, TENSP) có đơn vị tính là “cay”, ”quyen”.
SELECT MASP, TENSP FROM SANPHAM WHERE DVT IN ('cay', 'quyen')
-- 3.In ra danh sách các sản phẩm (MASP,TENSP) có mã sản phẩm bắt đầu là “B” và kết thúc là “01”.
SELECT MASP, TENSP FROM SANPHAM WHERE MASP LIKE 'B%01'
-- 4.In ra danh sách các sản phẩm (MASP,TENSP) do “Trung Quốc” sản xuất có giá từ 30.000 đến 40.000.
SELECT MASP, TENSP FROM SANPHAM WHERE NUOCSX = 'Trung Quoc' AND GIA BETWEEN 30000 AND 40000
-- 5.In ra danh sách các sản phẩm (MASP,TENSP) do “Trung Quoc” hoặc “Thai Lan” sản xuất có giá từ 30.000 đến 40.000.
SELECT MASP, TENSP FROM SANPHAM WHERE NUOCSX IN ('Trung Quoc', 'Thai Lan') AND GIA BETWEEN 30000 AND 40000
-- 6.In ra các số hóa đơn, trị giá hóa đơn bán ra trong ngày 1/1/2007 và ngày 2/1/2007.
SELECT SOHD, TRIGIA FROM HOADON WHERE NGHD = '1/1/2007' OR NGHD = '2/1/2007'
-- 7.In ra các số hóa đơn, trị giá hóa đơn trong tháng 1/2007, sắp xếp theo ngày (tăng dần) và trị giá của hóa đơn (giảm dần).
SELECT SOHD, TRIGIA 
FROM HOADON
WHERE MONTH(NGHD) = 1 AND YEAR(NGHD) = 2007 
ORDER BY NGHD ASC, TRIGIA DESC
-- 8.In ra danh sách các khách hàng (MAKH, HOTEN) đã mua hàng trong ngày 1/1/2007.
SELECT KH.MAKH, KH.HOTEN
FROM KHACHHANG KH INNER JOIN HOADON HD ON KH.MAKH = HD.MAKH
WHERE HD.NGHD = '1/1/2007'
-- 9.In ra số hóa đơn, trị giá các hóa đơn do nhân viên có tên “Nguyen Van B” lập trong ngày 28/10/2006.
SELECT HD.SOHD, HD.TRIGIA
FROM HOADON HD INNER JOIN NHANVIEN NV ON HD.MANV = NV.MANV
WHERE NV.HOTEN = 'Nguyen Van B' AND HD.NGHD = '28/10/2006'
-- 10.In ra danh sách các sản phẩm (MASP,TENSP) được khách hàng có tên “Nguyen Van A” mua trong tháng 10/2006.
SELECT SP.MASP, SP.TENSP
FROM SANPHAM SP INNER JOIN CTHD CT ON SP.MASP = CT.MASP
INNER JOIN HOADON HD ON HD.SOHD = CT.SOHD
INNER JOIN KHACHHANG KH ON KH.MAKH = HD.MAKH
WHERE KH.HOTEN = 'Nguyen Van A' AND MONTH(HD.NGHD) = 10 AND YEAR(HD.NGHD) = 2006
-- 11.Tìm các số hóa đơn đã mua sản phẩm có mã số “BB01” hoặc “BB02”.
SELECT HD.SOHD FROM HOADON HD INNER JOIN CTHD CT ON HD.SOHD = CT.SOHD WHERE CT.MASP = 'BB01'
UNION
SELECT HD.SOHD FROM HOADON HD INNER JOIN CTHD CT ON HD.SOHD = CT.SOHD WHERE CT.MASP = 'BB02'
-- 12.Tìm các số hóa đơn đã mua sản phẩm có mã số “BB01” hoặc “BB02”, mỗi sản phẩm mua với số lượng từ 10 đến 20.
SELECT HD.SOHD FROM HOADON HD INNER JOIN CTHD CT ON CT.SOHD = HD.SOHD WHERE CT.MASP = 'BB01' AND CT.SL BETWEEN 10 AND 20
UNION
SELECT HD.SOHD FROM HOADON HD INNER JOIN CTHD CT ON CT.SOHD = HD.SOHD WHERE CT.MASP = 'BB02' AND CT.SL BETWEEN 10 AND 20
-- 13.Tìm các số hóa đơn mua cùng lúc 2 sản phẩm có mã số “BB01” và “BB02”, mỗi sản phẩm mua với số lượng từ 10 đến 20.
SELECT HD.SOHD FROM HOADON HD INNER JOIN CTHD CT ON CT.SOHD = HD.SOHD WHERE CT.MASP = 'BB01' AND CT.SL BETWEEN 10 AND 20
INTERSECT
SELECT HD.SOHD FROM HOADON HD INNER JOIN CTHD CT ON CT.SOHD = HD.SOHD WHERE CT.MASP = 'BB02' AND CT.SL BETWEEN 10 AND 20
-- 14.In ra danh sách các sản phẩm (MASP,TENSP) do “Trung Quoc” sản xuất hoặc các sản phẩm được bán ra trong ngày 1/1/2007.
SELECT SP.MASP, SP.TENSP
FROM SANPHAM SP INNER JOIN CTHD CT ON SP.MASP = CT.MASP
INNER JOIN HOADON HD ON CT.SOHD = HD.SOHD
WHERE SP.NUOCSX = 'Trung Quoc' 
OR HD.NGHD = '1/1/2007'
-- 15.In ra danh sách các sản phẩm (MASP,TENSP) không bán được.
SELECT MASP, TENSP
FROM SANPHAM
WHERE MASP NOT IN (
	SELECT MASP FROM CTHD
)
-- 16.In ra danh sách các sản phẩm (MASP,TENSP) không bán được trong năm 2006.
SELECT MASP, TENSP
FROM SANPHAM
WHERE MASP NOT IN (
	SELECT CT.MASP 
	FROM CTHD CT INNER JOIN HOADON HD ON CT.SOHD = HD.SOHD
	WHERE YEAR(HD.NGHD) = 2006
)
-- 17.In ra danh sách các sản phẩm (MASP,TENSP) do “Trung Quoc” sản xuất không bán được trong năm 2006.
SELECT MASP, TENSP 
FROM SANPHAM
WHERE NUOCSX = 'Trung Quoc'
AND MASP NOT IN (
	SELECT CT.MASP 
	FROM CTHD CT INNER JOIN HOADON HD ON CT.SOHD = HD.SOHD
	WHERE YEAR(HD.NGHD) = 2006
)
-- 18.Tìm số hóa đơn trong năm 2006 đã mua ít nhất tất cả các sản phẩm do Singapore sản xuất.
SELECT HD.SOHD
FROM HOADON HD 
WHERE YEAR(HD.NGHD) = 2006
AND NOT EXISTS (
	SELECT 1
	FROM SANPHAM SP 
	WHERE SP.NUOCSX = 'Singapore'
	AND NOT EXISTS (
		SELECT 1 
		FROM CTHD CT 
		WHERE CT.SOHD = HD.SOHD AND CT.MASP = SP.MASP
	)
)
-- 19.Có bao nhiêu hóa đơn không phải của khách hàng đăng ký thành viên mua?
SELECT COUNT(*)
FROM HOADON HD
WHERE NOT EXISTS (
	SELECT 1 
	FROM KHACHHANG KH 
	WHERE KH.MAKH = HD.MAKH
)
-- 20.Có bao nhiêu sản phẩm khác nhau được bán ra trong năm 2006.
SELECT COUNT(DISTINCT CT.MASP)
FROM HOADON HD INNER JOIN CTHD CT ON HD.SOHD = CT.SOHD
WHERE YEAR(HD.NGHD) = 2006
-- 21.Cho biết trị giá hóa đơn cao nhất, thấp nhất là bao nhiêu?
SELECT MAX(TRIGIA), MIN(TRIGIA) FROM HOADON 
-- 22.Trị giá trung bình của tất cả các hóa đơn được bán ra trong năm 2006 là bao nhiêu?
SELECT AVG(TRIGIA) FROM HOADON WHERE YEAR(NGHD) = 2006
-- 23.Tính doanh thu bán hàng trong năm 2006.
SELECT SUM(TRIGIA) FROM HOADON WHERE YEAR(NGHD) = 2006
-- 24.Tìm số hóa đơn có trị giá cao nhất trong năm 2006.
SELECT SOHD 
FROM HOADON 
WHERE YEAR(NGHD) = 2006 AND TRIGIA = (
	SELECT MAX(TRIGIA) FROM HOADON
)
-- 25.Tìm họ tên khách hàng đã mua hóa đơn có trị giá cao nhất trong năm 2006.
SELECT KH.HOTEN 
FROM HOADON HD INNER JOIN KHACHHANG KH ON HD.MAKH = KH.MAKH
WHERE YEAR(HD.NGHD) = 2006 AND HD.TRIGIA = (
	SELECT MAX(TRIGIA) FROM HOADON WHERE YEAR(NGHD) = 2006
)
-- 26.In ra danh sách 3 khách hàng (MAKH, HOTEN) có doanh số cao nhất.
SELECT TOP 3 MAKH, HOTEN FROM KHACHHANG ORDER BY DOANHSO DESC
-- 27.In ra danh sách các sản phẩm (MASP, TENSP) có giá bán bằng 1 trong 3 mức giá cao nhất.
SELECT MASP, TENSP FROM SANPHAM WHERE GIA IN (
	SELECT DISTINCT TOP 3 GIA FROM SANPHAM ORDER BY GIA DESC 
)
-- 28.In ra danh sách các sản phẩm (MASP, TENSP) do “Thai Lan” sản xuất có giá bằng 1 trong 3 mức giá cao nhất (của tất cả các sản phẩm).
SELECT MASP, TENSP 
FROM SANPHAM
WHERE NUOCSX = 'Thai Lan'
AND GIA IN (
	SELECT DISTINCT TOP 3 GIA FROM SANPHAM ORDER BY GIA DESC
)
-- 29.In ra danh sách các sản phẩm (MASP, TENSP) do “Trung Quoc” sản xuất có giá bằng 1 trong 3 mức giá cao nhất (của sản phẩm do “Trung Quoc” sản xuất).
SELECT MASP, TENSP 
FROM SANPHAM
WHERE NUOCSX = 'Trung Quoc'
AND GIA IN (
	SELECT DISTINCT TOP 3 GIA FROM SANPHAM WHERE NUOCSX = 'Trung Quoc' ORDER BY GIA DESC
)
-- 30.* In ra danh sách 3 khách hàng có doanh số cao nhất (sắp xếp theo kiểu xếp hạng).
SELECT TOP 3 A.MAKH, A.HOTEN, A.DOANHSO, A.RANK_KH
FROM (
	SELECT MAKH, HOTEN, DOANHSO, RANK() OVER (ORDER BY DOANHSO DESC) AS RANK_KH
	FROM KHACHHANG
) A
-- 31.Tính tổng số sản phẩm do “Trung Quoc” sản xuất.
SELECT SUM(CT.SL)
FROM CTHD CT INNER JOIN SANPHAM SP ON CT.MASP = SP.MASP
WHERE SP.NUOCSX = 'Trung Quoc'
-- 32.Tính tổng số sản phẩm của từng nước sản xuất.
SELECT SP.NUOCSX, COUNT(SP.MASP)
FROM SANPHAM SP 
GROUP BY SP.NUOCSX
-- 33.Với từng nước sản xuất, tìm giá bán cao nhất, thấp nhất, trung bình của các sản phẩm.
SELECT NUOCSX, MAX(GIA), MIN(GIA), AVG(GIA)
FROM SANPHAM
GROUP BY NUOCSX
-- 35.Tính tổng số lượng của từng sản phẩm bán ra trong tháng 10/2006.
SELECT CT.MASP, COUNT(CT.SL)
FROM CTHD CT INNER JOIN HOADON HD ON CT.SOHD = HD.SOHD
WHERE MONTH(HD.NGHD) = 10 AND YEAR(HD.NGHD) = 2006
GROUP BY CT.MASP
-- 36.Tính doanh thu bán hàng của từng tháng trong năm 2006.
SELECT MONTH(NGHD), SUM(TRIGIA) AS DOANHTHU
FROM HOADON 
WHERE YEAR(NGHD) = 2006
GROUP BY MONTH(NGHD)
-- 37.Tìm hóa đơn có mua ít nhất 4 sản phẩm khác nhau.
SELECT SOHD FROM CTHD GROUP BY SOHD HAVING COUNT (DISTINCT MASP) >= 4
-- 38.Tìm hóa đơn có mua 3 sản phẩm do “Viet Nam” sản xuất (3 sản phẩm khác nhau).
SELECT CT.SOHD
FROM CTHD CT INNER JOIN SANPHAM SP ON CT.MASP = SP.MASP
WHERE SP.NUOCSX = 'Viet Nam'
GROUP BY CT.SOHD
HAVING COUNT(DISTINCT SP.MASP) = 3
-- 39.Tìm khách hàng (MAKH, HOTEN) có số lần mua hàng nhiều nhất. 
SELECT TOP 1 WITH TIES KH.MAKH, KH.HOTEN, COUNT(HD.SOHD) AS SOLANMUAHANG
FROM KHACHHANG KH INNER JOIN HOADON HD ON KH.MAKH = HD.MAKH
GROUP BY KH.MAKH, KH.HOTEN
ORDER BY COUNT(HD.SOHD) DESC
-- 40.Tháng mấy trong năm 2006, doanh số bán hàng cao nhất ?
SELECT TOP 1 WITH TIES MONTH(NGHD), SUM(TRIGIA) AS DOANHTHU
FROM HOADON
WHERE YEAR(NGHD) = 2006
GROUP BY MONTH(NGHD)
ORDER BY SUM(TRIGIA) DESC
-- 41.Tìm sản phẩm (MASP, TENSP) có tổng số lượng bán ra thấp nhất trong năm 2006.
SELECT TOP 1 WITH TIES SP.MASP, SP.TENSP, SUM(CT.SL) 
FROM SANPHAM SP INNER JOIN CTHD CT ON SP.MASP = CT.MASP 
INNER JOIN HOADON HD ON HD.SOHD = CT.SOHD
WHERE YEAR(HD.NGHD) = 2006 
GROUP BY SP.MASP, SP.TENSP
ORDER BY SUM(CT.SL) 
-- 42.*Mỗi nước sản xuất, tìm sản phẩm (MASP,TENSP) có giá bán cao nhất.
SELECT SP1.NUOCSX, SP1.MASP, SP1.TENSP
FROM SANPHAM SP1
WHERE SP1.GIA = (
	SELECT MAX(SP2.GIA) 
	FROM SANPHAM SP2
	WHERE SP2.NUOCSX = SP1.NUOCSX
)
-- 43.Tìm nước sản xuất sản xuất ít nhất 3 sản phẩm có giá bán khác nhau.
SELECT NUOCSX
FROM SANPHAM
GROUP BY NUOCSX
HAVING COUNT(DISTINCT GIA) >= 3
-- 44.*Trong 10 khách hàng có doanh số cao nhất, tìm khách hàng có số lần mua hàng nhiều nhất.
SELECT TOP 1 WITH TIES A.MAKH, A.HOTEN,	COUNT(HD.SOHD) 
FROM (
	SELECT TOP 10 MAKH, HOTEN 
	FROM KHACHHANG
	ORDER BY DOANHSO DESC
) A
INNER JOIN HOADON HD ON A.MAKH = HD.MAKH
GROUP BY A.MAKH, A.HOTEN
ORDER BY COUNT(HD.SOHD) DESC



---------------------------- QLGV --------------------------------------------------------
-- I. Ngôn ngữ định nghĩa dữ liệu (Data Definition Language):
-- 3.Thuộc tính GIOITINH chỉ có giá trị là “Nam” hoặc “Nu”.
ALTER TABLE GIAOVIEN ADD CONSTRAINT CK_GT CHECK (GIOITINH IN ('Nam', 'Nu'))
ALTER TABLE HOCVIEN ADD CONSTRAINT CK_HV CHECK (GIOITINH IN ('Nam', 'Nu'))
-- 4.Điểm số của một lần thi có giá trị từ 0 đến 10 và cần lưu đến 2 số lẽ (VD: 6.22).
ALTER TABLE KETQUATHI ADD CONSTRAINT CK_DIEM CHECK (
	DIEM BETWEEN 0 AND 10
	AND DIEM = ROUND(DIEM, 2)
)
-- 5.Kết quả thi là “Dat” nếu điểm từ 5 đến 10  và “Khong dat” nếu điểm nhỏ hơn 5.
ALTER TABLE KETQUATHI ADD CONSTRAINT CK_KETQUA CHECK (
    (DIEM BETWEEN 5 AND 10 AND KETQUA = 'Dat')
    OR
    (DIEM < 5 AND KETQUA = 'Khong dat')
)
-- 6.Học viên thi một môn tối đa 3 lần.
ALTER TABLE KETQUATHI ADD CONSTRAINT CK_LT CHECK (LANTHI <= 3)
-- 7.Học kỳ chỉ có giá trị từ 1 đến 3.
ALTER TABLE GIANGDAY ADD CONSTRAINT CK_HK CHECK (HOCKY BETWEEN 1 AND 3)
-- 8.Học vị của giáo viên chỉ có thể là “CN”, “KS”, “Ths”, ”TS”, ”PTS”.
ALTER TABLE GIAOVIEN ADD CONSTRAINT CK_HV CHECK (HOCVI IN ('CN', 'KS', 'ThS', 'TS', 'PTS'))
-- 9.Lớp trưởng của một lớp phải là học viên của lớp đó.
CREATE TRIGGER TRG_LOP_TRGLOP ON LOP
FOR INSERT, UPDATE
AS
BEGIN
	IF (UPDATE(TRGLOP))
	BEGIN
		IF EXISTS (
			SELECT * 
			FROM INSERTED L INNER JOIN HOCVIEN HV ON L.TRGLOP = HV.MAHV
			WHERE L.MALOP <> HV.MALOP
		)
		BEGIN
			ROLLBACK TRANSACTION
		END
	END
END

CREATE TRIGGER TRG_HOCVIEN_TRGLOP ON HOCVIEN
FOR UPDATE, DELETE
AS
BEGIN	
	IF (UPDATE(MALOP))
	BEGIN
		IF EXISTS (
			SELECT * 
			FROM INSERTED HV INNER JOIN LOP L ON HV.MAHV = L.TRGLOP
			WHERE L.MALOP <> HV.MALOP
		)
		BEGIN
			ROLLBACK TRANSACTION
		END
	END
	IF EXISTS (SELECT * FROM DELETED)
	BEGIN
		IF EXISTS (
			SELECT * 
			FROM DELETED HV INNER JOIN LOP L ON HV.MAHV = L.TRGLOP
			WHERE HV.MAHV = L.TRGLOP
		)
		BEGIN
			ROLLBACK TRANSACTION
		END
	END
END
-- 10.Trưởng khoa phải là giáo viên thuộc khoa và có học vị “TS” hoặc “PTS”.
CREATE TRIGGER TRG_KHOA_TRGKHOA ON KHOA
FOR INSERT, UPDATE
AS
BEGIN
	IF (UPDATE(TRGKHOA))
	BEGIN
		IF EXISTS (
			SELECT *
			FROM INSERTED K INNER JOIN GIAOVIEN GV ON K.TRGKHOA = GV.MAGV
			WHERE K.MAKHOA <> GV.MAKHOA
			OR
			GV.HOCVI NOT IN ('TS', 'PTS')
		)
		BEGIN
			ROLLBACK TRANSACTION
		END
	END
END

CREATE TRIGGER TRG_GIAOVIEN_TRGKHOA ON GIAOVIEN
FOR DELETE, UPDATE
AS
BEGIN
	IF (UPDATE(MAKHOA) OR UPDATE(HOCVI))
	BEGIN
		IF EXISTS (
			SELECT * 
			FROM INSERTED GV INNER JOIN KHOA K ON GV.MAGV = K.TRGKHOA
			WHERE K.MAKHOA <> GV.MAKHOA
			OR 
			GV.HOCVI NOT IN ('TS', 'PTS')
		)
		BEGIN
			ROLLBACK TRANSACTION 
		END
	END

	IF (EXISTS (SELECT * FROM DELETED))
	BEGIN
		IF EXISTS (
			SELECT * 
			FROM DELETED GV INNER JOIN KHOA K ON GV.MAGV = K.TRGKHOA
			WHERE GV.MAKHOA = K.MAKHOA
			)
		BEGIN
			ROLLBACK TRANSACTION
		END
	END
END
-- 11.Học viên ít nhất là 18 tuổi.
ALTER TABLE HOCVIEN ADD CONSTRAINT CK_TUOI CHECK (YEAR(GETDATE()) - YEAR(NGSINH) >= 18)
-- 12.Giảng dạy một môn học ngày bắt đầu (TUNGAY) phải nhỏ hơn ngày kết thúc (DENNGAY).
ALTER TABLE GIANGDAY ADD CONSTRAINT CK_GD CHECK (TUNGAY < DENNGAY)
-- 13.Giáo viên khi vào làm ít nhất là 22 tuổi.
ALTER TABLE GIAOVIEN ADD CONSTRAINT CK_TUOI CHECK (YEAR(NGVL) - YEAR(NGSINH) >= 22)
-- 14.Tất cả các môn học đều có số tín chỉ lý thuyết và tín chỉ thực hành chênh lệch nhau không quá 3.
ALTER TABLE MONHOC ADD CONSTRAINT CHECK (ABS(TCLT - TCTH) <= 3)
-- 15.Học viên chỉ được thi một môn học nào đó khi lớp của học viên đã học xong môn học này.
CREATE TRIGGER TRG_GIANGDAY_NGTHI ON GIANGDAY
FOR UPDATE
AS
BEGIN
	IF (UPDATE(DENNGAY))
	BEGIN	
		IF EXISTS (
			SELECT * 
			FROM INSERTED GD INNER JOIN KETQUATHI KQT ON GD.MAMH = KQT.MAMH
			INNER JOIN HOCVIEN HV ON HV.MAHV = KQT.MAHV
			WHERE KQT.NGTHI < GD.DENNGAY
		)
		BEGIN
			ROLLBACK TRANSACTION
		END
	END
END

CREATE TRIGGER TRG_KETQUATHI_NGTHI ON KETQUATHI
FOR INSERT, UPDATE
AS
BEGIN
	IF (UPDATE(NGTHI))
	BEGIN
		IF EXISTS (
			SELECT * 
			FROM INSERTED KQT INNER JOIN GIANGDAY GD ON KQT.MAMH = GD.MAMH
			INNER JOIN HOCVIEN HV ON HV.MAHV = KQT.MAHV
			WHERE KQT.NGTHI < GD.DENNGAY
		)
		BEGIN
			ROLLBACK TRANSACTION
		END
	END
END
-- 16.Mỗi học kỳ của một năm học, một lớp chỉ được học tối đa 3 môn.
CREATE TRIGGER TRG_GIANGDAY_MAX ON GIANGDAY
FOR INSERT, UPDATE
AS
BEGIN
	IF UPDATE(HOCKY) OR UPDATE(NAM)
	BEGIN
		IF EXISTS (
			SELECT GD.MALOP, GD.HOCKY, GD.NAM, COUNT(GD.MAMH)
			FROM INSERTED I INNER JOIN GIANGDAY GD ON I.MALOP = GD.MALOP 
			AND I.HOCKY = GD.HOCKY AND I.NAM = GD.NAM
			GROUP BY GD.MALOP, GD.HOCKY, GD.NAM
			HAVING COUNT(GD.MAMH) > 3
		)
		BEGIN
			ROLLBACK TRANSACTION
		END
	END
END
-- 17.Sỉ số của một lớp bằng với số lượng học viên thuộc lớp đó.
CREATE TRIGGER TRG_HOCVIEN_SISO ON HOCVIEN
FOR INSERT, UPDATE, DELETE
AS
BEGIN
	UPDATE LOP
	SET SISO = (
		SELECT COUNT(HV.MAHV)
		FROM HOCVIEN HV 
		WHERE HV.MALOP = LOP.MALOP
	)
	WHERE MALOP IN (
		SELECT MALOP FROM INSERTED 
		UNION 
		SELECT MALOP FROM DELETED
	)
END
-- 19.Các giáo viên có cùng học vị, học hàm, hệ số lương thì mức lương bằng nhau.
CREATE TRIGGER TRG_GIAOVIEN_LUONG ON GIAOVIEN
FOR INSERT, UPDATE
AS
BEGIN
	IF (UPDATE(HOCVI) OR UPDATE(HOCHAM) OR UPDATE(HESO) OR UPDATE(MUCLUONG))
	BEGIN
		IF EXISTS (
			SELECT * 
			FROM INSERTED I INNER JOIN GIAOVIEN GV ON I.HOCVI = GV.HOCVI
			AND I.HOCHAM = GV.HOCHAM AND I.HESO = GV.HESO
			WHERE I.MAGV <> GV.MAGV AND I.MUCLUONG <> GV.MUCLUONG
		)
		BEGIN
			ROLLBACK TRANSACTION
		END
	END
END
-- 20.Học viên chỉ được thi lại (lần thi >1) khi điểm của lần thi trước đó dưới 5.
CREATE TRIGGER TRG_KETQUATHI_THILAI ON KETQUATHI
FOR INSERT, UPDATE
AS
BEGIN
	IF (UPDATE(LANTHI) OR UPDATE(DIEM))
	BEGIN
		IF EXISTS (
			SELECT * 
			FROM INSERTED I INNER JOIN KETQUATHI KQT ON I.MAHV = KQT.MAHV AND I.MAMH = KQT.MAMH
			WHERE I.LANTHI > 1
			AND KQT.LANTHI = I.LANTHI - 1
			AND KQT.DIEM >= 5
		)
		BEGIN
			ROLLBACK TRANSACTION
		END
	END
END
-- 21.Ngày thi của lần thi sau phải lớn hơn ngày thi của lần thi trước (cùng học viên, cùng môn học).
CREATE TRIGGER TRG_KETQUATHI_THILAI2 ON KETQUATHI
FOR INSERT, UPDATE
AS 
BEGIN
	IF (UPDATE(NGTHI) OR UPDATE(LANTHI))
	BEGIN
		IF EXISTS (
			SELECT * 
			FROM INSERTED I INNER JOIN KETQUATHI KQT ON I.MAHV = KQT.MAHV AND I.MAMH = KQT.MAMH
			WHERE 
			I.LANTHI > KQT.LANTHI AND I.NGTHI <= KQT.NGTHI
			OR 
			I.LANTHI < KQT.LANTHI AND I.NGTHI >= KQT.NGTHI
		)
		BEGIN
			ROLLBACK TRANSACTION
		END
	END
END
-- 23.Giáo viên chỉ được phân công dạy những môn thuộc khoa giáo viên đó phụ trách.
CREATE TRIGGER TRG_GIANGDAY_GV ON GIANGDAY
FOR INSERT, UPDATE
AS 
BEGIN
	IF (UPDATE(MAGV))
	BEGIN
		IF EXISTS (
			SELECT *
			FROM INSERTED GD INNER JOIN GIAOVIEN GV ON GD.MAGV = GV.MAGV
			INNER JOIN MONHOC MH ON MH.MAMH = GD.MAMH
			WHERE GV.MAKHOA <> MH.MAKHOA
		)
		BEGIN
			ROLLBACK TRANSACTION
		END
	END
END

-- II. Ngôn ngữ thao tác dữ liệu (Data Manipulation Language):
-- 1.Tăng hệ số lương thêm 0.2 cho những giáo viên là trưởng khoa.
UPDATE GIAOVIEN
SET HESO = HESO + 0.2
WHERE MAGV = (
	SELECT TRGKHOA FROM KHOA
)
-- 2.Cập nhật giá trị điểm trung bình tất cả các môn học (DIEMTB) của mỗi học viên (tất cả các môn học đều có hệ số 1 và nếu học viên thi một môn nhiều lần, chỉ lấy điểm của lần thi sau cùng).
UPDATE HV
SET HV.DIEMTB = (
	SELECT AVG(KQT.DIEM * 1.0)
	FROM KETQUATHI KQT
	WHERE KQT.MAHV = HV.MAHV 
	AND KQT.LANTHI = (
		SELECT MAX(LANTHI)
		FROM KETQUATHI
		WHERE MAHV = HV.MAHV AND MAMH = KQT.MAMH
	)
)
FROM HOCVIEN HV
-- 3.	Cập nhật giá trị cho cột GHICHU là “Cam thi” đối với trường hợp: học viên có một môn bất kỳ thi lần thứ 3 dưới 5 điểm.
UPDATE HOCVIEN
SET GHICHU = 'Cam thi'
WHERE MAHV IN (
	SELECT MAHV
	FROM KETQUATHI
	WHERE LANTHI = 3 AND DIEM < 5
)
-- 4.	Cập nhật giá trị cho cột XEPLOAI trong quan hệ HOCVIEN như sau:
UPDATE HOCVIEN 
SET XEPLOAI = CASE 
	WHEN DIEMTB >= 9 THEN 'XS'
	WHEN DIEMTB >= 8 THEN 'G'
	WHEN DIEMTB >= 6.5 THEN 'K'
	WHEN DIEMTB >= 5 THEN 'TB'
	ELSE 'Y'
END

-- III. Ngôn ngữ truy vấn dữ liệu:
-- 1.In ra danh sách (mã học viên, họ tên, ngày sinh, mã lớp) lớp trưởng của các lớp.
SELECT HV.MAHV, HV.HO + ' ' + HV.TEN AS HOTEN, HV.NGSINH, HV.MALOP 
FROM LOP L INNER JOIN HOCVIEN HV ON L.TRGLOP = HV.MAHV 
-- 2.In ra bảng điểm khi thi (mã học viên, họ tên, lần thi, điểm số) môn CTRR của lớp “K12”, sắp xếp theo tên, họ học viên.
SELECT HV.MAHV, HV.HO + ' ' + HV.TEN, KQT.DIEM, KQT.DIEM
FROM  HOCVIEN HV INNER JOIN KETQUATHI KQT ON HV.MAHV = KQT.MAHV
WHERE KQT.MAMH = 'CTRR' AND LEFT(MAHV, 3) = 'K12' 
ORDER BY TEN, HO
-- 3.In ra danh sách những học viên (mã học viên, họ tên) và những môn học mà học viên đó thi lần thứ nhất đã đạt.
SELECT HV.MAHV, HV.HO + ' ' + HV.TEN AS HOTEN
FROM HOCVIEN HV INNER JOIN KETQUATHI KQT ON HV.MAHV = KQT.MAHV
WHERE KQT.LANTHI = 1 AND KQT.KQUA = 'Dat'
-- 4.In ra danh sách học viên (mã học viên, họ tên) của lớp “K11” thi môn CTRR không đạt (ở lần thi 1).
SELECT HV.MAHV, HV.HO + ' ' + HV.TEN AS HOTEN
FROM HOCVIEN HV INNER JOIN KETQUATHI KQT ON HV.MAHV = KQT.MAHV
WHERE LEFT(HV.MAHV, 3) = 'K11' AND KQT.MAMH = 'CTRR' AND KQT.LANTHI = 1 AND KQT.KQUA = 'Khong dat'
-- 5.* Danh sách học viên (mã học viên, họ tên) của lớp “K” thi môn CTRR không đạt (ở tất cả các lần thi).
SELECT DISTINCT HV.MAHV, HV.HO + ' ' + HV.TEN AS HOTEN
FROM HOCVIEN HV INNER JOIN KETQUATHI KQT ON HV.MAHV = KQT.MAHV
WHERE LEFT(HV.MAHV, 1) = 'K' AND KQT.MAMH = 'CTRR' AND KQT.KQUA = 'Khong dat'
AND NOT EXISTS (
	SELECT *
	FROM KETQUATHI KQT1
	WHERE KQT1.MAMH = 'CTRR' AND KQT1.MAHV = KQT.MAHV AND KQT.KQUA = 'Dat'
)
-- 6.Tìm tên những môn học mà giáo viên có tên “Tran Tam Thanh” dạy trong học kỳ 1 năm 2006.
SELECT DISTINCT MH.TENMH
FROM GIANGDAY GD INNER JOIN GIAOVIEN GV ON GD.MAGV = GD.MAGV
INNER JOIN MONHOC MH ON MH.MAMH = GD.MAMH
WHERE GV.HOTEN = 'Tran Tam Thanh' AND GD.HOCKY = 1 AND GD.NAM = 2006
-- 7.Tìm những môn học (mã môn học, tên môn học) mà giáo viên chủ nhiệm lớp “K11” dạy trong học kỳ 1 năm 2006.
SELECT MH.MAMH, MH.TENMH
FROM LOP L INNER JOIN GIANGDAY GD ON L.MAGVCN = GD.MAGV
INNER JOIN MONHOC MH ON MH.MAMH = GD.MAMH
WHERE L.MALOP = 'K11' AND GD.HOCKY = 1 AND GD.NAM = 2006
-- 8.Tìm họ tên lớp trưởng của các lớp mà giáo viên có tên “Nguyen To Lan” dạy môn “Co So Du Lieu”.
SELECT HV.HO + ' ' + HV.TEN AS HOTEN
FROM (
	SELECT GD.MALOP
	FROM GIANGDAY GD INNER JOIN GIAOVIEN GV ON GD.MAGV = GV.MAGV
	INNER JOIN MONHOC MH ON MH.MAMH = GD.MAMH
	WHERE GV.HOTEN = 'Nguyen To Lan' AND MH.TENMH = 'Co So Du Lieu'
) A
INNER JOIN LOP L ON L.MALOP = A.MALOP
INNER JOIN HOCVIEN HV ON L.TRGLOP = HV.MAHV
-- 9.In ra danh sách những môn học (mã môn học, tên môn học) phải học liền trước môn “Co So Du Lieu”.
SELECT MH.MAMH, MH.TENMH
FROM (
	SELECT DK.MAMH_TRUOC
	FROM DIEUKIEN DK INNER JOIN MONHOC MH ON MH.MAMH = DK.MAMH
	WHERE MH.TENMH = 'Co So Du Lieu'
) A
INNER JOIN MONHOC MH ON A.MAMH_TRUOC = MH.MAMH
-- 10.Môn “Cau Truc Roi Rac” là môn bắt buộc phải học liền trước những môn học (mã môn học, tên môn học) nào.
SELECT MH.MAMH, MH.TENMH
FROM (
	SELECT DK.MAMH
	FROM DIEUKIEN DK INNER JOIN MONHOC MH ON DK.MAMH_TRUOC = MH.MAMH
	WHERE MH.TENMH = 'Cau Truc Roi Rac'
) A
INNER JOIN MONHOC MH ON A.MAMH = MH.MAMH
-- 11.Tìm họ tên giáo viên dạy môn CTRR cho cả hai lớp “K11” và “K12” trong cùng học kỳ 1 năm 2006.
SELECT GV.HOTEN
FROM GIAOVIEN GV INNER JOIN GIANGDAY GD ON GV.MAGV = GD.MAGV
WHERE GD.MAMH = 'CTRR' AND GD.MALOP = 'K11' AND GD.HOCKY = 1 AND GD.NAM = 2006
INTERSECT 
SELECT GV.HOTEN
FROM GIAOVIEN GV INNER JOIN GIANGDAY GD ON GV.MAGV = GD.MAGV
WHERE GD.MAMH = 'CTRR' AND GD.MALOP = 'K12' AND GD.HOCKY = 1 AND GD.NAM = 2006
-- 12.Tìm những học viên (mã học viên, họ tên) thi không đạt môn CSDL ở lần thi thứ 1 nhưng chưa thi lại môn này.
SELECT HV.MAHV, HV.HO + ' ' + HV.TEN AS HOTEN
FROM KETQUATHI KQT INNER JOIN HOCVIEN HV ON KQT.MAHV = HV.MAHV
WHERE KQT.MAMH = 'CSDL' AND KQT.LANTHI = 1 AND KQT.KQUA = 'Khong dat'
AND NOT EXISTS (
	SELECT *
	FROM KETQUATHI KQT2
	WHERE KQT2.MAHV = KQT.MAHV AND KQT2.MAMH = KQT.MAMH AND KQT2.LANTHI > 1
)
-- 13.Tìm giáo viên (mã giáo viên, họ tên) không được phân công giảng dạy bất kỳ môn học nào.
SELECT GV.MAGV, GV.HOTEN
FROM GIAOVIEN GV
WHERE GV.MAGV NOT IN (
	SELECT GD.MAGV
	FROM GIANGDAY GD
)
-- 14.Tìm giáo viên (mã giáo viên, họ tên) không được phân công giảng dạy bất kỳ môn học nào thuộc khoa giáo viên đó phụ trách.
SELECT GV.MAGV, GV.HOTEN
FROM GIAOVIEN GV
WHERE NOT EXISTS (
	SELECT * 
	FROM GIANGDAY GD INNER JOIN MONHOC MH ON GD.MAMH = MH.MAMH
	WHERE MH.MAKHOA = GV.MAKHOA AND GD.MAGV = GV.MAGV
)
-- 15.Tìm họ tên các học viên thuộc lớp “K11” thi một môn bất kỳ quá 3 lần vẫn “Khong dat” hoặc thi lần thứ 2 môn CTRR được 5 điểm.
SELECT HV.HO, HV.TEN
FROM KETQUATHI KQT INNER JOIN HOCVIEN HV ON KQT.MAHV = HV.MAHV
WHERE HV.MALOP = 'K11' AND KQT.LANTHI > 3 AND KQT.KQUA = 'Khong dat'
UNION
SELECT HV.HO, HV.TEN
FROM KETQUATHI KQT INNER JOIN HOCVIEN HV ON KQT.MAHV = HV.MAHV
WHERE HV.MALOP = 'K11' AND KQT.LANTHI = 2 AND KQT.MAMH = 'CTRR' AND KQT.DIEM = 5

-- 16.Tìm họ tên giáo viên dạy môn CTRR cho ít nhất hai lớp trong cùng một học kỳ của một năm học.
SELECT GV.HOTEN
FROM GIANGDAY GD INNER JOIN GIAOVIEN GV ON GD.MAGV = GV.MAGV
WHERE GD.MAMH = 'CTRR'
GROUP BY GV.HOTEN
HAVING COUNT(GD.MALOP) >= 2
-- 17.Danh sách học viên và điểm thi môn CSDL (chỉ lấy điểm của lần thi sau cùng).
SELECT HV.MAHV, HV.HO + ' ' + HV.TEN AS HOTEN, KQT.DIEM
FROM KETQUATHI KQT INNER JOIN HOCVIEN HV ON KQT.MAHV = HV.MAHV
WHERE KQT.MAMH = 'CSDL' 
AND KQT.LANTHI = (
	SELECT MAX(LANTHI)
	FROM KETQUATHI KQT2
	WHERE KQT2.MAMH = KQT.MAMH AND KQT2.MAHV = KQT.MAHV
)
-- 18.Danh sách học viên và điểm thi môn “Co So Du Lieu” (chỉ lấy điểm cao nhất của các lần thi).
SELECT HV.MAHV, HV.HO + ' ' + HV.TEN AS HOTEN, KQT.DIEM
FROM KETQUATHI KQT INNER JOIN HOCVIEN HV ON KQT.MAHV = HV.MAHV
INNER JOIN MONHOC MH ON KQT.MAMH = MH.MAMH
WHERE MH.TENMH = 'Co So Du Lieu' 
AND KQT.DIEM = (
	SELECT MAX(DIEM)
	FROM KETQUATHI KQT2 
	WHERE KQT2.MAHV = KQT.MAHV AND KQT2.MAMH = KQT.MAMH
)
-- 19.Khoa nào (mã khoa, tên khoa) được thành lập sớm nhất.
SELECT TOP 1 WITH TIES MAKHOA, TENKHOA
FROM KHOA
ORDER BY NGTLAP 
-- 20.Có bao nhiêu giáo viên có học hàm là “GS” hoặc “PGS”.
SELECT COUNT(GV.MAGV)
FROM GIAOVIEN GV
WHERE GV.HOCHAM = 'GS' OR GV.HOCHAM = 'PGS'
-- 21.Thống kê có bao nhiêu giáo viên có học vị là “CN”, “KS”, “Ths”, “TS”, “PTS” trong mỗi khoa.
SELECT K.MAKHOA, K.TENKHOA, COUNT(GV.MAGV) AS SL
FROM KHOA K INNER JOIN GIAOVIEN GV ON K.MAKHOA = GV.MAKHOA
WHERE GV.HOCVI IN ('CN', 'KS', 'ThS', 'TS', 'PTS')
GROUP BY K.MAKHOA, K.TENKHOA
-- 22.Mỗi môn học thống kê số lượng học viên theo kết quả (đạt và không đạt).
SELECT MAMH, KQUA, COUNT(MAHV) AS SL
FROM KETQUATHI 
GROUP BY MAMH, KQUA
-- 23.Tìm giáo viên (mã giáo viên, họ tên) là giáo viên chủ nhiệm của một lớp, đồng thời dạy cho lớp đó ít nhất một môn học.
SELECT GV.MAGV, GV.HOTEN
FROM GIAOVIEN GV INNER JOIN LOP L ON L.MAGVCN = GV.MAGV
INNER JOIN GIANGDAY GD ON GD.MALOP = L.MALOP AND GD.MAGV = GV.MAGV
GROUP BY GV.MAGV, GV.HOTEN
HAVING COUNT(GD.MAMH) >= 1
-- 24.Tìm họ tên lớp trưởng của lớp có sỉ số cao nhất.
SELECT TOP 1 WITH TIES HV.HO + ' ' + HV.TEN AS HOTEN
FROM (
	SELECT HV.MALOP, COUNT(HV.MAHV) AS SISO
	FROM HOCVIEN HV
	GROUP BY HV.MALOP
) A
INNER JOIN LOP L ON A.MALOP = L.MALOP
INNER JOIN HOCVIEN HV ON HV.MAHV = L.TRGLOP
ORDER BY A.SISO DESC
-- 25.* Tìm họ tên những LOPTRG thi không đạt quá 3 môn (mỗi môn đều thi không đạt ở tất cả các lần thi).
SELECT A.HO, A.TEN
FROM (
	SELECT HV.MAHV, HV.HO, HV.TEN
	FROM HOCVIEN HV INNER JOIN KETQUATHI KQT ON HV.MAHV = KQT.MAHV
	WHERE NOT EXISTS (
		SELECT * 
		FROM KETQUATHI KQT2 
		WHERE KQT2.MAHV = KQT.MAHV AND KQT2.MAMH = KQT.MAMH
		AND KQT2.KQUA = 'Dat'
	)
	GROUP BY HV.MAHV, HV.HO, HV.TEN
	HAVING COUNT(KQT.MAMH) > 3
) A
INNER JOIN LOP L ON A.MAHV = L.TRGLOP
-- 26.Tìm học viên (mã học viên, họ tên) có số môn đạt điểm 9, 10 nhiều nhất.
SELECT TOP 1 WITH TIES HV.MAHV, HV.HO, HV.TEN, COUNT(*) AS SL
FROM KETQUATHI KQT INNER JOIN HOCVIEN HV ON KQT.MAHV = HV.MAHV
WHERE KQT.DIEM BETWEEN 9 AND 10
GROUP BY HV.MAHV, HV.HO, HV.TEN
ORDER BY COUNT(*) DESC
-- 27.Trong từng lớp, tìm học viên (mã học viên, họ tên) có số môn đạt điểm 9, 10 nhiều nhất.
SELECT HV.MALOP, HV.MAHV, HV.HO, HV.TEN, COUNT(DISTINCT KQT.MAMH) AS SL 
FROM HOCVIEN HV INNER JOIN KETQUATHI KQT ON KQT.MAHV = HV.MAHV
WHERE KQT.DIEM BETWEEN 9 AND 10
GROUP BY HV.MALOP, HV.MAHV, HV.HO, HV.TEN
HAVING COUNT(DISTINCT KQT.MAMH) >= ALL (
	SELECT COUNT(DISTINCT KQT2.MAMH)
	FROM KETQUATHI KQT2 INNER JOIN HOCVIEN HV2 ON KQT2.MAHV = HV2.MAHV
	WHERE KQT2.DIEM BETWEEN 9 AND 10 
	AND HV2.MALOP = HV.MALOP
	GROUP BY HV2.MAHV
)
-- 28.Trong từng học kỳ của từng năm, mỗi giáo viên phân công dạy bao nhiêu môn học, bao nhiêu lớp.
SELECT GD.HOCKY, GD.NAM, GV.MAGV, GV.HOTEN, COUNT(DISTINCT GD.MAMH) AS SL_MON, COUNT(DISTINCT GD.MALOP) AS SL_LOP
FROM GIANGDAY GD INNER JOIN GIAOVIEN GV ON GD.MAGV = GV.MAGV
GROUP BY GD.HOCKY, GD.NAM, GV.MAGV, GV.HOTEN
-- 29.Trong từng học kỳ của từng năm, tìm giáo viên (mã giáo viên, họ tên) giảng dạy nhiều nhất.
SELECT GD.HOCKY, GD.NAM, GV.MAGV, GV.HOTEN
FROM GIANGDAY GD INNER JOIN GIAOVIEN GV ON GD.MAGV = GV.MAGV
GROUP BY GD.HOCKY, GD.NAM, GV.MAGV, GV.HOTEN
HAVING COUNT(*) >= ALL (
	SELECT COUNT(*)
	FROM GIANGDAY GD2 INNER JOIN GIAOVIEN GV2 ON GD2.MAGV = GV2.MAGV
	WHERE GD2.HOCKY = GD.HOCKY AND GD2.NAM = GD.NAM
	GROUP BY GD2.MAGV
)

SELECT HOCKY, NAM, A.MAGV, GV.HOTEN
FROM (
	SELECT HOCKY, NAM, MAGV, RANK() OVER (PARTITION BY HOCKY, NAM ORDER BY COUNT(MAMH) DESC) RANK_MH
	FROM GIANGDAY
	GROUP BY HOCKY, NAM, MAGV
) A
INNER JOIN GIAOVIEN GV ON A.MAGV = GV.MAGV
WHERE RANK_MH = 1
-- 30.Tìm môn học (mã môn học, tên môn học) có nhiều học viên thi không đạt (ở lần thi thứ 1) nhất.
SELECT A.MAMH, A.TENMH
FROM (
	SELECT MH.MAMH, MH.TENMH, RANK() OVER (ORDER BY COUNT(KQT.MAHV) DESC) RANK_MH  
	FROM KETQUATHI KQT INNER JOIN MONHOC MH ON KQT.MAMH = MH.MAMH
	WHERE KQT.KQUA = 'Khong dat' AND KQT.LANTHI = 1
	GROUP BY MH.MAMH, MH.TENMH
) A
WHERE A.RANK_MH = 1

-- 31.Tìm học viên (mã học viên, họ tên) thi môn nào cũng đạt (chỉ xét lần thi thứ 1).
SELECT DISTINCT HV.MAHV, HV.HO, HV.TEN
FROM KETQUATHI KQT INNER JOIN HOCVIEN HV ON KQT.MAHV = HV.MAHV
WHERE KQT.LANTHI = 1 
AND NOT EXISTS (
	SELECT * 
	FROM KETQUATHI KQT2
	WHERE KQT2.MAHV = KQT.MAHV 
	AND KQT2.LANTHI = 1 
	AND KQT2.KQUA = 'Khong dat'
)

SELECT HV.MAHV, HV.HO, HV.TEN
FROM HOCVIEN HV INNER JOIN KETQUATHI KQT ON HV.MAHV = KQT.MAHV
EXCEPT 
SELECT HV.MAHV, HV.HO, HV.TEN
FROM HOCVIEN HV INNER JOIN KETQUATHI KQT ON HV.MAHV = KQT.MAHV
WHERE KQT.LANTHI = 1 AND KQT.KQUA = 'Khong dat'

-- 32.* Tìm học viên (mã học viên, họ tên) thi môn nào cũng đạt (chỉ xét lần thi sau cùng).
SELECT HV.MAHV, HV.HO, HV.TEN
FROM HOCVIEN HV INNER JOIN KETQUATHI KQT ON HV.MAHV = KQT.MAHV
EXCEPT
SELECT HV.MAHV, HV.HO, HV.TEN
FROM HOCVIEN HV INNER JOIN KETQUATHI KQT ON HV.MAHV = KQT.MAHV
WHERE KQT.KQUA = 'Khong dat' AND KQT.LANTHI = (
	SELECT MAX(KQT2.LANTHI)
	FROM KETQUATHI KQT2
	WHERE KQT2.MAHV = KQT.MAHV AND KQT2.MAMH = KQT.MAMH
)

-- 33.* Tìm học viên (mã học viên, họ tên) đã thi tất cả các môn và đều đạt (chỉ xét lần thi thứ 1).
SELECT HV.MAHV, HV.HO, HV.TEN
FROM HOCVIEN HV INNER JOIN KETQUATHI KQT ON HV.MAHV = KQT.MAHV
WHERE KQT.LANTHI = 1 AND KQT.KQUA = 'Dat'
GROUP BY HV.MAHV, HV.HO, HV.TEN
HAVING COUNT(DISTINCT KQT.MAMH) = (
	SELECT COUNT(MAMH)
	FROM MONHOC
)

SELECT HV.MAHV, HV.HO, HV.TEN
FROM HOCVIEN HV 
WHERE NOT EXISTS (
	SELECT 1 
	FROM MONHOC MH 
	WHERE NOT EXISTS (
		SELECT 1 
		FROM KETQUATHI KQT 
		WHERE KQT.MAHV = HV.MAHV AND KQT.MAMH = MH.MAMH
		AND KQT.LANTHI = 1 AND KQT.KQUA = 'Dat'
	)
)

-- 34.* Tìm học viên (mã học viên, họ tên) đã thi tất cả các môn và đều đạt (chỉ xét lần thi sau cùng).
SELECT HV.MAHV, HV.HO, HV.TEN
FROM HOCVIEN HV 
WHERE NOT EXISTS (
	SELECT 1 
	FROM MONHOC MH
	WHERE NOT EXISTS (
		SELECT 1 
		FROM KETQUATHI KQT 
		WHERE KQT.MAHV = HV.MAHV AND KQT.MAMH = MH.MAMH
		AND KQT.KQUA = 'Dat' AND KQT.LANTHI = (
			SELECT MAX(KQT2.LANTHI)
			FROM KETQUATHI KQT2
			WHERE KQT2.MAHV = KQT.MAHV AND KQT2.MAMH = KQT.MAMH
		)
	)
)

-- 35.** Tìm học viên (mã học viên, họ tên) có điểm thi cao nhất trong từng môn (lấy điểm ở lần thi sau cùng).
SELECT A.MAMH, A.MAHV, A.HO, A.TEN, A.DIEM
FROM (
	SELECT KQT.MAMH, HV.MAHV, HV.HO, HV.TEN, KQT.DIEM, RANK() OVER (PARTITION BY KQT.MAMH ORDER BY KQT.DIEM DESC) AS RANK_MH
	FROM HOCVIEN HV INNER JOIN KETQUATHI KQT ON HV.MAHV = KQT.MAHV
	WHERE KQT.LANTHI = (
		SELECT MAX(KQT2.LANTHI) 
		FROM KETQUATHI KQT2
		WHERE KQT2.MAHV = KQT.MAHV AND KQT2.MAMH = KQT.MAMH
	)
) A
WHERE A.RANK_MH = 1